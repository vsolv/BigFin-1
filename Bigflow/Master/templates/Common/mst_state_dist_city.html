{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %} Master {% endblock %}
{% csrf_token %}
{% block content %}
{% verbatim %}
<div class="maincontent">
    <div class="container container1" ng-app="dateapp" ng-controller="datectrl" ng-cloak>
        <div class="row">
            <div class="row-header col-lg-12 col-sm-12">
                <h4>State District City Master</h4>
            </div>
        </div>
        <div class="row" class="col-md-12">
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>State</label>
                            <input ng-change="myfun()" ng-model="state" placeholder="Search State.."
                                   type="text"/>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                    </div>
                    <div class="col-md-3">
                        <md-button class="md-fab md-mini md-primary custbutton" ng-click="add_state()">
                            <md-icon>add</md-icon>
                            <md-tooltip>Add State District City </md-tooltip>
                        </md-button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row table-responsive">
            <div class="col-md-12 col-lg-12 col-sm-12">
                <table class="table table-striped table-bordered table-condensed table-hover md-primary">
                    <thead class="header">
                    <th scope="col" class="text-center" style="width:15px;">
                        Expand
                        <!--                        <button type="button" class="show"-->
                        <!--                                ng-click="expandAll(allExpanded = !allExpanded)">-->
                        <!--                            <span ng-bind="allExpanded ? 'Hide' : 'Show'"></span>-->
                        <!--                        </button>-->
                    </th>
                    <th scope="col" class="text-center">S.No</th>
                    <th scope="col" class="text-center">State Name</th>
                    <th scope="col" class="text-center">State Code</th>
                    </thead>
                    <tbody ng-repeat="st in dist_list.slice(((currentPage-1)*itemsPerPage), ((currentPage)*itemsPerPage))">
                    <tr ng-class="{selected: emp.isChecked}">
                        <td class="text-center" style="width:15px;">
                            <md-button class="md-fab md-mini md-primary custbutton" ng-click="state_details(st,$index)"
                                       class="text-center">
                                <md-icon>{{icon_img}}</md-icon>
                            </md-button>
                        </td>
                        <td class="text-center">
                            <center>{{((currentPage-1)*itemsPerPage)+$index+1}}</center>
                        </td>
                        <td class="text-center" ng-bind="st.state_name"></td>
                        <td class="text-right" ng-bind="st.state_code"></td>
                    </tr>
                    <tr ng-show="st.expanded">
                        <td></td>
                        <td colspan="7">
                            <table class="table table-striped table-bordered table-condensed md-primary">
                                <thead class="header">
                                <tr>
                                    <th scope="col" class="text-center" style="width:15px;">Expand</th>
                                    <th scope="col" class="text-center">District name</th>
                                    <th scope="col" class="text-center">District Code</th>
                                </tr>
                                </thead>
                                <tbody ng-repeat="dist in distritddl.slice(((currentPage-1)*itemsPerPage_dist), ((currentPage)*itemsPerPage_dist))"
                                       ng-class="{conditionalScroll:distritddl.length>3}">
                                <tr>
                                    <td class="text-center" style="width:15px;">
                                        <md-button class="md-fab md-mini md-primary custbutton"
                                                   ng-click="dist_details(dist,$index)"
                                                   class="text-center">
                                            <md-icon>{{icon_img_dt}}</md-icon>
                                        </md-button>
                                    </td>
                                    <td class="text-left" ng-bind="dist.district_name"></td>
                                    <td class="text-left" ng-bind="dist.district_code"></td>
                                </tr>
                                <tr ng-show="dist.expanded">
                                    <td></td>
                                    <td colspan="7">
                                        <table class="table table-striped table-bordered table-condensed md-primary">
                                            <thead class="header">
                                            <tr>
                                                <th scope="col" class="text-center">City name</th>
                                                <th scope="col" class="text-center">Pincode</th>
                                                <th scope="col" class="text-center">District name</th>
                                                <th scope="col" class="text-center">State name</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr ng-repeat="cty in city1.slice(((currentPage-1)*itemsPerPage_cty), ((currentPage)*itemsPerPage_cty))">
                                                <td class="text-left" ng-bind="cty.City_Name"></td>
                                                <td class="text-left" ng-bind="cty.pincode_no"></td>
                                                <td class="text-left" ng-bind="cty.district_name"></td>
                                                <td class="text-left" ng-bind="cty.state_name"></td>
                                            </tr>
                                            <tr ng-show="city1.length ==  0">
                                                <td class="warning" colspan="8">
                                                    No Records Found.
                                                </td>
                                            </tr>
                                            </tbody>
                                            <tfoot>
                                            <tr>
                                                <td colspan="3">
                                                    <ul boundary-links="true" class="pagination-sm cust_pagination"
                                                        items-per-page="itemsPerPage_cty"
                                                        max-size="3"
                                                        ng-model="currentPage" total-items="pageLength_cty"
                                                        uib-pagination></ul>
                                                </td>
                                                <td colspan="1" class="text-left">
                                                    <span>Total Count:<br/> <b
                                                            class="text-centre"> {{city1.length}}</b></span>
                                                </td>
                                            </tr>
                                            </tfoot>
                                        </table>
                                    </td>
                                </tr>
                                <tr ng-show="distritddl.length ==  0">
                                    <td class="warning" colspan="8">
                                        No Records Found.
                                    </td>
                                </tr>
                                </tbody>
                                <tfoot>
                                <tr>
                                    <td colspan="3">
                                        <ul boundary-links="true" class="pagination-sm cust_pagination"
                                            items-per-page="itemsPerPage_dist"
                                            max-size="3"
                                            ng-model="currentPage" total-items="distritddl.length"
                                            uib-pagination></ul>
                                    </td>
                                    <td colspan="1" class="text-left">
                                        <span>Total Count:<br/> <b class="text-centre"> {{distritddl.length}}</b></span>
                                    </td>
                                </tr>
                                </tfoot>
                            </table>
                        </td>
                    </tr>
                    <tr ng-show="dist_list ==  0">
                        <td class="warning" colspan="15">
                            No Records Found.
                        </td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="3">
                            <ul boundary-links="true" class="pagination-sm cust_pagination"
                                items-per-page="itemsPerPage"
                                max-size="maxSize"
                                ng-model="currentPage" total-items="pageLength"
                                uib-pagination></ul>
                        </td>
                        <td colspan="1" class="text-left">
                            <span>Total Count:<br/> <b class="text-centre"> {{dist_list.length}}</b></span>
                        </td>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        <div class="modal fade" id="state_add_popup"
             tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabel">
                            Add New State, District, City and Pincode
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="body">
                        <div class="modal-body popup-body">
                            <div class="row">
                                <md-subheader class="md-accent">State Name</md-subheader>
                                <div class="col-md-12">
                                    <div class="col-md-4">
                                        <md-autocomplete
                                                md-clear-button="true"
                                                md-floating-label="State Name"
                                                md-input-maxlength=126
                                                md-item-text="item.state_name"
                                                md-items="item in getState(searchState)"
                                                md-selected-item-change="StateChanged(item)"
                                                md-min-length=0
                                                md-search-text="searchState"
                                                ng-model="State_Na"
                                                md-selected-item="state.selectedStatename"
                                                md-selected-item-change="namechange(item)">
                                            <md-item-template>
                                                <span md-highlight-text="searchTex"> {{item.state_name}}</span>
                                            </md-item-template>
                                            <md-not-found>
                                                No State Name matching "{{searchState}}" were found.
                                            </md-not-found>
                                        </md-autocomplete>
                                    </div>
                                    <div class="col-md-3" ng-show="showStateInput">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>New State Name</label>
                                            <input ng-model="state.new_state_name" placeholder="State Name"
                                                   pattern="[a-zA-Z]+"
                                                   ng-pattern-restrict only-letters-input required
                                                   type="text"
                                            />
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-4">
                                        <md-button class="md-icon-button md-primary" aria-label="Setting"
                                                   ng-click="insert_state(state)">
                                            <md-icon>add</md-icon>
                                        </md-button>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <md-subheader class="md-accent">Add District</md-subheader>
                                <div class="col-md-12">
                                    <div class="col-md-4">
                                        <md-autocomplete
                                                md-clear-button="true"
                                                md-floating-label="State Name"
                                                md-input-maxlength=126
                                                md-item-text="item.state_name"
                                                md-items="item in getState_Name(searchStateDist)"
                                                md-selected-item-change="state_clk(item.state_gid)"
                                                md-min-length=0
                                                md-search-text="searchStateDist"
                                                ng-model="State_Na"
                                                md-selected-item-change="DistrictChanged(item)"
                                                md-selected-item="dist.state">
                                            <md-item-template>
                                                <span md-highlight-text="searchTex"> {{item.state_name}}</span>
                                            </md-item-template>
                                            <md-not-found>
                                                No State Name matching "{{searchState}}" were found.
                                            </md-not-found>
                                        </md-autocomplete>
                                    </div>
                                    <div class="col-md-3">
                                        <md-autocomplete
                                                md-clear-button="true"
                                                md-floating-label="District Name"
                                                md-input-maxlength=126
                                                md-item-text="item1.district_name"
                                                md-items="item1 in getDistrict_Name(searchDistrict)"
                                                md-min-length=0
                                                md-no-cache="true"
                                                md-search-text="searchDistrict"
                                                md-selected-item="dist.selectedDistname"
                                                md-selected-item-change="DistrictChanged(item1)">
                                            <md-item-template>
                                                <span md-highlight-text="searchTex"> {{item1.district_name}}</span>
                                            </md-item-template>
                                            <md-not-found>
                                                No District Name matching "{{searchDistrict}}" were found.
                                            </md-not-found>
                                        </md-autocomplete>
                                    </div>
                                    <div class="col-md-3" ng-show="showStateDistrictInput">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>New District Name</label>
                                            <input ng-model="dist.new_district_name" placeholder="District Name"
                                                   pattern="[a-zA-Z]+" ng-pattern-restrict only-letters-input required
                                                   type="text"/>
                                        </md-input-container>
                                    </div>

                                    <div class="col-md-1">
                                        <md-button class="md-icon-button md-primary" aria-label="Settings"
                                                   ng-click="add_district(dist)">
                                            <md-icon>add</md-icon>
                                        </md-button>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <md-subheader class="md-accent">Add City</md-subheader>
                                <div class="col-md-12">
                                    <div class="col-md-3">
                                        <md-autocomplete
                                                md-clear-button="true"
                                                md-floating-label="State Name"
                                                md-input-maxlength=126
                                                md-item-text="item.state_name"
                                                md-items="item in getState_Name(searchStateDistCity)"
                                                md-selected-item-change="state_clk(item.state_gid)"
                                                md-min-length=0
                                                md-search-text="searchStateDistCity"
                                                ng-model="State_Na"
                                                md-selected-item="city.state">
                                            <md-item-template>
                                                <span md-highlight-text="searchTex"> {{item.state_name}}</span>
                                            </md-item-template>
                                            <md-not-found>
                                                No State Name matching "{{searchState}}" were found.
                                            </md-not-found>
                                        </md-autocomplete>
                                    </div>
                                    <div class="col-md-3">
                                        <md-autocomplete
                                                md-clear-button="true"
                                                md-floating-label="District Name"
                                                md-input-maxlength=126
                                                md-item-text="item.district_name"
                                                md-items="item in getDistrictCity_Name(searchDistrictCity)"
                                                md-min-length=0
                                                md-no-cache="true"
                                                md-search-text="searchDistrictCity"
                                                md-selected-item="city.selectedCityname"
                                                md-selected-item-change="district_clk(item.district_gid)">
                                            <md-item-template>
                                                <span md-highlight-text="searchTex"> {{item.district_name}}</span>
                                            </md-item-template>
                                            <md-not-found>
                                                No District Name matching "{{searchDistrict}}" were found.
                                            </md-not-found>
                                        </md-autocomplete>
                                    </div>
                                    <div class="col-md-3">
                                        <md-autocomplete
                                                md-clear-button="true"
                                                md-floating-label="City Name"
                                                md-input-maxlength=126
                                                md-item-text="city.City_Name"
                                                md-items="city in getCity_Name(searchCity)"
                                                md-min-length=0
                                                md-no-cache="true"
                                                md-search-text="searchCity"
                                                md-selected-item="city.selectedCity"
                                                md-selected-item-change="CityChanged(city)">
                                            <md-item-template>
                                                <span md-highlight-text="searchTex"> {{city.City_Name}}</span>
                                            </md-item-template>
                                            <md-not-found>
                                                No City Name matching "{{searchCity}}" were found.
                                            </md-not-found>
                                        </md-autocomplete>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-3" ng-show="showCityInput">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>New City Name</label>
                                            <input ng-model="city.new_city_name" placeholder="City Name"
                                                   pattern="[a-zA-Z]+"
                                                   ng-pattern-restrict only-letters-input required
                                                   type="text"/>
                                        </md-input-container>
                                    </div>

                                    <div class="col-md-3">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Pin Code</label>
                                            <input ng-model="city.pincode"
                                                   maxlength="6" minlength="6" numbers-only required>
                                        </md-input-container>
                                    </div>

                                    <div class="col-md-2">
                                        <md-button class="md-icon-button md-primary" aria-label="Settings"
                                                   ng-click="add_city_pincode(city)">
                                            <md-icon>add</md-icon>

                                        </md-button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endverbatim %}
<script>
var app = angular.module('dateapp', ['ngMaterial', 'ui.bootstrap', 'AppCommon', 'ngMessages'])
    .config(function($httpProvider) {
        $httpProvider.defaults.xsrfCookieName = 'csrftoken';
        $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
    });
app.controller('datectrl', function($scope, newservice, $window, $mdDialog,$mdDateLocale, $rootScope, $filter) {
    $scope.orderByField = '';
    $scope.maxSize = 3;
    $scope.enable_update = true;
    $scope.itemsPerPage = 10;
    $scope.itemsPerPage_dist = 10;
    $scope.itemsPerPage_cty = 10;
    $scope.currentPage = 1;
    $scope.currentPage_cty = 1;
    $scope.currentPage_dist = 1;
    $scope.hsn = [];
    $scope.data_len = 0;
    var count = 0;
    var ct = 0;
    $scope.icon_img = "expand_more";
    $scope.icon_img_dt = "expand_more";
    var detail = JSON.parse(sessionStorage.getItem('today'));
    var td = detail.date
    $mdDateLocale.formatDate = function(date) {
            return $filter('date')(date, "dd-MMM-yyyy");
        };
    $scope.loading = function() {
        $mdDialog.show({
            templateUrl: 'loaderSpinner',
            parent: angular.element(document.body),
            clickOutsideToClose: false
        });
    };
    $scope.loading_pop = function() {
        $mdDialog.show({
            templateUrl: 'loaderSpinner',
            parent: angular.element(document.getElementById('state_add_popup')),
            clickOutsideToClose: false
        });
    };
    $scope.endloading = function() {
        $mdDialog.hide();
    };
    $scope.dist_list =[];
    $scope.statedist=[];
    loadstate();
    function loadstate(){
    $scope.loading();
    var sttddl = newservice.getstateddl()
    sttddl.then(function(result) {
            $scope.dist_list =[];
            $scope.statedist=[];
            $scope.dist_list=JSON.parse(result.data);
            $scope.statedist=JSON.parse(result.data);
            for (var i = 0; i < 1; i++) {
                dta = {
                    "state_gid":0,
                    "state_name": "Add New State",
                }
                $scope.statedist.push(dta);
            }
            for (var i = 0; i < $scope.dist_list.length; i++) {
               $scope.dist_list[i].expanded = false;
            }
            $scope.pageLength = $scope.dist_list.length;
            $scope.Totalpages = Math.ceil($scope.dist_list.length / $scope.itemsPerPage);
            $scope.pageLength = $scope.dist_list.length;
        }).finally($scope.endloading);
    }

    $scope.myfun = function() {
            if($scope.state == ""){
                loadstate();
            }
            else{
                $scope.dist_list = $filter('filter')($scope.dist_list, {
                    "state_name": $scope.state,
                });
            }
        }

    $scope.state_details = function(ids,k){
    var index_d = 0 ;
    if ($scope.currentPage != 1){
            var index_d = $scope.currentPage - 1;
            index_d  = index_d * 10;
            index_d = k + index_d;
        }
        else{
            var index_d = k;
        }
    if($scope.dist_list[index_d].expanded == false){
        $scope.loading();
        $scope.state_clk(ids.state_gid,index_d);
        $scope.endloading();
        }
        else if($scope.dist_list[index_d].expanded == true && count == index_d){
            $scope.dist_list[count].expanded = false;
            $scope.icon_img = "expand_more";
        }
        else if($scope.dist_list[index_d].expanded == true && count != index_d){
            $scope.loading();
            $scope.state_clk(ids.state_gid,index_d);
            $scope.endloading();
        }
    }

    $scope.dist_details = function(ids,j){
    if($scope.distritddl[ct].expanded == false){
        $scope.loading();
        $scope.district_clk(ids.district_gid,j);
        $scope.endloading();
        }
        else if($scope.distritddl[ct].expanded == true && ct == j){
            $scope.distritddl[ct].expanded = false;
            $scope.icon_img_dt = "expand_more";
        }
        else if($scope.distritddl[ct].expanded == true && ct != j){
            $scope.loading();
            $scope.district_clk(ids.state_gid,j);
            $scope.endloading();
        }
    }
    $scope.getState = Create_State;
       function Create_State(query) {
           var result = $filter('filter')($scope.statedist, {
           'state_name': query
             });
           return result;
      }
    $scope.getState_Name = Change_State_Name;
       function Change_State_Name(query) {
           var result = $filter('filter')($scope.dist_list, {
           'state_name': query
             });
           return result;
      }
    $scope.showStateDistrictInput = false;
        $scope.DistrictChanged = function(c) {
            var x = c.district_name;
            if (x == 'Add New District') {
                $scope.showStateDistrictInput = true;
            }
            else{
            $scope.showStateDistrictInput = false;
            }
            $scope.getDistrict_Name;
        }

    $scope.getDistrict_Name=function(query)
        {
           var result = $filter('filter')($scope.distritddl1, {
           'district_name': query
             });
           return result;
        }
    $scope.location_clk = function(location_gid) {
    if (location_gid != 0) {
        var loct = newservice.getlocation(location_gid)
        loct.then(function(result) {
        $scope.locationdisabled = true;
                var loctn = [];
                loctn = JSON.parse(result.data);
                $scope.selectedlocState = loctn[0].city_state_gid;
                $scope.state_locclk($scope.selectedlocState);
                $scope.selectedlocdist = loctn[0].pincode_district_gid;
                $scope.district_locclkl($scope.selectedlocdist);
                $scope.selectedloccity = loctn[0].pincode_City_gid;
                $scope.city_locclk($scope.selectedloccity);
                $scope.locpcode = loctn[0].pincode_no;
                $scope.locpcodegid = loctn[0].pincode_gid;
                $scope.selectedlocclst = loctn[0].location_cluster_gid;
                if (loctn[0].location_cluster_gid > 0){
                    $scope.clusterdis = true;}
                 else {$scope.clusterdis = false;}
            }),
            function() {
                alert('no data');
            };
           }
          else
          {
          $scope.locationdisabled = false;
          $scope.selectedlocState = '';
          $scope.selectedlocdist = '';
          $scope.selectedloccity = '';
          $scope.locpcode = '';
          $scope.locpcodegid = '';
          $scope.selectedlocclst = '';
          }

    };
    $scope.state_locclk = function(state_gid) {
        var locdist = newservice.getdistddl(state_gid)
        locdist.then(function(result) {
                $scope.locdistrict = [];
                $scope.locdistrict = JSON.parse(result.data);
                $scope.gstno($scope.code,state_gid,$scope.selectedloc);
            }),
            function() {
                alert('no data');
            };
    };

    $scope.district_locclkl = function(district_gid) {
        var loccty = newservice.getcityddl(district_gid)
        loccty.then(function(result) {
                $scope.loccity = [];
                $scope.loccity = JSON.parse(result.data);
            }),
            function() {
                alert('no data');
            };
    };
    $scope.city_locclk = function(city_gid) {
        var locpincd = newservice.getpincode(city_gid)
        locpincd.then(function(result) {
                var locpincde = [];
                locpincde = JSON.parse(result.data);
                $scope.locpcode = locpincde[0].pincode_no;
                $scope.locpcodegid = locpincde[0].pincode_gid;
            }),
            function() {
                alert('no data');
            };
    };
    $scope.state_clk = function(state_gid, type) {
        $scope.dist_list[count].expanded = false;
        var ii = 0;
        var distddl = newservice.getdistddl(state_gid)
        distddl.then(function(result) {
                if (type == 'address') {
                    $scope.adistrictddl = [];
                    $scope.adistrictddl = JSON.parse(result.data);
                } else {
                    $scope.distritddl = [];
                    $scope.distritddl2 = [];
                    $scope.distritddl2 = JSON.parse(result.data);
                    $scope.distritddl1 = [];
                    $scope.distritddl = JSON.parse(result.data);
                    $scope.distritddl1 = JSON.parse(result.data);
                    for (var i = 0; i < 1; i++) {
                         dta = {
                        "district_gid":0,
                        "district_name": "Add New District",
                          }
                        $scope.distritddl1.push(dta);
                        $scope.distritddl[i].expanded = false;
                    }
                    $scope.dist_list[type].expanded = true;
                    count = type;
                    $scope.icon_img = "expand_less";
                    $scope.pageLength_dist = $scope.distritddl.length;
                    $scope.Totalpages_dist = Math.ceil($scope.distritddl.length / $scope.itemsPerPage_dist);
                }
            }),
            function() {
                alert('no data');
            };
    };
    $scope.district_clk = function(district_gid, type) {
        $scope.distritddl[ct].expanded = false;
        var ctyddl = newservice.getcityddl(district_gid)
        ctyddl.then(function(result) {
                if (type == 'address') {
                    $scope.acity1 = [];
                    $scope.acity1 = JSON.parse(result.data);
                } else {
                    $scope.city1 = [];
                     $scope.city2 = [];
                    $scope.city1 = JSON.parse(result.data);
                    $scope.city2 = JSON.parse(result.data);
                     for (var i = 0; i < 1; i++) {
                        dta = {
                            "city_gid":0,
                            "City_Name":"Add New City",
                           }
                           $scope.city2.push(dta);
                     }
                   }
                   $scope.distritddl[type].expanded = true;
                   ct = type;
                   $scope.icon_img_dt = "expand_less";
                   $scope.pageLength_cty = $scope.city1.length;
                   $scope.Totalpages_cty = Math.ceil($scope.city1.length / $scope.itemsPerPage_cty);
            }),
            function() {
                alert('no data');
            };
    };
    $scope.city_clk = function(city_gid, type) {
        var pincd = newservice.getpincode(city_gid)
        pincd.then(function(result) {
                if (type == 'address') {
                    var apincde = [];
                    apincde = JSON.parse(result.data);
                    $scope.add.pincode1 = apincde[0].pincode_no;
                } else {
                    var pincde = [];
                    pincde = JSON.parse(result.data);
                    $scope.pcode = pincde[0].pincode_no;
                }
            }),
            function() {
                alert('no data');
            };
    };
    $scope.add_state = function() {
        modalshow('state_add_popup');
    }

       $scope.showStateInput = false;
        $scope.StateChanged = function(c) {
            var x = c.state_name
            if (x == 'Add New State') {
                $scope.showStateInput = true;
            }
            else{
            $scope.showStateInput = false;
            }
        }

             var detail = JSON.parse(sessionStorage.getItem('today'));
             $scope.employgid = detail.employee_gid;
             $scope.entity_gid = detail.entity_gid;
             $scope.create_by = detail.employee_gid;
             $scope.state=[];

             $scope.insert_state=function(state){
             $scope.loading_pop();
             $scope.State_Name = $scope.state.new_state_name.toUpperCase();
             if($scope.State_Name != undefined)
             {
                   var data={
                   "params":{
                       "filter":{"State_name":$scope.State_Name,"State_country_gid":1},
                       "classification":{"Entity_gid":$scope.entity_gid}
                        }
                   }
             var data_init={
                         "Action":"Insert",
                         "Type":"State_Insert",
                         "create_by":$scope.employgid,
                         "data":data
                        }
                var add_state = newservice.city_pincode_set(data_init);
                      add_state.then(function(result) {
                        if (result.data === "SUCCESS") {
                            success_toast();
                            $window.location.href = "mst_state_dist_city";
                         }
                         else {
                            alert(result.data);
                         }
                      }).finally($scope.endloading);
                }
               else{
                 alert("Give Correct Input!");
               }
              };
     $scope.showStateDistrictInput = false;
        $scope.DistrictChanged = function(c) {
            var x = c.district_name;
            if (x == 'Add New District') {
                $scope.showStateDistrictInput = true;
            }
            else{
            $scope.showStateDistrictInput = false;
            }
            $scope.getDistrict_Name;
        }

       $scope.getDistrict_Name=function(query)
        {
           var result = $filter('filter')($scope.distritddl1, {
           'district_name': query
             });
           return result;
        }
              $scope.add_district=function(dist){
                $scope.loading_pop();
                  $scope.new_dist_name=dist.new_district_name;
                  $scope.state_gid=dist.state.state_gid;
                  $scope.results = $filter('filter')($scope.distritddl,{
                       'district_name': $scope.new_dist_name
                        });
                  $scope.res=$scope.results.length;
                  if($scope.res==0 && $scope.state_gid!="")
                  {
                      var data={"params":{"filter":{"district_state_gid":$scope.state_gid,
                                          "district_name":$scope.new_dist_name},
                                           "classification":{"Entity_gid":$scope.entity_gid}
                                          }
                      }
                      var data_init={
                             "Action":"Insert",
                             "Type":"District_Insert",
                             "create_by":$scope.employgid,
                             "data":data
                             }

                      var add_state = newservice.city_pincode_set(data_init);
                         add_state.then(function(result) {
                          if (result.data === "SUCCESS") {
                               success_toast();
                               $window.location.href = "mst_state_dist_city";
                           }
                           else {
                                alert(result.data);
                           }

                      }).finally($scope.endloading);
                 }
              else{
              alert("Give Correct Input!");
              }
              };

     $scope.showCityInput = false;
        $scope.CityChanged = function(c) {
            var x = c.City_Name;
            if (x == 'Add New City') {
                $scope.showCityInput=true;
            }
            else{
            $scope.showCityInput = false;
        }
        }
       $scope.getDistrictCity_Name = Change_Dist_Name;
       function Change_Dist_Name(query) {
           var result = $filter('filter')($scope.distritddl2, {
           'district_name': query
             });
           return result;
      }
       $scope.getCity_Name = Change_City_Name;
       function Change_City_Name(query) {
           var result = $filter('filter')($scope.city2, {
           'City_Name': query
             });
           return result;
      }

       $scope.add_city_pincode=function(city){
       $scope.loading_pop();
        $scope.city_name=city.selectedCity.City_Name;
        $scope.new_city_name=city.new_city_name;
        $scope.new_pincode=city.pincode;
        $scope.state_gid=city.state.state_gid;
        $scope.district_gid=city.selectedCityname.district_gid;
        $scope.ressult_city = $filter('filter')($scope.city1,{
                  'City_Name':$scope.city_name
                  });
                 $scope.ressult_city=$scope.ressult_city.length;
                 if($scope.ressult_city==0 && $scope.new_city_name!=null && $scope.new_pincode!=null && $scope.state_gid!=null && $scope.district_gid!=null)
                 {
                     var data={"params":
                        {
                          "city_name": $scope.new_city_name,
                          "state_gid":$scope.state_gid,
                          "district_gid":$scope.district_gid,
                          "pincode_no":$scope.new_pincode
                        }
                     };
                     var data_init={
                             "Action":"insert",
                             "data":data
                     }
                 var add_city = newservice.city_pincode_set(data_init);
                      add_city.then(function(result) {
                      var msg = result.data[0];
                      var temp = msg.split(',')[1];
                        if (temp === "SUCCESS") {
                             success_toast();
                            $window.location.href = "mst_state_dist_city";
                        }
                        else {
                          alert(result.data);
                        }
                    }).finally($scope.endloading);
                }
                else{
                    alert("Give Correct Input...!");
                }
            };
});

app.service('newservice', function($http) {
    this.hsn_detail = function(data) {
        var response = $http.post(Appname + "/hsn_data/", data);
        return response;
    }
    this.getloctddl = function(d) {
        var response = $http.get(Appname + "/locationddl/");
        return response;
    }
    this.getstateddl = function(d) {
        var response = $http.get(Appname + "/stateddl/");
        return response;
    }
    this.getlocation = function(location_gid) {
        var response = $http.get(Appname + "/locationget/", {
            params: {
                "location_gid": location_gid
            }
        });
        return response;
    }
    this.getdistddl = function(state_gid) {
        var response = $http.get(Appname + "/districtddl/", {
            params: {
                "state_gid": state_gid
            }
        });
        return response;
    }
    this.getcityddl = function(district_gid) {
        var response = $http.get(Appname + "/cityddl/", {
            params: {
                "district_gid": district_gid
            }
        });
        return response;
    }
    this.getpincode = function(city_gid) {
        var response = $http.get(Appname + "/pincode/", {
            params: {
                "city_gid": city_gid
            }
        });
        return response;
    }
    this.city_pincode_set=function(data_init){
         var response=$http.post(Appname +"/set_mst_SDCP/",data_init);
         return response;
    }
});







</script>

{% endblock %}
