{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %}  Expense Billentry Checker {% endblock %}
{% block content %}
{% csrf_token %}
{% verbatim %}

<div class="maincontent">
    <div ng-app="makersummary" ng-controller="ctrlsummary" class="container container1">
        <div class="row">
            <div class="row-header col-lg-12 col-sm-12">
                <h4> Expese Billentry Checker</h4>
            </div>
        </div>
        <br/>
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-5">
                    <span class="md-title title-color">Invoice Type : </span>
                    <span class="md-subhead">{{checker_data[0].invoiceheader_invoicetype}}</span>
                </div>
                <div class="col-md-5">
                    <span class="md-title title-color">Supplier Name : </span><span
                        class="md-subhead">{{checker_data[0].supplier_name}}</span>
                </div>
            </div>
        </div>
        <br/>
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-5">
                    <span class="md-title title-color">Date : </span>
                    <span class="md-subhead">{{checker_data[0].invoiceheader_invoicedate}}</span>
                </div>
                <div class="col-md-5">
                    <span class="md-title title-color">Invoice Number : </span><span
                        class="md-subhead">{{checker_data[0].invoiceheader_invoiceno}}</span>
                </div>
            </div>
        </div>
        <br/>
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-5">
                    <span class="md-title title-color">Invoice Amount : </span>
                    <span class="md-subhead">{{checker_data[0].invoiceheader_amount}}</span>
                </div>
                <div class="col-md-5">
                    <span class="md-title title-color">Employee Name : </span><span
                        class="md-subhead">{{checker_data[0].employee_name}}</span>
                </div>
            </div>
        </div>
        <br/>
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-5">
                    <span class="md-title title-color">Branch Name : </span>
                    <span class="md-subhead">{{checker_data[0].branch_name}}</span>
                </div>
                <div class="col-md-5">
                    <span class="md-title title-color">GST Number : </span><span
                        class="md-subhead">{{checker_data[0].gst_no}}</span>
                </div>
                <div class="col-md-2">
                    <span class="md-title title-color" ng-if="checker_data[0].IS_GST=='Y'">IS GST : </span>
                    <span ng-if="checker_data[0].IS_GST=='Y'" class="md-subhead">YES</span>
                    <span class="md-title title-color" ng-if="checker_data[0].IS_GST=='N'">IS GST : </span>
                    <span ng-if="checker_data[0].IS_GST=='N'" class="md-subhead">NO</span>
                </div>
            </div>
        </div>
        <br/>
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-5">
                    <span class="md-title title-color">Remarks : </span>
                    <span class="md-subhead">{{checker_data[0].invoiceheader_remarks}}</span>
                </div>
                <div class="col-md-5">
                    <span href="" ng-hide="commodity_show==0"
                          ng-click=view_commodity(checker_data[0].invoiceheader_crno) style="color:green">View Commodity Details</span>
                    <span ng-hide="commodity_show==1" class="md-title title-color">Commodity Name : </span>
                    <span ng-hide="commodity_show==1" class="md-subhead">{{commodity_data[0].commodity_name}}</span>
                </div>
                <!--                <div class="col-md-6">-->
                <!--                    <span class="md-title" style="color:green;">Approver Name : </span>-->
                <!--                    <span class="md-subhead">{{approver_summary[0].employee_name}}</span>-->
                <!--                </div>-->

            </div>
        </div>
        <br>
        <div class="row">
            <form name="bill" novalidate>
                <div ng-cloak="" class="tabsdemoDynamicHeight">
                    <md-content>
                        <md-tabs md-dynamic-height="" md-border-bottom="">
                            <md-tab label="INVOICE DETAILS">
                                <md-content class="md-padding">
                                    <div class="row table-responsive">
                                        <div class="col-md-12 col-lg-12 col-sm-12">
                                            <div class="row table-responsive">
                                                <div class="col-md-12 col-lg-12 col-sm-12">
                                                    <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                                           md-progress="deferred">
                                                        <thead class="header">
                                                        <tr>
                                                            <th>S.No</th>
                                                            <th>Item</th>
                                                            <th>Description</th>
                                                            <th>HSN Code</th>
                                                            <th>Unit Price</th>
                                                            <th>Quantity</th>
                                                            <th>Amount</th>
                                                            <th>Discount
                                                            <th>Invoice Amount</th>
                                                            <th>IGST</th>
                                                            <th>CGST</th>
                                                            <th>SGST</th>
                                                            <th>Total Amount</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        <tr align="center"
                                                            ng-repeat="invoice in invoice_summary.slice(((currentPage-1)*itemsPerPage),((currentPage)*itemsPerPage)) | filter:search:strict">
                                                            <td>
                                                                <center>
                                                                    {{((currentPage-1)*itemsPerPage)+$index+1}}
                                                                </center>
                                                            </td>
                                                            <td>{{invoice.invoicedetails_item}}</td>
                                                            <td>{{invoice.invoicedetails_desc}}</td>
                                                            <td>{{invoice.invoicedetails_hsncode}}</td>
                                                            <td>{{invoice.invoicedetails_unitprice}}</td>
                                                            <td>{{invoice.invoicedetails_qty}}</td>
                                                            <td>{{invoice.invoicedetails_amount}}</td>
                                                            <td>{{invoice.invoicedetails_discount}}</td>
                                                            <td>
                                                                {{invoice.invoicedetails_amount-invoice.invoicedetails_discount}}
                                                            </td>
                                                            <td>{{invoice.invoicedetails_igst}}</td>
                                                            <td>{{invoice.invoicedetails_cgst}}</td>
                                                            <td>{{invoice.invoicedetails_sgst}}</td>
                                                            <td>{{invoice.invoicedetails_totalamt}}</td>
                                                        </tr>
                                                        </tbody>
                                                        <tfoot>
                                                        <tr align="center">
                                                            <td colspan="12">
                                                                <ul uib-pagination
                                                                    total-items="invoice_summary.length"
                                                                    ng-model="currentPage"
                                                                    max-size="maxSize"
                                                                    class="pagination-sm"
                                                                    boundary-links="true"
                                                                    items-per-page="itemsPerPage"></ul>
                                                            </td>
                                                            <td colspan="2">
                                                                Total Amount:{{total_invoice_amount}}
                                                            </td>
                                                        </tr>
                                                        </tfoot>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </md-content>
                            </md-tab>
                            <md-tab label="DEBIT" md-on-select="find_debit()">
                                <md-content class="md-padding">
                                    <div class="row table-responsive">
                                        <div class="col-md-12 col-lg-12 col-sm-12">
                                            <div class="row table-responsive">
                                                <div class="col-md-12 col-lg-12 col-sm-12">
                                                    <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                                           md-progress="deferred">
                                                        <thead class="header">
                                                        <tr>
                                                            <th>S.No</th>
                                                            <th>Category Name</th>
                                                            <th>Sub Category Name</th>
                                                            <th>GLNO</th>
                                                            <th>Debit Amount</th>
                                                            <th>BSCC</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        <tr align="center"
                                                            ng-repeat="debit in debit_summary_new.slice(((currentPage-1)*itemsPerPage),((currentPage)*itemsPerPage)) | filter:search:strict">
                                                            <td>
                                                                <center>
                                                                    {{((currentPage-1)*itemsPerPage)+$index+1}}
                                                                </center>
                                                            </td>
                                                            <td>{{debit.category_name}}</td>
                                                            <td>{{debit.subcategory_name}}</td>
                                                            <td>{{debit.debit_glno}}</td>
                                                            <td>{{debit.debit_amount}}</td>
                                                            <td>
                                                                <span href=""
                                                                      ng-click=view_bscc(debit.debit_gid)
                                                                      style="color:green">View BSCC</span>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                        <tfoot>
                                                        <tr align="center">
                                                            <td colspan="5">
                                                                <ul uib-pagination
                                                                    total-items="debit_summary.length"
                                                                    ng-model="currentPage"
                                                                    max-size="maxSize"
                                                                    class="pagination-sm"
                                                                    boundary-links="true"
                                                                    items-per-page="itemsPerPage"></ul>
                                                            </td>
                                                            <td colspan="2">
                                                                Total:{{total_debit_amount}}
                                                            </td>
                                                        </tr>
                                                        </tfoot>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                </md-content>
                            </md-tab>
                            <md-tab label="CREDIT" md-on-select="find_credit()">
                                <md-content class="md-padding">
                                    <div class="row table-responsive">
                                        <div class="col-md-12 col-lg-12 col-sm-12">
                                            <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                                   md-progress="deferred">
                                                <thead class="header">
                                                <tr>
                                                    <th>S.No</th>
                                                    <th>Pay Mode</th>
                                                    <th>Bank Name</th>
                                                    <th>IFSC Code</th>
                                                    <th>Beneficiary Name</th>
                                                    <th>Tax Type</th>
                                                    <th>Tax Rate</th>

                                                    <th>Suplier Tax Rate</th>
                                                    <th>GL</th>
                                                    <th>Credit Amount</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr align="center"
                                                    ng-repeat="credit in credit_summary_new.slice(((currentPage-1)*itemsPerPage),((currentPage)*itemsPerPage)) | filter:search:strict">
                                                    <td>
                                                        <center>
                                                            {{((currentPage-1)*itemsPerPage)+$index+1}}
                                                        </center>
                                                    </td>
                                                    <td>{{credit.Paymode_name}}</td>
                                                    <td>{{credit.bankbranch_name}}</td>
                                                    <td>{{credit.bankbranch_ifsccode}}</td>
                                                    <td>{{credit.bankdetails_beneficiaryname}}</td>
                                                    <td></td>
                                                    <td>{{credit.credit_suppliertaxtrate}}</td>
                                                    <td>{{credit.credit_tdsexcempted}}</td>
                                                    <td>{{credit.credit_glno}}</td>
                                                    <td>{{credit.credit_amount}}</td>
                                                </tr>
                                                </tbody>
                                                <tfoot>
                                                <tr align="center">
                                                    <td colspan="9">
                                                        <ul uib-pagination
                                                            total-items="credit_summary.length"
                                                            ng-model="currentPage"
                                                            max-size="maxSize"
                                                            class="pagination-sm"
                                                            boundary-links="true"
                                                            items-per-page="itemsPerPage"></ul>
                                                    </td>
                                                    <td colspan="2">
                                                        Total Amount:{{total_credit_amount}}
                                                    </td>
                                                </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </md-content>
                            </md-tab>
                        </md-tabs>
                    </md-content>
                </div>
            </form>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="col-md-4">
                    <span class="md-title title-color">Invoice Total Amount: </span>
                    <span class="md-subhead">{{total_invoice_amount}}</span>
                </div>
                <div class="col-md-4">
                    <span class="md-title title-color">Debit Total Amount: </span>
                    <span class="md-subhead">{{total_debit_amount }}</span>
                </div>
                <div class="col-md-4">
                    <span class="md-title title-color">Credit Total Amount: </span>
                    <span class="md-subhead">{{total_credit_amount}}</span>
                </div>
            </div>
        </div>
        <br/>
        <hr/>
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-4" ng-hide="commodity_type=='Contractual Commodity'">
                    <md-autocomplete
                            ng-hide="apprver_view=='0'"
                            md-clear-button="true"
                            md-floating-label="Choose Approver"
                            md-item-text="item.employee_name"
                            md-items="item in getemployee_srch(searchemp)"
                            md-menu-class="md-virtual-repeat-container"
                            md-min-length=0
                            md-no-cache="true"
                            md-search-text="searchemp"
                            md-selected-item="selectedemp"
                            md-selected-item-change="employee_change(item)"
                            ng-disabled="Customer_disab"
                            ng-init="count=0"
                    >
                        <md-item-template>
                            <span md-highlight-text="searchTex"> {{item.employee_name}} - {{item.employee_code}} - {{item.delmat_limit}} - {{item.designation_name}} </span>
                        </md-item-template>
                        <md-not-found>
                            No Employee matching "{{searchTex}}" were found.
                        </md-not-found>
                    </md-autocomplete>
                </div>
                <!--                <div class="col-md-2" style="bottom:0px;color:green" ng-hide="apprver_view=='0'">-->
                <!--                    <h3><span class="editlink material-icons" style="color:#D64CB4;"-->
                <!--                              ng-click="custom_search()">-->
                <!--                      arrow_upward-->
                <!--                </span></h3>Custom Search-->
                <!--                </div>-->
                <div class="col-md-3" style="bottom:0px;color:#7621A6" ng-hide="ppx_hide">
                    <h3><span class="editlink material-icons" style="color:#D64CB4;"
                              ng-click="view_tran_details()">
                      arrow_upward
                </span></h3>View Transaction Details
                </div>
                <div class="col-md-2" style="bottom:0px;color:green">
                    <h3><span class="editlink material-icons" style="color:#D64CB4;"
                              ng-click="view_attached_file()">
                      arrow_upward
                </span></h3>View Attached File
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-6">
            <span ng-hide="commodity_type=='Contractual Commodity'|| apprver_view=='0'"><a
                    style="color:blue;font-weight:bold">NAME:  </a>{{selectedemp.employee_name   }}    <a
                    style="color:blue;font-weight:bold">CODE:</a>{{selectedemp.employee_code}}   <a
                    style="color:blue;font-weight:bold">DELMET LIMIT:</a>{{selectedemp.delmat_limit}}</span>

                </div>
            </div>
        </div>
        <hr>
        <br/><br/>
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-4" ng-hide="apprver_view=='0'">
                    <md-input-container class="md-block inputcontainer">
                        <label>Remarks</label>
                        <input ng-model="remark" maxlength="80" no-special-char/>
                    </md-input-container>
                </div>
                <div class="col-md-2" ng-hide="main_status=='0'">
                    <md-button class="md-raised custbutton" ng-disabled="!remark"
                               ng-click="approv_set('APPROV')">
                        APPROVE
                    </md-button>
                </div>
                <div class="col-md-2">
                    <md-button class="md-raised md-warn" value="submit" ng-disabled="!remark"
                               ng-click="approv_set('REJECT')">REJECT
                    </md-button>
                </div>
                <div class="col-md-2"></div>
                <div class="col-md-2">
                    <md-button class="md-raised custbutton" ng-disabled="!remark"
                               ng-hide="commodity_type!='Transactional Commodity'"
                               ng-click="Moveto_approver()">
                        Move To Approval
                    </md-button>
                </div>
            </div>

        </div>
        <div class="modal fade" id="view_tran_details" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document" style="width:70%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabel">
                            Transaction Details
                            <button type="button" class="close" data-dismiss="modal"
                                    ng-click="close_pr_popup()"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="body">
                        <form class="modal-body popup-body" name="supplier" novalidate>
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div class="row table-responsive">
                                        <div class="col-md-12 col-lg-12 col-sm-12">
                                            <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                                   md-progress="deferred">
                                                <thead class="header">
                                                <tr>
                                                    <th>S.No</th>
                                                    <th>Status</th>
                                                    <th>From Date</th>
                                                    <th>Remarks</th>
                                                    <th>Employee Name</th>
                                                    <th>Approver Name</th>
                                                    <th>Approved By</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr align="center"
                                                    ng-repeat="ass in ecf_tran_summary.slice(((currentPages-1)*itemsPerPages),((currentPages)*itemsPerPages)) | filter:search:strict">
                                                    <td>{{((currentPages-1)*itemsPerPages)+$index+1}}
                                                    </td>
                                                    <td>{{ass.tran_status}}</td>
                                                    <td>{{ass.tran_fromdate}}</td>
                                                    <td>{{ass.tran_remarks}}</td>
                                                    <td>{{ass.employee_name}}<br>
                                                        <span ng-hide="ass.employee_name==null"
                                                              ng-click=view_emp(ass.employee_gid) style="color:green">View Details</span>
                                                    </td>
                                                    <td>{{ass.approvername}}
                                                        <br>
                                                        <span ng-hide="ass.approvername==null"
                                                              ng-click=view_emp(ass.approver_gid) style="color:green">View Details</span>
                                                    </td>
                                                    <td>{{ass.approvedby}}
                                                        <br>
                                                        <span ng-hide="ass.approvedby==null"
                                                              ng-click=view_emp(ass.approveby_gid) style="color:green">View Details</span>
                                                    </td>

                                                </tr>
                                                </tbody>
                                                <tfoot>
                                                <tr align="center">
                                                    <td colspan="5">
                                                        <ul uib-pagination
                                                            total-items="ecf_tran_summary.length"
                                                            ng-model="currentPages"
                                                            max-size="maxSizes"
                                                            class="pagination-sm"
                                                            boundary-links="true"
                                                            items-per-page="itemsPerPages"></ul>
                                                    </td>
                                                    <td colspan="2">
                                                        Total Count:{{ecf_tran_summary.length}}
                                                    </td>
                                                </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-4">
                                        <span class="md-title title-color">Employee Name : </span>
                                        <span class="md-subhead">{{emp_details[0].employee_name}}</span>
                                    </div>
                                    <div class="col-md-4">
                                        <span class="md-title title-color">Branch Code : </span>
                                        <span class="md-subhead">{{emp_details[0].branch_code}}</span>
                                    </div>
                                    <div class="col-md-4">
                                        <span class="md-title title-color">Designation: </span>
                                        <span class="md-subhead">{{emp_details[0].designation_name}}</span>
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-md-offset-5">
                                    <md-button class="md-raised" value="close"
                                               aria-label="Close" data-dismiss="modal">Cancel
                                    </md-button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="custom_search" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document" style="width:70%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabels">
                            Find Approver
                            <button type="button" class="close" data-dismiss="modal"
                                    ng-click="close_pr_popup()"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="body">
                        <form class="modal-body popup-body" name="supplier" novalidate>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-5">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Approver Code</label>
                                            <input ng-model="emp_code"/>
                                        </md-input-container>
                                    </div>

                                    <div class="col-md-1">
                                        <md-button class="md-fab md-mini md-primary custbutton"
                                                   ng-click="getemployee_srch()">
                                            <md-icon>search</md-icon>
                                            <md-tooltip>Search</md-tooltip>
                                        </md-button>
                                    </div>
                                </div>
                            </div>


                            <div class="row">
                                <div class="col-md-2 col-md-offset-4">
                                    <md-button class="md-raised md-warn" value="close"
                                               ng-click="clear_emp()"
                                               aria-label="Close">Clear
                                    </md-button>
                                </div>
                                <div class="col-md-2">
                                    <md-button class="md-raised" value="close"
                                               aria-label="Close" data-dismiss="modal">Cancel
                                    </md-button>
                                </div>
                            </div>

                        </form>

                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="view_attached_file" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document" style="width:70%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabelss">
                            Attached File
                            <button type="button" class="close" data-dismiss="modal"
                                    ng-click="close_pr_popup()"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="body">
                        <div class="row table-responsive">
                            <div class="col-md-12 col-lg-12 col-sm-12">
                                <div class="row table-responsive">
                                    <div class="col-md-12 col-lg-12 col-sm-12">
                                        <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                               md-progress="deferred">
                                            <thead class="header">
                                            <tr>
                                                <th>S.No</th>
                                                <th>Fine Name</th>
                                                <th>View File</th>
                                                <th>Download File</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr align="center"
                                                ng-repeat="file in ecf_all_files.slice(((currentPages-1)*itemsPerPages),((currentPages)*itemsPerPages)) | filter:search:strict">
                                                <td>{{((currentPages-1)*itemsPerPages)+$index+1}}
                                                </td>
                                                <td align="left">{{file.file_name}}</td>
                                                <td><span class="editlink material-icons"
                                                          ng-click="view_file(file)">insert_photo
                                                        </span>
                                                </td>
                                                <td>
                                                    <md-button class="md-icon-button md-primary"
                                                               aria-label="Settings"
                                                               href="common_s3_file_download?filename={{file.file_name}}">
                                                        <md-icon>get_app</md-icon>
                                                        <md-tooltip>Download File</md-tooltip>
                                                    </md-button>
                                                </td>
                                            </tr>
                                            </tbody>
                                            <tfoot>
                                            <tr align="center">
                                                <td colspan="3">
                                                    <ul uib-pagination
                                                        total-items="ecf_all_files.length"
                                                        ng-model="currentPages"
                                                        max-size="maxSizes"
                                                        class="pagination-sm"
                                                        boundary-links="true"
                                                        items-per-page="itemsPerPages"></ul>
                                                </td>
                                                <td colspan="2">
                                                    Total Count:{{ecf_all_files.length}}
                                                </td>
                                            </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-offset-6">
                                <md-button class="md-raised md-warn" value="close" data-dismiss="modal"
                                           aria-label="Close">Cancel
                                </md-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="show_file" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document" style="width:90%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="view_files">
                            {{url_data[0].file_name}}
                            <button type="button" class="close" data-dismiss="modal"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <br/>
                    <div class="body">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-12" align="center">
                                    <img src="{{url_datas[0].file_path}}"
                                         alt="{{url_datas[0].file_name}}"
                                         class="img-thumbnail"
                                         align="center"
                                         ng-show="extension!='pdf'">
                                    <hr/>
                                </div>
                                <iframe src="{{pdf_file_url_path}}" frameborder="0"
                                        height="600px" width="97%" ng-show="extension=='pdf'"></iframe>

                            </div>
                            <div class="row">
                                <div class="col-md-offset-6">
                                    <md-button class="md-raised md-warn" value="close" data-dismiss="modal"
                                               aria-label="Close">Cancel
                                    </md-button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="view_bscc_details" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document" style="width:70%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="ccbs_details">
                            BSCC Details
                            <button type="button" class="close" data-dismiss="modal"
                                    ng-click="close_pr_popup()"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="body">
                        <form class="modal-body popup-body" name="supplier" novalidate>
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div class="row table-responsive">
                                        <div class="col-md-12 col-lg-12 col-sm-12">
                                            <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                                   md-progress="deferred">
                                                <thead class="header">
                                                <tr>
                                                    <th>S.No</th>
                                                    <th>BS Name</th>
                                                    <th>CC Name</th>
                                                    <th>GL Number</th>
                                                    <th>BSCC Detail Amount</th>
                                                    <th>BSCC Percentage</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr align="center"
                                                    ng-repeat="debit_bscc in debit_ccbs.slice(((currentPages_d-1)*itemsPerPages_s),((currentPages_d)*itemsPerPages_d)) | filter:search:strict">
                                                    <td>{{((currentPages_d-1)*itemsPerPages_d)+$index+1}}
                                                    </td>
                                                    <td>{{debit_bscc.tbs_name}}</td>
                                                    <td>{{debit_bscc.tcc_name}}</td>
                                                    <td>{{debit_bscc.ccbsdtl_glno}}</td>
                                                    <td>{{debit_bscc.ccbsdtl_amount}}</td>
                                                    <td>{{debit_bscc.ccbsdtl_percent}}</td>
                                                </tr>
                                                </tbody>
                                                <tfoot>
                                                <tr align="center">
                                                    <td colspan="5">
                                                        <ul uib-pagination
                                                            total-items="debit_ccbs.length"
                                                            ng-model="currentPages_d"
                                                            max-size="maxSizes_d"
                                                            class="pagination-sm"
                                                            boundary-links="true"
                                                            items-per-page="itemsPerPages_d"></ul>
                                                    </td>
                                                    <td colspan="2">
                                                        Total Count:{{debit_ccbs.length}}
                                                    </td>
                                                </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-offset-5">
                                    <md-button class="md-raised" value="close"
                                               aria-label="Close" data-dismiss="modal">Cancel
                                    </md-button>
                                </div>
                            </div>
                            <hr>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

{% endverbatim %}
<style>
.title-color{
    color:#2159A6;
}

















</style>

<script>
    var app=angular.module('makersummary',['ngMaterial','ui.bootstrap','AppCommon']).config(function($httpProvider) {
    $httpProvider.defaults.xsrfCookieName = 'csrftoken';
    $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';

});
app.run(function($mdDateLocale, $filter) {
    $mdDateLocale.formatDate = function(date) {
        return $filter('date')(date, "dd-MMM-yyyy");
    };
   });

app.controller('ctrlsummary', ['$scope', '$filter', '$mdDateLocale', 'invoice_service', '$window', '$mdDialog', '$element','$http','$sce',
    function($scope, $filter, $mdDateLocale, invoice_service, $window, $mdDialog, $element,$http,$sce) {

    $element.find('input').on('keydown', function(ev) {
        ev.stopPropagation();
    });

    $scope.currentPage = 1;
    $scope.maxSize = 3;
    $scope.itemsPerPage = 10;

    $scope.commodity_show=1;

    $scope.currentPages = 1;
    $scope.maxSizes = 3;
    $scope.itemsPerPages = 10;

    $scope.currentPages_d = 1;
    $scope.maxSizes_d = 3;
    $scope.itemsPerPages_d = 10;

    $scope.minDate=new Date();

    $scope.loading = function() {
        $mdDialog.show({
            templateUrl: 'loaderSpinner',
            parent: angular.element(document.body),
            clickOutsideToClose: false
        });
    };

    $scope.loading_view_attached_file = function() {
        $mdDialog.show({
            templateUrl: 'loaderSpinner',
            parent: angular.element(document.getElementById('view_attached_file')),
            clickOutsideToClose: false
        });
    };

    $scope.endloading = function() {
        $mdDialog.hide();
    };

    $scope.exact_mathch=[];
    $scope.without_supplier=[];
    $scope.without_invoice_amount=[];
    $scope.without_invoice_number=[];


    $scope.view_pop_up=function(value){
        modalshow('view_pop_up');
    }

    $scope.loading_transaction = function() {
        $mdDialog.show({
            templateUrl: 'loaderSpinner',
            parent: angular.element(document.getElementById('view_tran_details')),
            clickOutsideToClose: false
        });
    };


    var detail = JSON.parse(sessionStorage.getItem('today'));
    var td = detail.date;
    var employgid = detail.employee_gid;


    var header_details=JSON.parse(sessionStorage.getItem('ECF'));
    console.log(header_details);
    $scope.Header_gid=header_details.invoiceheader_gid;
    $scope.commodity_type=header_details.commodity_type;
    $scope.Commodity_gid=header_details.invoiceheader_commoditygid;
    $scope.type_of_page=header_details.type;
    $scope.main_status=header_details.main_status;
    $scope.status=header_details.status;
    $scope.screen=header_details.screen;
    $scope.apprver_view = false;

    if($scope.status == 'PENDING FOR APPROVAL' && $scope.screen =='Approval'){

      $scope.apprver_view = true;
    }
    if($scope.Header_gid!=0){
        summary($scope.Header_gid);

    }
    $scope.delmet_value = 0
    $scope.total_invoice_amount=0;
    $scope.total_credit_amount=0;
    $scope.total_debit_amount=0;
    function summary(Header_gid) {
        var datas={params:{"action":"GET","type":"INVOICE_DETAILS_EDIT", "filter":{"InvoiceHeader_Gid":Header_gid}}};
<!--        $scope.loading();-->
        var summary = invoice_service.get_invoice_billenty_summary(datas);
        summary.then(function(result) {
            $scope.endloading();
            if(result.data.MESSAGE=="ERROR_OCCURED"){
                        alert(JSON.stringify(result.data.DATA));
            }
            $scope.invoice_summary = result.data.INVOICE;
            $scope.credit_summary = result.data.CREDIT;
            $scope.debit_summary= result.data.DEBIT;
            for(i=0;i<$scope.invoice_summary.length;i++){
                $scope.total_invoice_amount+=$scope.invoice_summary[i].invoicedetails_totalamt;
            }
            for(j=0;j<$scope.credit_summary.length;j++){
                $scope.total_credit_amount+=$scope.credit_summary[j].credit_amount;
            }
            for(k=0;k<$scope.debit_summary.length;k++){
                $scope.total_debit_amount+=$scope.debit_summary[k].debit_amount;
            }
            $scope.total_invoice_amount = $scope.total_invoice_amount.toFixed(2);
            $scope.total_credit_amount = $scope.total_credit_amount.toFixed(2);
            $scope.total_debit_amount = $scope.total_debit_amount.toFixed(2);
        },
        function(err) {
            alert('No data!.');
        }).finally($scope.endloading);
    }


$scope.approval_emp = 0 ;

    $scope.Moveto_approver = function(){
      if($scope.approval_emp != 0){
           var json = {"Invoice_Header_Gid": $scope.Header_gid, "Status": "PENDING FOR APPROVAL","Remark":$scope.remark,
                       "Individual_approval":"Y","Emp_id":$scope.approval_emp};
            $scope.loading();
            var appr_set = invoice_service.approvalset($scope.checker_data,json);
            appr_set.then(function(result) {
                $scope.endloading();
                if(result.data.MESSAGE=="ERROR_OCCURED"){
                        alert(JSON.stringify(result.data.DATA));
                }
                if (result.data == 'SUCCESS') {
                    alert("Successfully Updated");
                    $window.location.href = "BranchExp/Br_GrnApproval/";
                }
                else{
                    alert(result.data);
                }
            },
            function(err) {
                alert('Not Updated!.');
            }).finally($scope.endloading);
       }else{
        alert("Choose Approver")
       }
    }


    $scope.approv_set=function(status){
        if($scope.checker_data[0].invoiceheader_employeegid!=employgid){
            if(status=="APPROV"){
                var json = {"Invoice_Header_Gid": $scope.Header_gid, "Status": "APPROVED","Remark":$scope.remark,
                "IsBranchexp":"Y","IsGST":$scope.checker_data[0].IS_GST,"invoice_data":$scope.checker_data[0]};
            }
            else if(status=="REJECT"){
                var json = {"Invoice_Header_Gid": $scope.Header_gid, "Status": "REJECTED",
                "IsBranchexp":"Y","IsGST":$scope.checker_data[0].IS_GST,
                "Remark":$scope.remark,"invoice_data":$scope.checker_data[0]};
            }
            $scope.loading();
            var dedube_summary = invoice_service.approvalset($scope.checker_data,json);
            dedube_summary.then(function(result) {

                if(result.data.MESSAGE=="ERROR_OCCURED"){
                        alert(JSON.stringify(result.data.DATA));
                }
                if (result.data == 'SUCCESS') {
                    alert("Successfully Updated");
                    $window.location.href = "BranchExp/Br_GrnApproval/";
                }
                else{
                     if(result.data=="Email_Not_Send"){
                        alert("Approved Successfully. Email Not Send...");
                        $window.location.href = "BranchExp/Br_GrnApproval/";
                    }
                    else{
                    alert(JSON.stringify(result.data));
                    }

                }
            },
            function(err) {
                alert('Not Updated!.');
            }).finally($scope.endloading);
        }
        else{
            alert("Your Can't Be an Fianl Approver");

        }
    }

    var ecf_header = invoice_service.get_head_data($scope.Header_gid,$scope.status);
    ecf_header.then(function(result) {

        $scope.checker_data = result.data;
        console.log($scope.checker_data);
        if(result.data.MESSAGE=="ERROR_OCCURED"){
            alert(JSON.stringify(result.data.DATA));
        }
        Delmat_limit();
        $scope.endloading();
         },
        function(err) {
            alert('No data!.');
    }).finally($scope.endloading);




     //Delmat Employee Limit
     function Delmat_limit (){
        if($scope.Commodity_gid!=undefined){
            if($scope.commodity_type=="Contractual Commodity"){
                $scope.main_status = 1;
            }
            else{
                var datas={params:{"action":"limit","type":"DELMAT_EMPLOYEE_LIMIT",
                          "filter":{"commodity_gid":$scope.Commodity_gid,"employee_gid":employgid,
                          "employee_name":"","delmat_type":"BRANCH_EXP"}}};
<!--                $scope.loading();-->
                var delmet_data = invoice_service.get_delmet_data(datas);
                delmet_data.then(function(result) {
                    if(result.data.MESSAGE=="ERROR_OCCURED"){
                        alert(JSON.stringify(result.data.DATA));
                    }
                   if(result.data[0] != undefined){
                       $scope.delmet_value = result.data[0].delmat_limit;

                       if($scope.delmet_value >=  $scope.checker_data[0].invoiceheader_amount){

                        $scope.main_status = 1;
                       }else{
                           $scope.main_status = 0;
                       }
                   }else{
                     $scope.main_status = 0;
                   }
                 },
                function(err) {
                  alert(result);
                }).finally($scope.endloading);
            }

        }
     }


     //Delmat
     $scope.srchname = "";

         $scope.getemployee_srch= function(searchText) {
            var senddata={params:{"action":"limit","type":"DELMAT",
              "filter":{"commodity_gid":$scope.Commodity_gid,"employee_gid":"","employee_code":$scope.emp_code,
              "employee_name":searchText,"delmat_type":"ecf","Limit_Start":0,"Limit_End":30}}};
            return $http.post(Appname + '/get_delmat_data/' , senddata).then(function(data) {
            console.log(data.data);
                return data.data;
              });
          };

    $scope.employee_change =function(emp){
           $scope.approval_emp = emp.employee_gid;

     }

     $scope.view_tran_details=function(){
        var datas={params:{"action":"GET","type":"ECF_TRANS_GET",
            "filter":{"Ref_Name":"ECF_INVOICE","RefTable_Gid":$scope.Header_gid}}};
         $scope.loading();
         var ecf_tran_status = invoice_service.get_approval_summary(datas);
         ecf_tran_status.then(function(result) {
                if(result.data.MESSAGE=="ERROR_OCCURED"){
	                alert(JSON.stringify(result.data.DATA));
                }
                $scope.ecf_tran_summary = result.data;
                console.log($scope.ecf_tran_summary);
                modalshow('view_tran_details');
         },
         function(err) {
            alert('No data!.');
         }).finally($scope.endloading);

    }

     $scope.custom_search=function(){
            modalshow('custom_search');
     }

     $scope.view_attached_file=function(){
        var datas={params:{"action":"GET","type":"FILE_DETAIL",
            "filter":{"file_reftablegid":$scope.Header_gid,"ref_name":"ECF_INVOICE"}}};
         $scope.loading();
         var ecf_file_data = invoice_service.get_approval_summary(datas);
         ecf_file_data.then(function(result) {

                $scope.ecf_all_files = result.data;
                 modalshow('view_attached_file');
         },
         function(err) {
            alert('No data!.');
         }).finally($scope.endloading);

     }

     $scope.clear_emp=function(){
        $scope.emp_code;
     }

     $scope.view_file=function(file_list){
        var datas={"file_data":[file_list]};
         $scope.loading_view_attached_file();
         var generated_urls = invoice_service.get_generated_url_data(datas);
         generated_urls.then(function(result) {
                $scope.url_datas = result.data;
                $scope.file_url_path=$scope.url_datas[0].file_path;
                var final_file_name=$scope.url_datas[0].file_name;
                $scope.extension=final_file_name.substr(final_file_name.lastIndexOf('.')+1);
                if($scope.extension=="pdf"){
                    complete_url ='http://docs.google.com/gview?url=' + encodeURIComponent($scope.file_url_path) + '&embedded=true';
                    $scope.pdf_file_url_path = $sce.trustAsResourceUrl(complete_url);
                }
                 modalshow('show_file');
         },
         function(err) {
            alert('No data!.');
         }).finally($scope.endloading);
     }

     $scope.trustAsHtml = function(html) {
      return $sce.trustAsHtml(html);
    }



    $scope.debit_execute=0;
     $scope.find_debit=function(){
        if($scope.debit_execute==0){
                $scope.debit_execute=1;
            var datas={params:{"action":"GET","type":"DEBIT_DETAILS", "filter":{"InvoiceHeader_Gid":$scope.Header_gid}}};
            $scope.loading();
            var summarys = invoice_service.get_invoice_billenty_summary(datas);
            summarys.then(function(result) {
                $scope.endloading();
                if(result.data.MESSAGE=="ERROR_OCCURED"){
                            alert(JSON.stringify(result.data.DATA));
                }
                $scope.debit_summary_new= result.data;

            },
            function(err) {
                alert('No data!.');
            }).finally($scope.endloading);
        }
     }
    $scope.credit_execute=0;
     $scope.find_credit=function(){
        if($scope.credit_execute==0){
            $scope.credit_execute=1;
            var datas={params:{"action":"GET","type":"CREDIT_DETAILS", "filter":{"InvoiceHeader_Gid":$scope.Header_gid}}};
            $scope.loading();
            var credit_summarys = invoice_service.get_invoice_billenty_summary(datas);
            credit_summarys.then(function(result) {
                $scope.endloading();
                if(result.data.MESSAGE=="ERROR_OCCURED"){
                            alert(JSON.stringify(result.data.DATA));
                }
                $scope.credit_summary_new= result.data;
            },
            function(err) {
                alert('No data!.');
            }).finally($scope.endloading);
        }
     }

     $scope.view_emp=function(emp_gid){
        debugger;
        $scope.emp_details=[];
        var datas={params:{"action":"GET","type":"EMP_DETAILS", "filter":{"employee_gid":emp_gid}}};
            $scope.loading_transaction();
            var summarys = invoice_service.get_approval_summary(datas);
            summarys.then(function(result) {
                $scope.endloading();
                if(result.data.MESSAGE=="ERROR_OCCURED"){
                    alert(JSON.stringify(result.data.DATA));
                }
                $scope.emp_details= result.data;
                console.log($scope.emp_details);

            },
            function(err) {
                alert('No data!.');
            }).finally($scope.endloading);

     }

     $scope.view_commodity=function(crnumber){
     debugger;
        var datas={params:{"action":"GET","type":"COMMODITY_DATA",
         "filter":{"InvoiceHeader_Crno":crnumber}}};
            $scope.loading();
            var commodity_datas = invoice_service.get_invoice_billenty_summary(datas);
            commodity_datas.then(function(result) {
                $scope.endloading();
                if(result.data.MESSAGE=="ERROR_OCCURED"){
                   alert(JSON.stringify(result.data.DATA));
                }
                $scope.commodity_show=0;
                $scope.commodity_data= result.data;
                console.log($scope.commodity_data);

            },
            function(err) {
                alert('No data!.');
            }).finally($scope.endloading);

     }

     $scope.debit_ccbs=[];
     $scope.view_bscc=function(debit_gid){
        $scope.debit_ccbs=[];
        var datas={params:{"action":"GET","type":"CCBS_DETAILS", "filter":{"Debit_Gid":debit_gid}}};
            $scope.loading();
            var summarys = invoice_service.get_invoice_billenty_summary(datas);
            summarys.then(function(result) {
                $scope.endloading();
                if(result.data.MESSAGE=="ERROR_OCCURED"){
                    alert(JSON.stringify(result.data.DATA));
                }
                $scope.debit_ccbs= result.data;
                modalshow('view_bscc_details');
            },
            function(err) {
                alert('No data!.');
            }).finally($scope.endloading);

     }



}]);
app.service("invoice_service", function ($http) {

    this.get_invoice_billenty_summary=function(data){
        var response=$http.post(Appname+"/ECF_Process_get/",data);
        return response;
    }

    this.get_head_datas = function (header_gid) {
        var response=$http.post(Appname+"/APInvoice_get/",{params:{"action":"INVOICE_MAKER_SUMMARY_","ponumber":"","supplier_gid":0,"inwarddetail_gid":0,"inwardheader_gid":header_gid,"status":"NEW,REPROCESS"}});
        return response;
    }


    this.approvalset=function(header_json,status_json){
        var response=$http.post(Appname+"/ECFInvoiceheader_set/",{params:{"action":"UPDATE","type":"STATUS","header_json":header_json,"debit_json":{},"detail_json":{},"status_json":status_json}});
        return response;
    }

    this.get_head_data = function (header_gid,statis) {
        var response=$http.post(Appname+"/ECFInvoice_get/",{params:{"action":"INVOICE_MAKER_SUMMARY","ecfnumber":"","supplier_gid":0,"inwarddetail_gid":0,"inwardheader_gid":header_gid,"status":status}});
        return response;
    }

    this.get_approval_summary=function(data){
        var response=$http.post(Appname+"/get_onward_data/",data);
        return response;
    }

    this.get_delmet_data=function(data){
        var response=$http.post(Appname+"/get_delmat_data/",data);
        return response;
    }

    this.get_generated_url_data=function(data){
        var response=$http.post(Appname+"/common_s3_file_url_generate/",data);
        return response;
    }

});










</script>
{% endblock %}