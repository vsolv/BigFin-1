{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %} Create Customer {% endblock %}
{% block content %}
{% verbatim %}
<div class="maincontent">
    <div ng-app="appcustcrt" ng-controller="ctrlcustcrt" class="container container1">
        <div class="row">
            <div class="row-header col-lg-12 col-sm-12">
                <h4><strong>{{title}} Customer </strong></h4>
            </div>
        </div>
        <md-subheader class="md-accent">Customer Details</md-subheader>
        <form name="demoForm" novalidate>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-2 col-sm-9 col-xs-9">
                        <md-autocomplete ng-disabled="Customer_disable" md-no-cache="true"
                                         md-floating-label="Customer Group"
                                         md-selected-item="selectedcustgrpp"
                                         md-search-text="searchText"
                                         md-selected-item-change="namechange(y.customergroup_name)"
                                         md-items="y in querySearch(searchText)"
                                         md-item-text="y.customergroup_name"
                                         md-min-length=0
                                         md-clear-button="!Customer_disable">
                            <md-item-template>
                                <span md-highlight-text="searchText"> {{y.customergroup_name}} </span>
                            </md-item-template>
                            <md-not-found>
                                No product matching "{{searchText}}" were found.
                            </md-not-found>
                        </md-autocomplete>
                        <!--<md-select ng-model="selectedcustgrp" ng-required="true" ng-change="custgrp(selectedcustgrp)">-->
                        <!--<md-option value=0><em>&#45;&#45;Select&#45;&#45;</em></md-option>-->
                        <!--<md-option ng-repeat="y in custgrp" ng-value="y.customergroup_gid">{{ y.customergroup_name-->
                        <!--}}-->
                        <!--</md-option>-->
                        <!--</md-select>-->

                    </div>
                    <div class="col-md-1 col-sm-3 col-xs-3 text-center">
                        <md-button class="md-icon-button md-primary" aria-label="Settings"
                                   ng-click="modal_open(selectedcustgrp)">
                            <md-icon>add</md-icon>
                            <md-tooltip>Add Customer Group</md-tooltip>
                        </md-button>
                    </div>

                    <div class="col-md-3 col-sm-12 col-xs-12">
                        <md-input-container class="md-block inputcontainer">
                            <label>Customer Name</label>
                            <input ng-model="name" ng-blur="custcode(selectedcustgrp,name);billingname=name" capitalize
                                   maxlength="60"
                                   ng-disabled="edit_disabled" ng-pattern="/^([A-Za-z0-9 @&(\[\])-/]){3,}]*$/"
                                   required/>
                        </md-input-container>
                    </div>
                    <div class="col-md-3 col-sm-12 col-xs-12">
                        <md-input-container class="md-block inputcontainer">
                            <label>Customer Code</label>
                            <input ng-model="code" maxlength="16" ng-disabled="true" capitalize required/>
                        </md-input-container>
                    </div>
                    <div class="col-md-3 col-sm-12 col-xs-12">
                        <md-input-container class="md-block inputcontainer">
                            <label>Billing Name</label>
                            <input ng-model="billingname" capitalize maxlength="60"
                                   ng-pattern="/^([A-Za-z0-9 @&(\[\])-/]){3,}]*$/"
                                   required/>
                        </md-input-container>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-3 col-sm-12 col-xs-12">
                        <md-input-container class="md-block inputcontainer">
                            <label>Customer Category</label>
                            <md-select ng-model="selectedcustcate" md-on-close="clearSearchTerm()"
                                       data-md-container-class="selectdemoSelectHeader" ng-required="true">
                                <md-select-header class="demo-select-header">
                                    <input ng-model="searchTerm" type="search"
                                           placeholder="Search for a Customer Category.."
                                           class="demo-header-searchbox md-text">
                                </md-select-header>
                                <md-optgroup label="Customer Category">
                                    <md-option ng-value="c.custcategory_gid" ng-repeat="c in custcate |
              filter:searchTerm">{{ c.custcategory_name}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Customer Type</label>
                            <md-select ng-model="selectedcusttype" ng-required="true">
                                <md-optgroup label="Client Name">
                                    <md-option ng-repeat="c in custtype" ng-value="c.metadata_value">{{ c.metadata_value
                                        }}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Customer SaleMode</label>
                            <md-select ng-model="selectedcustsalem" ng-required="true">
                                <md-optgroup label="Customer SaleMode">
                                    <md-option ng-repeat="c in custsalemode" ng-value="c.metadata_gid">{{
                                        c.metadata_value}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Customer Subtype</label>
                            <md-select ng-model="subtype" md-on-close="clearSearchTerm()"
                                       data-md-container-class="selectdemoSelectHeader" ng-required="true">
                                <md-select-header class="demo-select-header">
                                    <input ng-model="searchTe" type="search"
                                           placeholder="Search for a Customer Subtype.."
                                           class="demo-header-searchbox md-text">
                                </md-select-header>
                                <md-optgroup label="Customer Subtype">
                                    <md-option ng-value="c.metadata_value" ng-repeat="c in custsubtype |
              filter:searchTe">{{c.metadata_value}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-3">

                        <md-input-container class="md-block inputcontainer">
                            <label>Customer Constitution</label>
                            <md-select ng-model="selectedcustconst" ng-required="true">
                                <md-optgroup label="Customer Constitution">
                                    <md-option ng-repeat="c in custconstitut" ng-value="c.metadata_gid">
                                        {{c.metadata_value}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Customer Size</label>
                            <md-select ng-model="selectedcustsize" ng-required="true">
                                <md-optgroup label="Customer Size">
                                    <md-option ng-repeat="c in custsize" ng-value="c.metadata_gid"> {{c.metadata_value}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Location</label>
                            <md-select ng-model="selectedloc" ng-change="location_clk(selectedloc)"
                                       md-on-close="clearSearchTerm()"
                                       data-md-container-class="selectdemoSelectHeader">
                                <md-select-header class="demo-select-header">
                                    <input ng-model="searchT" type="search" placeholder="Search for a Location.."
                                           class="demo-header-searchbox md-text">
                                </md-select-header>
                                <md-optgroup label="Location">
                                    <md-option ng-value="c.location_gid" ng-repeat="c in locationddl |
              filter:searchT">{{c.location_name}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Customer GST Number</label>
                            <input ng-model="GSTNo" maxlength="16" capitalize no-special-char/>
                            <span ng-hide="true" ng-model="GSTNo_gid"></span>
                        </md-input-container>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Landmark</label>
                            <input ng-model="lndmrk" maxlength="128" no-special-char/>
                            <span ng-hide="true" ng-model="mrklnd"></span>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Courier</label>
                            <md-select ng-model="selectedcourier" ng-required="true">
                                <md-optgroup label="Courier">
                                    <md-option ng-repeat="c in courierddl" ng-value="c.courier_gid">{{
                                        c.courier_name}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                </div>
            </div>
            <md-subheader class="md-accent">Location</md-subheader>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-4">
                        <md-input-container class="md-block inputcontainer">
                            <label>State</label>
                            <md-select ng-model="selectedlocState" ng-change="state_locclk(selectedlocState)"
                                       md-on-close="clearSearchTerm()"
                                       data-md-container-class="selectdemoSelectHeader">
                                <md-select-header class="demo-select-header">
                                    <input ng-model="search" type="search" placeholder="Search for a State.."
                                           class="demo-header-searchbox md-text">
                                </md-select-header>
                                <md-optgroup label="State">
                                    <md-option ng-value="c.state_gid" ng-repeat="c in locstate |
                                  filter:search">{{c.state_name}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div class="col-md-1">
                        <md-button class="md-icon-button md-primary" aria-label="Settings"
                                   ng-click="add_state()">
                            <md-icon>add</md-icon>

                        </md-button>
                    </div>
                    <div class="col-md-4">
                        <md-input-container class="md-block inputcontainer">
                            <label>District</label>
                            <md-select ng-model="selectedlocdist" ng-change="district_locclkl(selectedlocdist)"
                                       md-on-close="clearSearchTerm()"
                                       data-md-container-class="selectdemoSelectHeader">
                                <md-select-header class="demo-select-header">
                                    <input ng-model="searchTer" type="search" placeholder="Search for a District.."
                                           class="demo-header-searchbox md-text">
                                </md-select-header>
                                <md-optgroup label="District">
                                    <md-option ng-value="c.district_gid" ng-repeat="c in locdistrict |
              filter:searchTer">{{c.district_name}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>City</label>
                            <md-select ng-model="selectedloccity" ng-change="city_locclk(selectedloccity)"
                                       md-on-close="clearSearchTerm()"
                                       data-md-container-class="selectdemoSelectHeader">
                                <md-select-header class="demo-select-header">
                                    <input ng-model="searchTrm" type="search" placeholder="Search for a City.."
                                           class="demo-header-searchbox md-text">
                                </md-select-header>
                                <md-optgroup label="City">
                                    <md-option ng-value="c.city_gid" ng-repeat="c in loccity |
              filter:searchTrm">{{c.City_Name}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="col-md-4">
                        <md-input-container class="md-block inputcontainer">
                            <label>Pincode</label>
                            <input ng-model="locpcode" ng-pattern="pincodevalidation" ng-disabled="locationdisabled"
                                   required/>
                            <span ng-hide="true" ng-model="locpcodegid"></span>
                        </md-input-container>
                    </div>
                    <div class="col-md-1"></div>
                    <div class="col-md-4">
                        <md-input-container class="md-block inputcontainer">
                            <label>Cluster</label>
                            <md-select ng-model="selectedlocclst" ng-disabled="clusterdis"
                                       md-on-close="clearSearchTerm()"
                                       data-md-container-class="selectdemoSelectHeader" ng-required="true">
                                <md-select-header class="demo-select-header">
                                    <input ng-model="searcTerm" type="search" placeholder="Search for a Cluster.."
                                           class="demo-header-searchbox md-text">
                                </md-select-header>
                                <md-optgroup label="Cluster">
                                    <md-option ng-value="c.cluster_gid" ng-repeat="c in cluster |
              filter:searcTerm">{{c.cluster_name}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                </div>
            </div>
            <md-subheader class="md-accent">Address
            </md-subheader>
            <div class="row">
                <div class="col-md-12">
                    <md-checkbox class="md-primary" ng-disabled="disabled" ng-model="custgrp_add" ng-checked="check"
                                 ng-change="custgrpadd(selectedcustgrp,custgrp_add)" ng-hide="y.customergroup_gid">
                        Address as same as CustomerGroup
                    </md-checkbox>
                </div>
            </div>
            <div class="row" layout-xs="column" layout-padding="">
                <div class="col-md-12">
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Address Line 1</label>
                            <input ng-model="adline" capitalize maxlength="128" ng-disabled="addressdisabled" required/>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Address Line 2</label>
                            <input ng-model="adline2" capitalize maxlength="128" ng-disabled="addressdisabled"/>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Address Line 3</label>
                            <input ng-model="adline3" capitalize maxlength="128" ng-disabled="addressdisabled"/>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>State</label>
                            <md-select ng-model="selectedState" ng-change="state_clk(selectedState,'customer')"
                                       ng-disabled="addressdisabled" md-on-close="clearSearchTerm()"
                                       data-md-container-class="selectdemoSelectHeader">
                                <md-select-header class="demo-select-header">
                                    <input ng-model="serchTerm" type="search" placeholder="Search for a State.."
                                           class="demo-header-searchbox md-text">
                                </md-select-header>
                                <md-optgroup label="State">
                                    <md-option ng-value="c.state_gid" ng-repeat="c in stateddl |
              filter:serchTerm">{{c.state_name}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>District</label>
                            <md-select ng-model="selecteddistrict" ng-change="district_clk(selecteddistrict)"
                                       ng-disabled="addressdisabled" md-on-close="clearSearchTerm()"
                                       data-md-container-class="selectdemoSelectHeader">
                                <md-select-header class="demo-select-header">
                                    <input ng-model="sarchTerm" type="search" placeholder="Search for a State.."
                                           class="demo-header-searchbox md-text">
                                </md-select-header>
                                <md-optgroup label="State">
                                    <md-option ng-value="c.district_gid" ng-repeat="c in distritddl |
              filter:sarchTerm">{{c.district_name}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>City</label>
                            <md-select ng-model="selectedcity" ng-change="city_clk(selectedcity)"
                                       ng-disabled="addressdisabled" md-on-close="clearSearchTerm()"
                                       data-md-container-class="selectdemoSelectHeader">
                                <md-select-header class="demo-select-header">
                                    <input ng-model="srchTerm" type="search" placeholder="Search for a City.."
                                           class="demo-header-searchbox md-text">
                                </md-select-header>
                                <md-optgroup label="City">
                                    <md-option ng-value="c.city_gid" ng-repeat="c in city1 |
              filter:srchTerm">{{c.City_Name}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Pincode</label>
                            <input ng-model="pcode" ng-pattern="pincodevalidation" ng-disabled="addressdisabled"
                                   maxlength="6" minlength="6" numbers-only required/>
                        </md-input-container>
                    </div>
                </div>
            </div>
            <div class="row">
                <div ng-include="'empcntct'">Add Contact</div>
            </div>
        </form>
        <!--        col-md-offset-5-->
        <div class="col-md-12">

            <div class="col-md-2">
                <md-button class="md-raised custbutton" value="Edit" ng-click="supplier_update()" ng-if='update'
                >Treat As Supplier
                </md-button>

            </div>
            <div class="col-md-4 col-md-offset-3">
                <md-button class="md-raised custbutton" value="Edit" ng-click="edit()" ng-if='update'
                           ng-disabled="demoForm.$invalid">Update
                </md-button>


                <md-button class="md-raised custbutton" value="submit" ng-click="save()" ng-if="!update"
                           ng-disabled="demoForm.$invalid">Save
                </md-button>
                <md-button class="md-raised" value="close" ng-href="Custmer">Cancel</md-button>
            </div>
        </div>
        <!--customer group add-->
        <form name="createform">
            <div class="modal fade" id="custgrp_view" tabindex="-1" role="dialog" data-backdrop="static"
                 data-keyboard="false" style="height:auto;width:100%"
                 aria-labelledby="exampleModalLabel" aria-hidden="true">
                <form name="histroy" novalidate>
                    <div class="modal-dialog modal-lg modal-style" role="document">
                        <div class="modal-content">
                            <div class="header">
                                <div class="modal-header popup-header">
                                    <h5 class="modal-title" id="exampleModalLabel">
                                        <strong>{{custgrp_title}} Customer Group </strong>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </h5>
                                </div>
                            </div>
                            <div class="body">
                                <div class="modal-body popup-body">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="col-lg-6">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Customer Group Name</label>
                                                    <input ng-model="grpname" name="sampl"
                                                           ng-blur="cusgrp_code(grpname)"
                                                           capitalize
                                                           maxlength="60"
                                                           ng-pattern="/^([A-Za-z0-9 @&(\[\])-/]){3,}]*$/"
                                                           required/>
                                                </md-input-container>
                                            </div>
                                            <div class="col-lg-6">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Customer Group Code</label>
                                                    <input ng-model="grpcode" minlength="5" maxlength="16"
                                                           ng-disabled="true" capitalize
                                                           required/>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="col-lg-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Client Name</label>
                                                    <md-select ng-model="sltdclient" ng-required="true">
                                                        <md-option ng-value=0><em>--Select--</em></md-option>
                                                        <md-option ng-repeat="c in clientname"
                                                                   ng-value="c.client_gid">{{ c.client_name
                                                            }}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <md-subheader class="md-accent">Contact</md-subheader>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Contact Person 1</label>
                                                    <input ng-model="contper1" maxlength="64" capitalize
                                                           ng-pattern="/^[a-zA-Z\s]+$/">
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Designation</label>
                                                    <input ng-model="desig1" maxlength="64" capitalize
                                                           ng-pattern="/^[a-zA-Z\s]+$/">
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Mobile Number</label>
                                                    <input ng-model="mobile1" numbers-only maxlength="10" minlength="10"
                                                           ng-pattern="/^[0-9]{10}$/">
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>LandLine Number</label>
                                                    <input ng-model="landlin1" maxlength="12"
                                                           numbers-only/>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Contact Person 2</label>
                                                    <input ng-model="contper2" maxlength="64" capitalize
                                                           ng-pattern="/^[a-zA-Z\s]+$/">
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Designation</label>
                                                    <input ng-model="desig2" maxlength="64" capitalize
                                                           ng-pattern="/^[a-zA-Z\s]+$/">
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Mobile Number</label>
                                                    <input ng-model="mobile2" numbers-only maxlength="10" minlength="10"
                                                           ng-pattern="/^[0-9]{10}$/">
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>LandLine Number</label>
                                                    <input ng-model="landlin2" maxlength="12"
                                                           numbers-only/>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div ng-include="'empadrs'">
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <br>
                                            <div class="col-md-6 text-right" ng-if='custgrp_update'>
                                                <md-button class="md-raised custbutton" value="Edit"
                                                           ng-click="grpedit()" ng-disabled="createform.$invalid">
                                                    Update
                                                </md-button>
                                            </div>
                                            <div class="col-md-6 text-right">
                                                <md-button class="md-raised custbutton" value="submit"
                                                           ng-click="grpsave()"
                                                           ng-if="!custgrp_update"
                                                           ng-disabled="createform.$invalid">
                                                    Save
                                                </md-button>
                                            </div>
                                            <div class="col-md-6">
                                                <md-button class="md-raised" value="close" data-dismiss="modal"
                                                           aria-label="Close">Cancel
                                                </md-button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </form>
        <div class="row">
            <div class="col-lg-12 col-sm-12" ng-include="'state_add'">
            </div>
        </div>
    </div>
</div>
{% endverbatim %}
<style>
 .md-select-menu-container.md-active {
    z-index: 1060;
    }

</style>
<script>
   var myApp = angular.module('appcustcrt', ['ngMaterial','ngMessages','AppCommon'])
    .config(function($httpProvider) {
        $httpProvider.defaults.xsrfCookieName = 'csrftoken';
        $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
    });
        myApp.run(function($mdDateLocale, $filter) {
        $mdDateLocale.formatDate = function(date) {
            return $filter('date')(date, "dd-MMM-yyyy");
        };
    })
myApp.controller('ctrlcustcrt', ['$scope', 'testService', '$window', '$filter','$mdDialog', '$rootScope','$element','SerCommon',
 function($scope, testService, $window, $filter,$mdDialog, $rootScope,$element,SerCommon) {
       $element.find('input').on('keydown', function(ev) {
          ev.stopPropagation();
      });

    function textvalue(cust_gid) {
        te = $filter('filter')($scope.custgrp, {'customergroup_gid': cust_gid},true);
        $scope.searchText = JSON.stringify(te[0].customergroup_name).replace(/['"]+/g, '');
    }
   $scope.namechange = function(){
        if($scope.selectedcustgrpp == null){
            $scope.selectedcustgrp = 0;
        }
        else{
            $scope.selectedcustgrp = $scope.selectedcustgrpp.customergroup_gid;
        }
   }
    var cust = [];
    $scope.MobileValidation = /^[0-9]*$/;

    if (sessionStorage.getItem('cust_details') != null) {
        var customer_detail = JSON.parse(sessionStorage.getItem('cust_details'));
        cust_gid = customer_detail.cus_gid;
        $scope.update = customer_detail.view;
        <!--sessionStorage.clear()-->
        var customerdet = testService.getcustomer(cust_gid)
        customerdet.then(function(result) {
            $scope.edit_disabled=true;
            cust = JSON.parse(result.data);
            var cgid = cust[0].contact_gid;
            $scope.selectedcustgrp = cust[0].customer_custgroup_gid;
            $scope.Customer_disable = true;
            $scope.selectedcustcate = cust[0].customer_category_gid;
            $scope.name = cust[0].customer_name;
            $scope.code = cust[0].customer_code;
            $scope.selectedcusttype = cust[0].customer_type;
            $scope.subtype = cust[0].customer_subtype;
            $scope.selectedcustconst = cust[0].customer_constitution;
            $scope.selectedcustsalem = cust[0].customer_salemode;
            $scope.selectedcustsize = cust[0].customer_size;
            $scope.selectedloc = cust[0].customer_location_gid;
            $scope.location_clk(cust[0].customer_location_gid);
            $scope.GSTNo = cust[0].GST;
            $scope.GSTNo_gid = cust[0].taxdetails_gid;
            $scope.lndmrk = cust[0].customer_landmark;
            $scope.billingname = cust[0].customer_billingname;
            $scope.selectedcourier=cust[0].custcourier_couriergid;
            $scope.custcouier_gid=cust[0].custcourier_gid;
            $scope.add.dobb = $filter('date')(cust[0].Contact_DOB, "dd/MMM/yyyy");
            $scope.add.weddy = $filter('date')(cust[0].Contact_WD, "dd/MMM/yyyy");
            $scope.add.cntcttype = cust[0].Contact_contacttype_gid;
            $scope.add.prsnname = cust[0].Contact_personname;
            $scope.add.dsgntn = cust[0].Contact_designation_gid;
            $scope.add.lndlne = cust[0].Contact_landline;
            $scope.add.lndlne2 = cust[0].Contact_landline2;
            $scope.add.mobno = cust[0].Contact_mobileno;
            $scope.add.mobno2 = cust[0].Contact_mobileno2;
            $scope.add.mailid = cust[0].Contact_email;

            addget(cust[0].customer_add_gid);
        }, function() {
            alert('no data');
        });
    } else {
      $scope.edit_disabled=false;
    $scope.Customer_disable = false;
        $scope.update = '';
    }
    if ($scope.update) {
        $scope.title = 'Edit'
    } else {

        $scope.title = 'Create'
    }
    if ($scope.custgrp_update) {
        $scope.custgrp_title = 'Create'
    } else {
        $scope.custgrp_title = 'Edit'
    }
    $scope.LetterValidation = /^[a-zA-Z '']*$/;
    $scope.let_numValidation = /^[a-zA-Z0-9]*$/;
    $scope.phoneValidation = /^[0-9]{1,10}$/;
    <!--$scope.emailValidation = /[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$/;-->

    var custgrpddl = testService.getcustgrp()
    custgrpddl.then(function(result) {
            $scope.custgrp = [];
            $scope.custgrp = JSON.parse(result.data);
            if($scope.selectedcustgrp != undefined){
              textvalue($scope.selectedcustgrp)
             }
        }),
        function() {
            alert('no data');
        };
        $scope.querySearch = function(query) {
      te = $filter('filter')($scope.custgrp, {
         'customergroup_name': query
      });
      return te;
   }
    var custcateddl = testService.getcustcate()
    custcateddl.then(function(result) {
            $scope.custcate = [];
            $scope.custcate = JSON.parse(result.data);
        }),
        function() {
            alert('no data');
        };

    var loctddl = testService.getloctddl()
    loctddl.then(function(result) {
            $scope.locationddl = [];
            $scope.locationddl = JSON.parse(result.data);
        }),
        function() {
            alert('no data');
        };
    var sttddl = testService.getstateddl()
    sttddl.then(function(result) {
            $scope.stateddl = [];
            $scope.stateddl1 = [];
            $scope.stateddl1 = JSON.parse(result.data);

            $scope.stateddl = JSON.parse(result.data);
            $scope.locstate = JSON.parse(result.data);
            $scope.statedist=JSON.parse(result.data);
            for (var i = 0; i < 1; i++) {
                dta = {
                    "state_gid":0,
                    "state_name": "Add New State",
                }
                $scope.statedist.push(dta);
            }
        }),
        function() {
            alert('no data');
        };
    $scope.location_clk = function(location_gid) {
    if (location_gid != 0) {
        var loct = testService.getlocation(location_gid)
        loct.then(function(result) {
        $scope.locationdisabled = true;
                var loctn = [];
                loctn = JSON.parse(result.data);
                $scope.selectedlocState = loctn[0].city_state_gid;
                $scope.state_locclk($scope.selectedlocState);
                $scope.selectedlocdist = loctn[0].pincode_district_gid;
                $scope.district_locclkl($scope.selectedlocdist);
                $scope.selectedloccity = loctn[0].pincode_City_gid;
                $scope.city_locclk($scope.selectedloccity);
                $scope.locpcode = loctn[0].pincode_no;
                $scope.locpcodegid = loctn[0].pincode_gid;
                $scope.selectedlocclst = loctn[0].location_cluster_gid;
                if (loctn[0].location_cluster_gid > 0){
                    $scope.clusterdis = true;}
                 else {$scope.clusterdis = false;}
            }),
            function() {
                alert('no data');
            };
           }
          else
          {
          $scope.locationdisabled = false;
          $scope.selectedlocState = '';
          $scope.selectedlocdist = '';
          $scope.selectedloccity = '';
          $scope.locpcode = '';
          $scope.locpcodegid = '';
          $scope.selectedlocclst = '';
          }

    };

    $scope.state_locclk = function(state_gid) {
        var locdist = testService.getdistddl(state_gid)
        locdist.then(function(result) {
                $scope.locdistrict = [];
                $scope.locdistrict = JSON.parse(result.data);
                $scope.gstno($scope.code,state_gid,$scope.selectedloc);
            }),
            function() {
                alert('no data');
            };
    };

    $scope.district_locclkl = function(district_gid) {
        var loccty = testService.getcityddl(district_gid)
        loccty.then(function(result) {
                $scope.loccity = [];
                $scope.loccity = JSON.parse(result.data);
            }),
            function() {
                alert('no data');
            };
    };
    $scope.city_locclk = function(city_gid) {
        var locpincd = testService.getpincode(city_gid)
        locpincd.then(function(result) {
                var locpincde = [];
                locpincde = JSON.parse(result.data);
                $scope.locpcode = locpincde[0].pincode_no;
                $scope.locpcodegid = locpincde[0].pincode_gid;
            }),
            function() {
                alert('no data');
            };
    };
    $scope.state_clk = function(state_gid, type) {
        var distddl = testService.getdistddl(state_gid)
        distddl.then(function(result) {

                if (type == 'address') {
                    $scope.adistrictddl = [];
                    $scope.adistrictddl = JSON.parse(result.data);
                } else {
                    $scope.distritddl = [];
                    $scope.distritddl2 = [];
                    $scope.distritddl2 = JSON.parse(result.data);
                    $scope.distritddl1 = [];
                    $scope.distritddl = JSON.parse(result.data);
                    $scope.distritddl1 = JSON.parse(result.data);
                     for (var i = 0; i < 1; i++) {
                     dta = {
                    "district_gid":0,
                    "district_name": "Add New District",
                          }
                $scope.distritddl1.push(dta);

            }
            }
            }),
            function() {
                alert('no data');
            };
    };
    $scope.district_clk = function(district_gid, type) {
        var ctyddl = testService.getcityddl(district_gid)
        ctyddl.then(function(result) {
                if (type == 'address') {
                    $scope.acity1 = [];
                    $scope.acity1 = JSON.parse(result.data);
                } else {
                    $scope.city1 = [];
                     $scope.city2 = [];
                    $scope.city1 = JSON.parse(result.data);
                    $scope.city2 = JSON.parse(result.data);
                     for (var i = 0; i < 1; i++) {
                     dta = {
                            "city_gid":0,
                            "City_Name":"Add New City",
                           }
                           $scope.city2.push(dta);
                }
                }
            }),
            function() {
                alert('no data');
            };
    };
    $scope.city_clk = function(city_gid, type) {
        var pincd = testService.getpincode(city_gid)
        pincd.then(function(result) {
                if (type == 'address') {

                    var apincde = [];
                    apincde = JSON.parse(result.data);
                    $scope.add.pincode1 = apincde[0].pincode_no;
                } else {
                    var pincde = [];
                    pincde = JSON.parse(result.data);
                    $scope.pcode = pincde[0].pincode_no;
                }
            }),
            function() {
                alert('no data');
            };
    };
    var clust = testService.getcluster('ALL')
    clust.then(function(result) {
            $scope.cluster = [];
            $scope.cluster = JSON.parse(result.data);
        }),
        function() {
            alert('no data');
        };
    var size = testService.getdata('customer', 'customer_size')
    size.then(function(result) {

            $scope.custsize = [];
            $scope.custsize = JSON.parse(result.data);
        }),
        function() {
            alert('no data');
        };
    var constitut = testService.getdata('customer', 'customer_constitution')
    constitut.then(function(result) {

            $scope.custconstitut = [];
            $scope.custconstitut = JSON.parse(result.data);
        }),
        function() {
            alert('no data');
        };
    var client = testService.getclient('')
    client.then(function(result) {
            $scope.clientname = [];
            $scope.clientname = JSON.parse(result.data);
        }),
        function() {
            alert('no data');
        };

    var salemode = testService.getdata('customer', 'customer_salemode')
    salemode.then(function(result) {

            $scope.custsalemode = [];
            $scope.custsalemode = JSON.parse(result.data);
        }),
        function() {
            alert('no data');
        };
    var subtype = testService.getdata('customer', 'customer_subtype')
    subtype.then(function(result) {

            $scope.custsubtype = [];
            $scope.custsubtype = JSON.parse(result.data);
        }),
        function() {
            alert('no data');
        };
    var type = testService.getdata('customer', 'customer_type')
    type.then(function(result) {

            $scope.custtype = [];
            $scope.custtype = JSON.parse(result.data);
        }),
        function() {
            alert('no data');
        };

    function addget(add_gid) {
        var add = testService.getaddress(add_gid)
        add.then(function(result) {
                var address = [];
                address = JSON.parse(result.data);
                $scope.adline = address[0].address_1;
                $scope.adline2 = address[0].address_2;
                $scope.adline3 = address[0].address_3;
                $scope.selectedState = address[0].address_state_gid;

                $scope.state_clk($scope.selectedState);
                $scope.selecteddistrict = address[0].address_district_gid;
                $scope.district_clk($scope.selecteddistrict);
                $scope.selectedcity = address[0].address_city_gid;
                $scope.city_clk($scope.selectedcity);
                $scope.pcode = address[0].address_pincode;
            }),
            function() {
                alert('no data');
            };
    };

    function getCurrentFiscalYear() {
    var today = new Date();
    var curMonth = today.getMonth();
    var fiscalYr = "";
    if (curMonth > 3) { //
        var nextYr1 = (today.getFullYear() + 1).toString();
        fiscalYr = nextYr1  + "-"+'03'+"-" + '31';
    } else {
        var nextYr2 = today.getFullYear().toString();
       fiscalYr = nextYr2 + "-"+'03'+"-" + '31';
    }
    return fiscalYr;
    }
    $scope.save = function() {
        var city = $filter('filter')($scope.loccity, {
            city_gid: $scope.selectedloccity
        }, true);

        if (city == undefined) {
            alert("Please Fill All The Fields!.")
        }
        var cont_dob;
        if ($scope.add.dobb==undefined || $scope.add.dobb==''){
        cont_dob='';
        }else{
        cont_dob=formatDate($scope.add.dobb)
        }
        var cont_wd;
        if ($scope.add.weddy==undefined || $scope.add.weddy==''){
        cont_wd='';
        }else{
        cont_wd=formatDate($scope.add.weddy)
        }
        var details = {
            "custgrp_gid": $scope.selectedcustgrp,
            "custcate_gid": $scope.selectedcustcate,
            "cust_name": $scope.name,
            "cust_code": $scope.code,
            "cust_type": $scope.selectedcusttype,
            "cust_subtype": $scope.subtype,
            "custsize_gid": $scope.selectedcustsize,
            "custconstitut_gid": $scope.selectedcustconst,
            "custsalemode_gid": $scope.selectedcustsalem,
            "Location": $scope.selectedloc,
            "Address1": $scope.adline,
            "Address2": $scope.adline2,
            "Address3": $scope.adline3,
            "state": $scope.selectedState,
            "district": $scope.selecteddistrict,
            "city": $scope.selectedcity,
            "pincode": $scope.pcode,
            "locstate": $scope.selectedlocState,
            "locdistrict": $scope.selectedlocdist,
            "loccity": city[0].City_Name,
            "locpincode": $scope.locpcode,
            "cluster": $scope.selectedlocclst,
            "pincodegid": $scope.locpcodegid,
            "GSTNO": $scope.GSTNo,
            "LNDMRK": $scope.lndmrk,
            "BILLINGANME":$scope.billingname,
            "COURIER":$scope.selectedcourier,
            "COURIER_fromdate":formatStringDate(new Date(),'yyyy-mm-dd'),
            "COURIER_todate":getCurrentFiscalYear(),
            "ContactType": $scope.add.cntcttype,
            "Personname": $scope.add.prsnname,
            "Designation": $scope.add.dsgntn,
            "Landline1": $scope.add.lndlne,
            "Landline2": $scope.add.lndlne2,
            "Mobilenum": $scope.add.mobno,
            "Mobilenum2": $scope.add.mobno2,
            "Emailid": $scope.add.mailid,
            "BirthDate": cont_dob,
            "Wedingday": cont_wd,
            "cust_courier_gid":0,
        };

         $scope.loading();
        var custdetail = testService.savedetail(details, 'Insert');
        custdetail.then(function(result) {
            if (result.data > 0) {
                alert("Inserted Succesfully");
                $window.location.href = "Custmer";
            } else {
                alert("Data Not Inserted.");
            }
        }, function(err) {
            alert('Data Not Inserted.');
        })
        .finally($scope.endloading);
    };
    $scope.edit = function() {
        var city = $filter('filter')($scope.loccity, {
            city_gid: $scope.selectedloccity
        }, true);
        var cont_dob;
        if ($scope.add.dobb==undefined || $scope.add.dobb==''){
        cont_dob='';
        }else{
        cont_dob=formatDate(new Date($scope.add.dobb))
        }
        var cont_wd;
        if ($scope.add.weddy==undefined || $scope.add.weddy==''){
        cont_wd='';
        }else{
        cont_wd=formatDate(new Date($scope.add.weddy))
        }
        var editdetails = {
             "contact_gid": cust[0].contact_gid,
            "custgrp_gid": $scope.selectedcustgrp,
            "custcate_gid": $scope.selectedcustcate,
            "cust_name": $scope.name,
            "cust_code": $scope.code,
            "cust_type": $scope.selectedcusttype,
            "cust_subtype": $scope.subtype,
            "custsize_gid": $scope.selectedcustsize,
            "custconstitut_gid": $scope.selectedcustconst,
            "custsalemode_gid": $scope.selectedcustsalem,
            "Location": $scope.selectedloc,
            "Address1": $scope.adline,
            "Address2": $scope.adline2,
            "Address3": $scope.adline3,
            "state": $scope.selectedState,
            "district": $scope.selecteddistrict,
            "city": $scope.selectedcity,
            "pincode": $scope.pcode,
            "locstate": $scope.selectedlocState,
            "locdistrict": $scope.selectedlocdist,
            "loccity": city[0].City_Name,
            "locpincode": $scope.locpcode,
            "cluster": $scope.selectedlocclst,
            "pincodegid": $scope.locpcodegid,
            "Address_gid": cust[0].customer_add_gid,
            "cust_gid": cust_gid,
            "GSTNO": $scope.GSTNo,
            "LNDMRK": $scope.lndmrk,
            "BILLINGANME": $scope.billingname,
            "GSTNO_gid": $scope.GSTNo_gid,
            "ContactType": $scope.add.cntcttype,
            "Personname": $scope.add.prsnname,
            "Designation": $scope.add.dsgntn,
            "Landline1": $scope.add.lndlne,
            "Landline2": $scope.add.lndlne2,
            "Mobilenum": $scope.add.mobno,
            "Mobilenum2": $scope.add.mobno2,
            "Emailid": $scope.add.mailid,
            "BirthDate": cont_dob,
            "Wedingday": cont_wd,
             "COURIER":$scope.selectedcourier,
             "cust_courier_gid":$scope.custcouier_gid,
             "COURIER_fromdate":formatStringDate(new Date(),'yyyy-mm-dd'),
            "COURIER_todate":getCurrentFiscalYear(),
        };
        $scope.loading();
        var custeditdtl = testService.updatedetail(editdetails, 'Update');
        custeditdtl.then(function(result) {
            if (result.data === "SUCCESS") {
                alert("Updated Succesfully");
                $window.location.href = "Custmer";
            } else {
                alert("Data Not Updated");
            }
        }, function(err) {
            alert("Data Not Updated");
        }).finally($scope.endloading);
    };

    $scope.supplier_update=function(){
    var supplier_detail = {
            "custgrp_gid": $scope.selectedcustgrp,
             "custgrp_name":$scope.searchText,
        };
         var supplier = testService.supplier_update_det(supplier_detail,'SUPP_INSERT')
        supplier.then(function(result) {

            if (result.data === "SUCCESS") {
                alert("Supplier Created");
                $window.location.href = "customercreate";
            } else {    
                alert("Data Not Updated");
            }
        }, function(err) {
            alert('Data Not Updated');
        });
    };

    $scope.modal_open = function(custgrp_gid) {
        if ((custgrp_gid == undefined) || (custgrp_gid == 0)) {
                $scope.custgrp_update = true;
                $scope.custgrp_title = 'Create'
        }
        else {
                $scope.custgrp_update = false;
                $scope.custgrp_title = 'Edit'
        }
        var eaddrsttddl = testService.getstateddl()
        eaddrsttddl.then(function(result) {
                $scope.stateddl = [];
                $scope.stateddl = JSON.parse(result.data);
            }),
            function() {
                alert('no data');
            };
        $scope.pinchange = function(pincode, type) {
            var pincd = testService.getpincodeall(pincode)
            pincd.then(function(result) {
                    if (type == 'address') {
                        var apincde = [];
                        apincde = JSON.parse(result.data);
                        $scope.add.addselectedstate = apincde[0].city_state_gid;

                        $scope.state_clk($scope.add.addselectedstate, 'address');
                        $scope.add.addselecteddistrict = apincde[0].pincode_district_gid;
                        $scope.district_clk($scope.add.addselecteddistrict, 'address');
                        $scope.add.addselectedcity = apincde[0].pincode_City_gid;

                        $scope.add.pincode1 = apincde[0].pincode_no;
                    }
                }),
                function() {
                    alert('no data');
                };
        };
        if (custgrp_gid > 0) {
             $scope.custgrp_update = true;
             var custgrpdtl = testService.get_custgrp(custgrp_gid)
             custgrpdtl.then(function(result) {
                    ecustgrp = JSON.parse(result.data);
                    $scope.grpname = ecustgrp[0].customergroup_name;
                    $scope.grpcode = ecustgrp[0].customergroup_code;
                    $scope.sltdclient = ecustgrp[0].customergroup_clientgid;
                    $scope.contper1 = ecustgrp[0].customergroup_cpname;
                    $scope.desig1 = ecustgrp[0].customergroup_cpdesignation;
                    $scope.mobile1 = ecustgrp[0].customergroup_cpmobileno;
                    $scope.landlin1 = ecustgrp[0].customergroup_cplandline;
                    $scope.contper2 = ecustgrp[0].customergroup_cpname2;
                    $scope.desig2 = ecustgrp[0].customergroup_cpdesignation2;
                    $scope.mobile2 = ecustgrp[0].customergroup_cpmobileno2;
                    $scope.landlin2 = ecustgrp[0].customergroup_cplandline2;
                    eaddget(ecustgrp[0].customergroup_add_gid);
                    $scope.cust_grpname= $scope.grpname;
                }),
                function() {
                    alert('no data');
                };
            modalshow('custgrp_view');
        } else {
            $scope.custgrp_update = false;
            $scope.grpname = '';
            $scope.createform.$setPristine();
            $scope.createform.$setUntouched();
            $scope.grpcode = '';
            $scope.sltdclient = '';
            $scope.contper1 = '';
            $scope.desig1 = '';
            $scope.mobile1 = '';
            $scope.landlin1 = '';
            $scope.contper2 = '';
            $scope.desig2 = '';
            $scope.mobile2 = '';
            $scope.landlin2 = '';
            $scope.add.addline = '';
            $scope.add.addline2 = '';
            $scope.add.addline3 = '';
            $scope.add.pincode1 = '';
            $scope.add.addselecteddistrict = '';
            $scope.add.addselectedcity = '';
            $scope.add.addselectedstate = '';
            modalshow('custgrp_view');
        }
    }
    $scope.add=[];
    $scope.grpsave = function() {
        var custgrpdet = {
            "custgrp_name": $scope.grpname,
            "custgrp_code": $scope.grpcode,
            "custgrp_cpname1": $scope.contper1,
            "custgrp_desig1": $scope.desig1,
            "custgrp_mobileno1": $scope.mobile1,
            "custgrp_landline1": $scope.landlin1,
            "custgrp_cpname2": $scope.contper2,
            "custgrp_desig2": $scope.desig2,
            "custgrp_mobileno2": $scope.mobile2,
            "custgrp_landline2": $scope.landlin2,
            "grpclient_gid":$scope.sltdclient,
            "Address1": $scope.add.addline,
            "Address2": $scope.add.addline2,
            "Address3": $scope.add.addline3,
            "state": $scope.add.addselectedstate,
            "district": $scope.add.addselecteddistrict,
            "city": $scope.add.addselectedcity,
            "pincode": $scope.add.pincode1,
        };
        var custgrpdetail = testService.savegrpdetail(custgrpdet, 'Insert');
        custgrpdetail.then(function(result) {
            if (result.data > 0) {
                alert("Inserted Succesfully");
                $window.location.href = "customercreate";
            } else {
                alert("Data Not Inserted");
            }
        }, function(err) {
            alert('Data Not Inserted');
        });
    };
    function eaddget(add_gid) {
        var eadd = testService.getaddress(add_gid)
        eadd.then(function(result) {
                var eaddress = [];
                eaddress = JSON.parse(result.data);
                $scope.add.addline = eaddress[0].address_1;
                $scope.add.addline2 = eaddress[0].address_2;
                $scope.add.addline3 = eaddress[0].address_3;
                $scope.add.addselectedstate = eaddress[0].address_state_gid;
                $scope.state_clk($scope.add.addselectedstate, 'address');
                $scope.add.addselecteddistrict = eaddress[0].address_district_gid;
                $scope.district_clk($scope.add.addselecteddistrict, 'address');
                $scope.add.addselectedcity = eaddress[0].address_city_gid;
                $scope.city_clk($scope.add.addselectedcity, 'address');
                $scope.add.pincode1 = eaddress[0].address_pincode;
            }),
            function() {
                alert('no data');
            };
    };

    $scope.grpedit = function() {
        var city = $filter('filter')($scope.loccity, {
            city_gid: $scope.selectedloccity
        }, true);
        var grpeditdetails = {
            "custgrp_name": $scope.grpname,
            "custgrp_code": $scope.grpcode,
            "custgrp_cpname1": $scope.contper1,
            "custgrp_desig1": $scope.desig1,
            "custgrp_mobileno1": $scope.mobile1,
            "custgrp_landline1": $scope.landlin1,
            "custgrp_cpname2": $scope.contper2,
            "custgrp_desig2": $scope.desig2,
            "custgrp_mobileno2": $scope.mobile2,
            "custgrp_landline2": $scope.landlin2,
            "grpclient_gid":$scope.sltdclient,
            "Address1": $scope.add.addline,
            "Address2": $scope.add.addline2,
            "Address3": $scope.add.addline3,
            "state": $scope.add.addselectedstate,
            "district": $scope.add.addselecteddistrict,
            "city": $scope.add.addselectedcity,
            "pincode": $scope.add.pincode1,
            "Address_gid": ecustgrp[0].customergroup_add_gid,
            "custgrp_gid": ecustgrp[0].customergroup_gid,
        };
        var custgrpeditdtl = testService.updategrpdetail(grpeditdetails, 'Update');
        custgrpeditdtl.then(function(result) {
            if (result.data === "SUCCESS") {
                alert("Updated Succesfully");
                $window.location.href = "customercreate";
            } else {
                alert("Data Not Updated");
            }
        }, function(err) {
            alert('Data Not Updated');
        });
    };

    $scope.custgrpadd = function(custgrpgid, check) {
        if (check == true) {
        $scope.addressdisabled = true;
            var custgrpadd = testService.get_custgrp(custgrpgid)
            custgrpadd.then(function(result) {
                    custadd = JSON.parse(result.data);
                    addget(custadd[0].customergroup_add_gid);
                }),
                function() {
                    alert('no data');
                };
        } else {
            $scope.addressdisabled = false;
            $scope.adline = ''
            $scope.adline2 = ''
            $scope.adline3 = ''
            $scope.pcode = ''
            $scope.selectedcity = 0
            $scope.selecteddistrict = 0
            $scope.selectedState = 0
        }
    }

    $scope.cusgrp_code = function(custname) {
        var cust_nme = custname.replace(/\s/g, '');
        var custnme = cust_nme.replace(/[^a-zA-Z0-9]/g, '');
        var codedtl = {
            "Unique_Name": "CUSTOMER_GROUP",
            "Unique_Value": custnme,
        };
        var custcode_dtl = testService.getuniquecode('unique', 'code', codedtl);
        custcode_dtl.then(function(result) {
            var grp_code = [];
            grp_code = JSON.parse(result.data);
            $scope.grpcode = grp_code[0].Final_Code;
        }, function(err) {
            alert('No Data Shown');
        });
    };
    $scope.custcode = function(custgrpgid,custname) {
        var codedtl = {
            "Unique_Name": "CUSTOMER",
            "Cust_Group_gid": custgrpgid,
            "Cust_name": custname,
        };
        var custcode = testService.getuniquecode('unique', 'code', codedtl);
        custcode.then(function(result) {
            var code = [];
            code = JSON.parse(result.data);
            $scope.code = code[0].Final_Code;
            <!--$scope.gstno($scope.code);-->
        }, function(err) {
            alert("Data not Shown");
            $scope.code = '';

        });
    };
    $scope.gstno = function(code,stategid,location) {

        var codedtl = {
            "tax_code": "GST",
            "subtax_code": "CGST",
            "ref_code": "CUST_GST",
            "reftable_code": code,
            "state_gid":stategid,
            "location":location
        };
        var gstno = testService.gettaxdetl('', '', codedtl);
        gstno.then(function(result) {

            var gstnodt = [];
            gstnodt = JSON.parse(result.data);
            $scope.GSTNo = gstnodt[0].taxdetails_taxno;
             $scope.GSTNo_gid = gstnodt[0].taxdetails_gid;
        }, function(err) {
            <!--alert('No Data Shown');-->
        });
    };
    $scope.loading = function() {
          $mdDialog.show({
               templateUrl: 'loaderSpinner',
               parent: angular.element(document.body),
               clickOutsideToClose: false
          });
       };
     $scope.endloading = function() {
                $mdDialog.hide();
            };

            <!--For Contact-->
    var custgrpddl = testService.getcustgr()
        custgrpddl.then(function(result) {
                $scope.conttype = [];
                $scope.conttype = JSON.parse(result.data);
            }),
            function() {
                alert('No data!.');
            };
            loaddata1();
             function loaddata1() {
            $scope.designationdetails == [];
            var rolegrouplist = testService.getdesg();
            rolegrouplist.then(function(rolegrouplist) {
                    $scope.designationdetails = JSON.parse(rolegrouplist.data);
                }, function(err) {
                    alert('No data!.');
                })
                .finally();
        };

         var courier=testService.getcourier();
            courier.then(function(result) {

            $scope.courierddl = result.data;
        },
        function(err) {
            alert('No data!.');
        }).finally($scope.endloading);

      $rootScope.add_state = function() {
            modalshow('state_add_popup');
        }

       $scope.showStateInput = false;
        $scope.StateChanged = function(c) {
            var x = c.state_name
            if (x == 'Add New State') {
                $scope.showStateInput = true;
            }
            else{
            $scope.showStateInput = false;
        }
        }

       $scope.getState_Name = Change_State_Name;
       function Change_State_Name(query) {
           var result = $filter('filter')($scope.statedist, {
           'state_name': query
             });
           return result;
      }
                 var detail = JSON.parse(sessionStorage.getItem('today'));
                 $scope.employgid = detail.employee_gid;
                 $scope.entity_gid = detail.entity_gid;
                 $scope.create_by = detail.employee_gid;
                 $scope.state=[];

             $scope.insert_state=function(state){
             $scope.State_Name = $scope.state.new_state_name.toUpperCase();
                 $scope.name=$scope.state.selectedStatename.state_name;
                 $scope.result = $filter('filter')($scope.locstate,{
                       'state_name': $scope.State_Name
                        });
             $scope.r=$scope.result.length;
             if($scope.r==0)
             {
                   var data={"params":{"filter":{"State_name":$scope.State_Name,"State_country_gid":1},
                   "classification":{"Entity_gid":$scope.entity_gid}
                    }
             }

             var data_init={
                         "Action":"Insert",
                         "Type":"State_Insert",
                         "create_by":$scope.employgid,
                         "data":data
             }

                var add_state = testService.city_pincode_set(data_init);
                      add_state.then(function(result) {

                        if (result.data === "SUCCESS") {
                          alert("Succesfully State Inserted");
                           $window.location.href = "customercreate";

                         } else {
                      alert("Data Not Inserted");
                      }
                  }, function(err) {
                    alert('Data Not Inserted');
                });
              }
               else{
                 alert("Give Correct Input!");
               }
              };

       $scope.getStateDistrict_Name = Change_State_District_Name;
       function Change_State_District_Name(query) {
           var result = $filter('filter')($scope.locstate, {
           'state_name': query
             });
           return result;
           $scope.getDistrict_Name;

       }

     $scope.showStateDistrictInput = false;
        $scope.DistrictChanged = function(c) {
            var x = c.district_name;
            if (x == 'Add New District') {
                $scope.showStateDistrictInput = true;
            }
            else{
            $scope.showStateDistrictInput = false;
            }
            $scope.getDistrict_Name;
        }

       $scope.getDistrict_Name=function(query)
        {
           var result = $filter('filter')($scope.distritddl1, {
           'district_name': query
             });
           return result;
        }
              $scope.add_district=function(dist){
                  $scope.new_dist_name=dist.new_district_name;
                  $scope.state_gid=dist.state.state_gid;
                  $scope.results = $filter('filter')($scope.distritddl,{
                       'district_name': $scope.new_dist_name
                        });
                  $scope.res=$scope.results.length;
                  if($scope.res==0 && $scope.state_gid!="")
                  {
                      var data={"params":{"filter":{"district_state_gid":$scope.state_gid,
                                          "district_name":$scope.new_dist_name},
                                           "classification":{"Entity_gid":$scope.entity_gid}
                                          }
                      }
                      var data_init={
                             "Action":"Insert",
                             "Type":"District_Insert",
                             "create_by":$scope.employgid,
                             "data":data
                             }

                      var add_state = testService.city_pincode_set(data_init);
                         add_state.then(function(result) {
                          if (result.data === "SUCCESS") {
                          alert("Succesfully District Inserted");
                           $window.location.href = "/customercreate/";
                           } else {
                                alert("Data Not Inserted");
                           }
                           }, function(err) {
                           alert('Data Not Inserted');
                      });
                 }
              else{
              alert("Give Correct Input!");
              }
              };

     $scope.getStateDistrictCity_Name = Change_State_District_City_Name;
       function Change_State_District_City_Name(query) {
           var result = $filter('filter')($scope.stateddl1, {
           'state_name': query
             });
           return result;
      }
     $scope.showCityInput = false;
        $scope.CityChanged = function(c) {
            var x = c.City_Name;
            if (x == 'Add New City') {
                $scope.showCityInput=true;
            }
            else{
            $scope.showCityInput = false;
        }
        }
       $scope.getDistrictCity_Name = Change_Dist_Name;
       function Change_Dist_Name(query) {
           var result = $filter('filter')($scope.distritddl2, {
           'district_name': query
             });
           return result;
      }
       $scope.getCity_Name = Change_City_Name;
       function Change_City_Name(query) {
           var result = $filter('filter')($scope.city2, {
           'City_Name': query
             });
           return result;
      }

       $scope.add_city_pincode=function(city){
        $scope.city_name=city.selectedCity.City_Name;
        $scope.new_city_name=city.new_city_name;
        $scope.new_pincode=city.pincode;
        $scope.state_gid=city.state.state_gid;
        $scope.district_gid=city.selectedCityname.district_gid;
        $scope.ressult_city = $filter('filter')($scope.city1,{
                  'City_Name':$scope.city_name
                  });
                 $scope.ressult_city=$scope.ressult_city.length;
                 if($scope.ressult_city==0 && $scope.new_city_name!=null && $scope.new_pincode!=null && $scope.state_gid!=null && $scope.district_gid!=null)
                 {
                     var data={"params":
                        {
                          "city_name": $scope.new_city_name,
                          "state_gid":$scope.state_gid,
                          "district_gid":$scope.district_gid,
                          "pincode_no":$scope.new_pincode
                        }
                     };
                     var data_init={
                             "Action":"insert",
                             "data":data
                     }
                 var add_city = testService.city_pincode_set(data_init);
                      add_city.then(function(result) {
                        if (result.data === "SUCCESS") {
                        alert("Succesfully City Inserted");
                        $window.location.href = "/customercreate/";
                       } else {
                      alert("Data Not Inserted");
                      }
                 }, function(err) {
                   alert('Data Not Inserted');
                });
                }
                else{
                alert("Give Correct Input...!");

                }
            };


}]);
myApp.service("testService", function($http) {
    this.getcustgrp = function(d) {
        var response = $http.get(Appname + "/get_custgroup/");
        return response;
    }
    this.getloctddl = function(d) {
        var response = $http.get(Appname + "/locationddl/");
        return response;
    }
    this.getstateddl = function(d) {
        var response = $http.get(Appname + "/stateddl/");
        return response;
    }
      this.getcustgr = function(d) {
            var response = $http.get(Appname + "/get_contctgroup/");
            return response;
        }
           this.getdesg = function() {
            var response = $http.get(Appname + "/desgjson/");
            return response;
        }
    this.getdistddl = function(state_gid) {

        var response = $http.get(Appname + "/districtddl/", {
            params: {
                "state_gid": state_gid
            }
        });
        return response;
    }
    this.getcityddl = function(district_gid) {
        var response = $http.get(Appname + "/cityddl/", {
            params: {
                "district_gid": district_gid
            }
        });
        return response;
    }
    this.getpincode = function(city_gid) {
        var response = $http.get(Appname + "/pincode/", {
            params: {
                "city_gid": city_gid
            }
        });
        return response;
    }
    this.supplier_update_det=function(supplier_detail,action){

    var response = $http.post(Appname + "/supplierdetails/", {
            params: {
                "supplier_details": supplier_detail,
                "Action":action
            }
        });
        return response;

    }
    this.savedetail = function(custdet, action) {
        var response = $http.post(Appname + "/customerset/", {
            parms: {
                "details": custdet,
                "Action": action
            }
        });
        return response;
    }
    this.getlocation = function(location_gid) {
        var response = $http.get(Appname + "/locationget/", {
            params: {
                "location_gid": location_gid
            }
        });
        return response;
    }
    this.getcluster = function(action) {

        var response = $http.get(Appname + "/get_cluster/", {
            params: {
                "action": action
            }
        });
        return response;
    }
    this.getcustomer = function(cust_gid) {
        var response = $http.get(Appname + "/customeredt_get/", {
            params: {
                "cust_gid": cust_gid
            }
        });
        return response;
    }
    this.getaddress = function(add_gid) {
        var response = $http.get(Appname + "/addressget/", {
            params: {
                "add_gid": add_gid
            }
        });
        return response;
    }
    this.updatedetail = function(custdet, action) {

        var response = $http.post(Appname + "/customerset/", {
            parms: {
                "details": custdet,
                "Action": action
            }
        });
        return response;
    }
    this.getcustcate = function(d) {
        var response = $http.get(Appname + "/get_custcate/");
        return response;
    }
    this.getdata = function(tablename, columnname) {
        var response = $http.get(Appname + "/get_custdata/", {
            params: {
                "tablename": tablename,
                "columnname": columnname
            }
        });
        return response;
    }
    this.getclient = function(client_gid) {
         var response = $http.get(Appname + "/client_get/", {
          params:{
          "client_gid":client_gid
    }
            });
            return response;
        }
    this.get_custgrp = function(custgrp_gid) {

        var response = $http.get(Appname + "/customergrp_get/", {
            params: {
                "custgrp_gid": custgrp_gid
            }
        });
        return response;
    }
    this.savegrpdetail = function(custgrpdet, action) {
        var response = $http.post(Appname + "/customergroupset/", {
            parms: {
                "grpdetails": custgrpdet,
                "Action": action
            }
        });
        return response;
    }
    this.updategrpdetail = function(custgrpdet, action) {

        var response = $http.post(Appname + "/customergroupset/", {
            parms: {
                "grpdetails": custgrpdet,
                "Action": action
            }
        });
        return response;
    }
    this.getpincodeall = function(pincode) {
        var response = $http.get(Appname + "/allpinget/", {
            params: {
                "pincode": pincode
            }
        });
        return response;
    }

    this.getuniquecode = function(action, type, jsondata) {
        var response = $http.get(Appname + "/getuniquecode/", {
            params: {
                "action": action,
                "type": type,
                "jsondata": jsondata
            }
        });
        return response;
    }
    this.gettaxdetl = function(type,group, jsondata) {
        var response = $http.get(Appname + "/gettaxdetails/", {
            params: {
                "type": type,
                "group":group,
                "jsondata": jsondata
            }
        });
        return response;
    }
     this.getcourier = function () {
        var response = $http.post(Appname+"/Courier_dtl/",{
        params:{
        "courier_gid": 0,
        "courier_name":''
        }
        });
        return response;
    }
    this.city_pincode_set=function(data_init){
         var response=$http.post(Appname +"/set_state_dist_city_pincode/",data_init);
         return response;
    }
});

</script>

{% endblock %}