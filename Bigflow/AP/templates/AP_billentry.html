{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %} Invoice  {% endblock %}
{% block content %}
<script src="{% static 'Scripts/Common/barcode_generate.js' %}"></script>
<link href="{% static 'Content/font-awesome-4.1.0.css' %}" rel="stylesheet">
<!--<link href="{% static 'Content/roboto:400,300.css' %}" rel="stylesheet">-->
<link href="{% static 'Content/robotofonttext400300.css' %}" rel="stylesheet">
<link href="{% static 'Content/textangular.css' %}" rel="stylesheet">
<script src="{% static 'Scripts/Core/textAngular-rangy.js' %}"></script>
<script src="{% static 'Scripts/Core/textAngular-sanitize.js' %}"></script>
<script src="{% static 'Scripts/Core/textAngular.js' %}"></script>
{% csrf_token %}
{% verbatim %}
<div class="maincontent">
    <div ng-app="Appsmry" ng-controller="Ctrlsmry" class="container container1" ng-cloak>

        <div class="row">

            <div class="row-header col-lg-12 col-sm-12">
                <div class="col-md-3">
                    <h4>{{Header}}
                    </h4>
                </div>
                <div class="col-md-4">
                    <button mat-button style="padding: 2px 0px;" ng-show="!state" type="submit"
                            ng-click="imagetoggle()">View Image
                    </button>
                    <button mat-button style="padding: 2px 0px;" ng-show="state" type="submit"
                            ng-click="imagetoggle()">
                        Hide Image
                    </button>
                </div>
                <!--                <button class="btn btn-primary" type="submit" ng-click="imagetoggle()">Button</button>-->
            </div>
            <!--            <div class="row-header col-lg-12 col-sm-12" ng-show="checkr_header">-->
            <!--                <h4>Invoice Checker</h4>-->
            <!--            </div>-->
            <!--            <div class="row-header col-lg-12 col-sm-12" ng-show="apprv_header">-->
            <!--                <h4>Invoice Approval</h4>-->
            <!--            </div>-->
            <!--            <div class="row-header col-lg-12 col-sm-12" ng-show="reject_header">-->
            <!--                <h4>Claim Reject</h4>-->
            <!--            </div>-->

        </div>
        <embed ng-show="state">
        <div>
            <div class="row">
                <hr>
                <div class="row">
                    <div class="col-md-12">
                        <div class="col-md-2">
                            <a href="" ng-click="View_auditcheck()">
                                <span class="material-icons">touch_app</span>
                            </a>
                            <strong id="text2">Audit checklist</strong>
                        </div>

                        <div class="col-md-2" style="bottom:0px;color:#7621A6" ng-hide="ppx_hide">
                            <a href="" ng-click="view_tran_details()">
                                <span class="material-icons">arrow_upward</span>
                            </a>
                            <strong>View Transaction</strong>

                        </div>

                        <div class="col-md-2" style="bottom:0px;color:#7621A6">
                            <a href="" ng-click="view_dedupe()">
                                <span class="material-icons">arrow_upward</span>
                            </a>
                            <strong>DEDUPE CHECK</strong>
                        </div>

                        <!--                        <div class="col-md-2" style="bottom:0px;color:#7621A6">-->
                        <!--                            <a href="" ng-click="get_dts_details()">-->
                        <!--                                <span class="material-icons">arrow_upward</span>-->
                        <!--                            </a>-->
                        <!--                            <strong>TDS Details</strong>-->
                        <!--                        </div>-->

                        <div class="col-md-2" style="bottom:0px;color:">

                            <a href="" ng-click="view_note_file()">
                                <span class="material-icons">arrow_upward</span>
                            </a>
                            <strong>View Notes</strong>
                        </div>
                    </div>
                </div>
                <hr>
            </div>
        </div>
        <div class="row">
            <!--            ng-show="state"-->

        </div>
        <table rz-table="" rz-mode="resizeMode" id="myTable">
            <thead>
            <tr>
                <th id="colName" style="width:30%">Document</th>
                <th id="colStatus" style="color:pink;"><- Drag Here</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td style="vertical-align: top;">
                    <!--            ng-show="!state"-->
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-md-12" ng-hide="state" style="overflow: auto;">
                                <div class="row table-responsive">
                                    <div class="col-md-12 col-lg-12 col-sm-12">
                                        <div class="row table-responsive">
                                            <div class="col-md-12 col-lg-12 col-sm-12">
                                                <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                                       md-progress="deferred">
                                                    <thead class="header">
                                                    <tr>
                                                        <th>S.No</th>
                                                        <th>View</th>
                                                        <th>Reference Name</th>
                                                        <th>Download</th>
                                                        <th>Is Duplicate</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr ng-repeat="img in ecf_all_files">
                                                        <td>{{((currentPages-1)*itemsPerPages)+$index+1}}</td>
                                                        <td align="left">
                                                            <span class="badge badge-secondary"
                                                                  ng-hide="img.file_path=='RENT'"
                                                                  ng-click="view_file(img)">{{img.file_name}}</span>
                                                        </td>
                                                        <td>{{img.ref_name}}</td>
                                                        <td>
                                                            <a ng-hide="img.file_path=='RENT'"
                                                               href="common_s3_file_download?filename={{img.file_name}}">
                                                                Download</a>
                                                            </a>
                                                            <a ng-show="img.file_path=='RENT'"
                                                               ng-click="download_rent_file(img)">
                                                                Download</a>
                                                            </a>
                                                        </td>
                                                        <td align="center">
                                                            <md-checkbox ng-model="img.file_isduplicate"
                                                                         ng-true-value="'Y'"
                                                                         ng-false-value="'N'"
                                                                         ng-click="updateSelection(img)"
                                                                         type="checkbox"></md-checkbox>
                                                        </td>

                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                            </div>
                            <div class="row" ng-hide="!state">
                                <div class="col-md-12 text-center">
                                    <span title="Zoom in">
                                        <a href="" onclick="zoomin()" style="font-size:50px">
                                            <i style="font-size:30px" class="material-icons">zoom_in</i>
                                        </a>
                                    </span>
                                    <span title="Zoom Out">
                                        <a href="" onclick="zoomout()" style="font-size:50px">
                                            <i style="font-size:30px" class="material-icons">zoom_out</i>
                                        </a>
                                        </span>
                                </div>
                            </div>
                            <div class="col-md-12" ng-hide="!state" style="overflow: auto;">
                                <img src="{{local_url_data}}" id="zooming" GFG="250"
                                     alt="{{url_datas[0].file_name}}"
                                     align="center"
                                     ng-show="extension!='pdf'">
                                <hr/>
                                <iframe src="{{pdf_file_url_path}}" frameborder="0"
                                        height="600px" width="97%" ng-show="extension=='pdf'"></iframe>
                            </div>
                        </div>
                    </div>

                </td>
                <td style="overflow:auto;overflow-y: scroll;">
                    <div>
                        <div ng-hide="!PPX_HTML">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-4">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Invoice Type</label>
                                            <md-select ng-model="selectedtype" required ng-disabled="true">
                                                <md-option ng-repeat="x in channelddl" ng-value="x.metadata_value"
                                                           ng-click="typeclick(x.metadata_value)">{{ x.metadata_value }}
                                                </md-option>
                                            </md-select>
                                        </md-input-container>
                                    </div>

                                    <div class="col-md-4">
                                        <!--                            <md-input-container class="md-block inputcontainer">-->
                                        <!--                                <label>Supplier Name</label>-->
                                        <!--                                <md-select ng-model="supplier_gid" ng-disabled="true" required>-->
                                        <!--                                    <md-option><em>None</em></md-option>-->
                                        <!--                                    <md-option ng-repeat="posupplier in invoicesupplier_list"-->
                                        <!--                                               ng-click="supplier_click(posupplier.supplier_gid)"-->
                                        <!--                                               ng-selected="supplier_gid == posupplier.supplier_gid"-->
                                        <!--                                               ng-value="posupplier.supplier_gid">-->
                                        <!--                                        {{posupplier.supplier_name}}-->
                                        <!--                                    </md-option>-->
                                        <!--                                </md-select>-->
                                        <!--                            </md-input-container>-->

                                        <md-input-container class="md-block inputcontainer"
                                        >
                                            <label>Supplier</label>
                                            <input ng-model="supplier_name_" ng-disabled="true" maxlength="16"/>
                                        </md-input-container>
                                    </div>

                                    <!--                                    <div class="col-md-3">-->
                                    <!--                                        <md-input-container class="md-block inputcontainer">-->
                                    <!--                                            <label>purpose</label>-->
                                    <!--                                            <input ng-model="remarks" ng-disabled="true" maxlength="80" no-special-char-->
                                    <!--                                                   required/>-->
                                    <!--                                        </md-input-container>-->
                                    <!--                                    </div>-->
                                    <div class="col-md-4">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Invoice Amount</label>
                                            <input ng-model="invoiceamount" ng-disabled="true" numbers-only
                                                   maxlength="32"
                                                   required/>
                                        </md-input-container>
                                    </div>

                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-4">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Date</label>
                                            <md-datepicker ng-disabled="true" md-hide-icons="calendar"
                                                           ng-model="invdate"
                                                           md-hide-icons="calendar" ng-click="date"
                                                           md-min-date="maxDate"
                                                           ng-change="validate_date_header(invdate)"
                                                           md-max-date="minDate" formatDate required></md-datepicker>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-4" ng-show="!Employe_hide">
                                        <!--                            <md-input-container class="md-block inputcontainer">-->
                                        <!--                                <label>Employee Name</label>-->
                                        <!--                                <md-select ng-model="Emp_gid" ng-disabled="true" required>-->
                                        <!--                                    <md-option ng-repeat="emp in employee" ng-value="emp.employee_gid">-->
                                        <!--                                        {{emp.employee_name}}-->
                                        <!--                                    </md-option>-->
                                        <!--                                </md-select>-->
                                        <!--                            </md-input-container>-->

                                        <md-input-container class="md-block inputcontainer">
                                            <label>employee Name</label>
                                            <input ng-model="employee_name_" ng-disabled="true" maxlength="16"/>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-4">
                                        <!--                            <md-input-container class="md-block inputcontainer" ng-hide="!checkboxModel.value">-->
                                        <!--                                <label>Bill Desitination</label>-->
                                        <!--                                <md-select ng-model="selectedsource">-->
                                        <!--                                    <md-option ng-repeat="x in soourcedata" ng-value="x.branch_gid"-->
                                        <!--                                               ng-selected="selectedsource == x.branch_gid" ng-click="sourceclick(x)">{{-->
                                        <!--                                        x.branch_name }}-->
                                        <!--                                    </md-option>-->
                                        <!--                                </md-select>-->
                                        <!--                            </md-input-container>-->
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Branch Name</label>
                                            <input ng-model="branch_name_" ng-disabled="true" maxlength="16"/>
                                        </md-input-container>

                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-5">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>purpose</label>
                                            <input ng-model="remarks" maxlength="80" required/>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-3">
                                        <md-input-container class="md-block inputcontainer" ng-disabled="true">
                                            <label>PPX PO No</label>
                                            <input ng-model="Pono" ng-disabled="true" maxlength="16"/>
                                        </md-input-container>
                                    </div>
                                    <md-button ng-click="addrow()" ng-show="isSet(1)" class="md-raised">Add Row
                                        <md-tooltip>Add Row</md-tooltip>
                                    </md-button>
                                    <md-button ng-click="add_debit_ppx()" ng-disabled="add_row" ng-show="isSet(2)"
                                               class="md-raised">Add
                                        Row
                                        <md-tooltip>Add Row</md-tooltip>
                                    </md-button>
                                    <div ng-show="ppx_present=='S' || ppx_present==' ' ">
                                        <md-button ng-click="add_credit('tds')" ng-disabled="add_row" ng-show="isSet(3)"
                                                   class="md-raised">
                                            Add
                                            TDS
                                            <md-tooltip>Add Row</md-tooltip>
                                        </md-button>
                                    </div>
                                    <!--                                    <div class="col-md-1">-->
                                    <!--                                        <a href="" ng-click="View_auditcheck()">-->
                                    <!--                                            <span class="material-icons">touch_app</span>-->
                                    <!--                                        </a>-->
                                    <!--                                        <strong id="text3">Audit checklist</strong>-->
                                    <!--                                    </div>-->

                                    <!--                                    <div class="col-md-2" style="bottom:0px;color:#7621A6" ng-hide="ppx_hide">-->
                                    <!--                                        <h3><span class="editlink material-icons" style="color:#D64CB4;"-->
                                    <!--                                                  ng-click="view_tran_details()">arrow_upward                        </span>-->
                                    <!--                                        </h3>View Transaction-->
                                    <!--                                    </div>-->
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-3">
                                        <md-input-container class="md-block inputcontainer" ng-disabled="true"
                                                            ng-hide="!checkboxModel.value">
                                            <label>GST No</label>
                                            <input ng-model="dest_gstno" ng-disabled="true" maxlength="16"/>
                                        </md-input-container>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div ng-hide="PPX_HTML">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-2">
                                                <strong>Invoice is Original:<b style="color:blue">
                                                    {{invoiceheader_invoiceisoriginal}}</b> </strong>
                                            </div>
                                            <div class="col-md-2">
                                                <input type="checkbox" id="myCheck" ng-change="header_change()"
                                                       ng-model="checkboxModel.value">
                                                <strong id="text">GST Applicable</strong></div>
                                            <div class="col-md-2" ng-hide="ppx_hide">
                                                <input type="checkbox" id="Amort" ng-blur="header_change()"
                                                       ng-model="amortModel.value"
                                                >
                                                <strong id="amortc">Prepaid Expenses</strong></div>
                                            <div class="col-md-2" ng-hide="ppx_hide">
                                                <input type="checkbox" id="captalise" ng-blur="header_change()"
                                                       ng-model="captalizedModel.value"
                                                >
                                                <strong id="captalisec">Capitalized</strong></div>
                                            <div class="col-md-2">
                                                <input type="checkbox" id="myCheck1" ng-click="Header_update()"
                                                       ng-model="rcmModel.value">
                                                <strong id="text12">RCM Applicable</strong></div>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-4">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Invoice Type</label>
                                                    <md-select ng-model="selectedtype" required ng-disabled="true">
                                                        <md-option ng-repeat="x in channelddl"
                                                                   ng-value="x.metadata_value"
                                                                   ng-click="typeclick(x.metadata_value)">{{
                                                            x.metadata_value }}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <!--                    <div class="col-md-3" ng-show="!pohide">-->
                                            <!--                        <md-input-container class="md-block inputcontainer">-->
                                            <!--                            <label>PO Number</label>-->
                                            <!--                            <input ng-model="POno" ng-disabled="ponumbr" maxlength="16" required/>-->
                                            <!--                        </md-input-container>-->
                                            <!--                    </div>-->
                                            <!--                    <div class="col-md-1" ng-show="!poarrow">-->
                                            <!--                        <a href="" ng-click="ponumberclick()"><i class="material-icons"-->
                                            <!--                                                                 style="material-icons.line-height:3px;">send</i></a>-->
                                            <!--                    </div>-->
                                            <div class="col-md-4">
                                                <!--                            <md-input-container class="md-block inputcontainer">-->
                                                <!--                                <label>Supplier Name</label>-->
                                                <!--                                <md-select ng-model="supplier_gid" ng-disabled="true" required>-->
                                                <!--                                    <md-option><em>None</em></md-option>-->
                                                <!--                                    <md-option ng-repeat="posupplier in invoicesupplier_list"-->
                                                <!--                                               ng-click="supplier_click(posupplier.supplier_gid)"-->
                                                <!--                                               ng-selected="supplier_gid == posupplier.supplier_gid"-->
                                                <!--                                               ng-value="posupplier.supplier_gid">-->
                                                <!--                                        {{posupplier.supplier_name}}-->
                                                <!--                                    </md-option>-->
                                                <!--                                </md-select>-->
                                                <!--                            </md-input-container>-->

                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Supplier Name</label>
                                                    <input ng-model="supplier_name_" ng-disabled="true" maxlength="16"/>
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-4">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>State</label>
                                                    <md-select ng-model="selectedstate" ng-disabled="true" required>
                                                        <md-option ng-repeat="x in stateddl"
                                                                   ng-selected="selectedstate == x.state_gid"
                                                                   ng-value="x.state_gid">{{ x.state_name }}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-4">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Date<span ng-show="invoice_date_status=='1'"
                                                             style="color:red"> Invoice date is greater than six months
                                            </span></label>
                                            <md-datepicker md-hide-icons="calendar"
                                                           ng-blur="header_change()"
                                                           ng-model="invdate"
                                                           ng-change="validate_date_header(invdate)"
                                                           md-hide-icons="calendar"
                                                           md-max-date="minDate" formatDate required></md-datepicker>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-4">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Invoice Number</label>
                                            <input ng-model="invoicenum" ng-blur="header_change()" maxlength="32"
                                                   required/>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-4">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Invoice Amount</label>
                                            <input ng-model="invoiceamount" ng-blur="header_change()" ng-disabled="true"
                                                   valid-number maxlength="32"
                                                   required/>
                                        </md-input-container>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-4">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Invoice Taxable Amount</label>
                                            <input ng-model="invoicetaxamount" ng-blur="header_change()"
                                                   maxlength="32"
                                            />
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-8">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>purpose</label>
                                            <input ng-model="remarks" maxlength="80" no-special-char required/>
                                        </md-input-container>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">

                                    <div class="col-md-5">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Supplier GST No</label>
                                            <input ng-model="gstno" ng-disabled="true" maxlength="160"/>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-5">
                                        <md-input-container class="md-block inputcontainer" ng-disabled="true"
                                                            ng-hide="!checkboxModel.value">
                                            <label>Branch GST No</label>
                                            <input ng-model="dest_gstno" ng-disabled="true" maxlength="16"/>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-2" ng-show="gstkeyhide">
                                        <input type="checkbox" id="myCheckECF" ng-model="GSTKEYIN.value"
                                               ng-hide="selectedtype=='PETTYCASH'">
                                        <strong id="text1" ng-hide="selectedtype=='PETTYCASH'">GST KEY-IN</strong>
                                    </div>

                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-5">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Branch Name</label>
                                            <input ng-model="branch_name_" ng-disabled="true" maxlength="16"/>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-5" ng-show="!Employe_hide">
                                        <!--                            <md-input-container class="md-block inputcontainer">-->
                                        <!--                                <label>Employee Name</label>-->
                                        <!--                                <md-select ng-model="Emp_gid" ng-disabled="true" required>-->
                                        <!--                                    <md-option ng-repeat="emp in employee" ng-value="emp.employee_gid">-->
                                        <!--                                        {{emp.employee_name}}-->
                                        <!--                                    </md-option>-->
                                        <!--                                </md-select>-->
                                        <!--                            </md-input-container>-->
                                        <md-input-container class="md-block inputcontainer">
                                            <label>employee Name</label>
                                            <input ng-model="employee_name_" ng-disabled="true" maxlength="16"/>
                                        </md-input-container>
                                    </div>


                                    <!--                        <div class="col-md-2" style="bottom:0px;color:green">-->
                                    <!--                            <h3><span class="editlink material-icons" style="color:#D64CB4;"-->
                                    <!--                                      ng-click="view_attached_file()">arrow_upward-->
                                    <!--                                    </span>-->
                                    <!--                            </h3>View Attachment-->
                                    <!--                        </div>-->
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-3">
                                                                                <span href=""
                                                                                      ng-hide="commodity_show==0"
                                                                                      ng-click=view_commodity(cr_no)
                                                                                      style="color:green">Commodity Details</span>
                                        <!--                                        <md-input-container class="md-block inputcontainer" ng-hide="commodity_show==1">-->
                                        <!--                                            <label>Commodity Name</label>-->
                                        <!--                                            <input ng-model="commodity_data[0].commodity_name" ng-disabled="true"-->
                                        <!--                                                   maxlength="16"/>-->
                                        <!--                                        </md-input-container>-->
                                        <md-autocomplete
                                                md-clear-button="true"
                                                md-floating-label="Change Commodity"
                                                md-input-maxlength=126
                                                md-item-text="item.commodity_name"
                                                md-items="item in commodity(searchCommodity)"
                                                md-min-length=0
                                                ng-hide="commodity_show==1"
                                                md-no-cache="true"
                                                md-search-text="searchCommodity"
                                                md-selected-item="selected_commodity"
                                                md-selected-item-change="Change_commodity(selected_commodity)"
                                                ng-required="true">
                                            <md-item-template>
                                                <span md-highlight-text="searchCommodity"> {{item.commodity_name}} </span>
                                            </md-item-template>
                                            <md-not-found>
                                                No Commodity matching "{{searchCommodity}}" were found.
                                            </md-not-found>
                                        </md-autocomplete>
                                    </div>
                                    <md-button ng-click="addrow()" ng-show="isSet(1)" class="md-raised">Add Row
                                        <md-tooltip>Add Row</md-tooltip>
                                    </md-button>
                                    <md-button ng-click="add_debit()" ng-disabled="add_row" ng-show="isSet(2)"
                                               class="md-raised">Add
                                        Row
                                        <md-tooltip>Add Row</md-tooltip>
                                    </md-button>
                                    <md-button ng-click="add_credit('credit')" ng-disabled="add_row" ng-show="isSet(3)"
                                               class="md-raised">
                                        Add
                                        Row
                                        <md-tooltip>Add Row</md-tooltip>
                                    </md-button>

                                </div>
                            </div>
                        </div>
                    </div>

                    <div ng-hide="tablehide">
                        <div class="row table-responsive">
                            <div class="col-md-12 col-lg-12 col-sm-12">
                                <div class="tabsdemoDynamicHeight" ng-hide="!podetail">
                                    <md-content>
                                        <md-tabs>
                                            <md-tab ng-class="{ active: isSet(4) }" ng-click="setTab(4)"
                                                    label="Invoice Details">
                                            </md-tab>

                                            <md-tab ng-class="{ active: isSet(2) }" ng-click="setTab(2)" label="Debit">
                                            </md-tab>
                                            <md-tab ng-class="{ active: isSet(3) }" ng-click="setTab(3)" label="Credit">
                                            </md-tab>
                                        </md-tabs>
                                    </md-content>
                                </div>

                                <div ng-hide="PPX_HTML">
                                    <div class="tabsdemoDynamicHeight" ng-hide="podetail">
                                        <md-content>
                                            <md-tabs>

                                                <md-tab ng-class="{ active:color_values=='1'}" ng-click="setTab(1)"
                                                        label="Invoice Details">
                                                </md-tab>

                                                <md-tab ng-class="{ active:color_values=='2'}" ng-click="setTab(2)"
                                                        label="Debit">
                                                </md-tab>
                                                <md-tab ng-class="{ active:color_values=='3'}" ng-click="setTab(3)"
                                                        label="Credit">
                                                </md-tab>
                                            </md-tabs>
                                        </md-content>
                                    </div>
                                </div>
                                <div ng-hide="!PPX_HTML">
                                    <div class="tabsdemoDynamicHeight" ng-hide="podetail">
                                        <md-content>
                                            <md-tabs>

                                                <md-tab ng-class="{ active: isSet(2) }" ng-click="setTab(2)"
                                                        label="Debit">
                                                </md-tab>
                                                <md-tab ng-class="{ active: isSet(3) }" ng-click="setTab(3)"
                                                        label="Credit">
                                                </md-tab>
                                            </md-tabs>
                                        </md-content>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="row table-responsive">

                            <div class="col-md-12 col-lg-12 col-sm-12">
                                <div ng-hide="PPX_HTML">
                                    <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                           ng-show="isSet(1)" ng-hide="podetail">
                                        <thead class="header">

                                        <tr>
                                            <th>S.No</th>
                                            <th>Item</th>
                                            <th>Desc</th>
                                            <th ng-show="imprest_view">Supplier</th>
                                            <th>Product Code</th>
                                            <th>Hsn Code / percent</th>
                                            <th>Unit Price</th>
                                            <th>Qty</th>

                                            <th>Amount</th>
                                            <th>Discount</th>
                                            <th>Taxable Amount</th>
                                            <th>IGST</th>
                                            <th>CGST</th>
                                            <th>SGST</th>
                                            <th>Total Amount</th>
                                            <th>Action</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="dtl in invoicedetails | filter: {checked: true}">
                                            <td ng-model="dtl.Invoice_Sno=$index+1">
                                                <center>{{$index+1}}</center>


                                            </td>
                                            <td><input type="text" class="textboxgeneral" maxlength="100"
                                                       ng-disabled="invoiceview"
                                                       style="width:150px"
                                                       ng-model="dtl.item"/>
                                            </td>
                                            <td><input type="text" class="textboxgeneral" maxlength="100"
                                                       ng-disabled="invoiceview"
                                                       style="width:150px"
                                                       ng-model="dtl.description"
                                                       only-numbers/>
                                            </td>
                                            <td align="center" ng-show="imprest_view"
                                            ><a href=""

                                                ng-click="Supplier_split($index)"><span class="material-icons">
                                arrow_upward
                                </span></a></td>
                                            <td>
                                                <md-autocomplete style="min-width: 145px;"

                                                                 md-no-cache="true"
                                                                 md-selected-item="selectedItem"
                                                                 md-search-text="dtl.product_name"
                                                                 md-selected-item-change="dtl.hsn_igstrate =item.hsn_igstrate;dtl.HSN_Code=item.hsn_code;ACselectchange($index,dtl.HSN_Code,dtl.Unit_price,dtl.qty,dtl.Discount,dtl.hsn_igstrate);dtl.detailProduct_name =item.product_name;dtl.detailProduct_gid =item.product_gid"
                                                                 md-items="item in querySearch(dtl.product_name,'Product')"
                                                                 md-item-text="item.product_name"
                                                                 md-min-length=0>
                                                    <md-item-template>
                                                        <span md-highlight-text="dtl.HSN_Code"> {{item.product_name}} </span>
                                                    </md-item-template>
                                                    <md-not-found>
                                                        No product matching "{{searchText}}" were found.
                                                    </md-not-found>
                                                </md-autocomplete>
                                                <span>IS-RCM:  <a>{{selectedItem.product_isrcm}}</a> IS-BLOCKED:  <a>{{selectedItem.product_isblocked}}</a> </span>

                                            </td>


                                            <td>
                                                <md-autocomplete style="min-width: 145px;"

                                                                 ng-disabled="!checkboxModel.value"
                                                                 md-no-cache="true"
                                                                 md-selected-item="selectedItems"
                                                                 md-search-text="dtl.HSN_Code"
                                                                 md-selected-item-change="dtl.hsn_igstrate =item.hsn_igstrate;ACselectchange($index,dtl.HSN_Code,dtl.Unit_price,dtl.qty,dtl.Discount,dtl.hsn_igstrate);dtl.detailProduct_name =item.product_name"
                                                                 md-items="item in querySearch(dtl.HSN_Code,'hsn')"
                                                                 md-item-text="item.hsn_code"
                                                                 md-min-length=0>
                                                    <md-item-template>
                                                        <span md-highlight-text="dtl.HSN_Code"> {{item.display}} </span>
                                                    </md-item-template>
                                                    <md-not-found>
                                                        No product matching "{{searchText}}" were found.
                                                    </md-not-found>
                                                </md-autocomplete>
                                                <span>HSN-PERCENT : <div
                                                        ng-if="selectedItem.hsn_igstrate > 0 && selectedItems.hsn_igstrate == undefined"> <a>{{selectedItem.hsn_igstrate}}</a></div><div
                                                        ng-if="selectedItems.hsn_igstrate > 0"> <a>{{selectedItems.hsn_igstrate}}</a></div> %</span>
                                            </td>

                                            <td align="right"><input class="textboxgeneral" maxlength="32" valid-number
                                                                     ng-disabled="invoiceview"
                                                                     ng-change="ACselectchange($index,dtl.HSN_Code,dtl.Unit_price,dtl.qty,dtl.Discount,dtl.hsn_igstrate)"
                                                                     ng-blur="product_rate($index)"
                                                                     style="width:100px"
                                                                     ng-model="dtl.Unit_price"/>
                                            </td>
                                            <td align="right"><input class="textboxgeneral" maxlength="8" numbers-only
                                                                     ng-disabled="invoiceview"
                                                                     style="width:100px"
                                                                     ng-change="ACselectchange($index,dtl.HSN_Code,dtl.Unit_price,dtl.qty,dtl.Discount,dtl.hsn_igstrate)"
                                                                     ng-model="dtl.qty" ng-blur="product_rate($index)"/>
                                            </td>


                                            <td align="right">{{dtl.Amount | number: 2}}</td>
                                            <td align="right"><input class="textboxgeneral" maxlength="32" valid-number
                                                                     ng-disabled="invoiceview"
                                                                     style="width:100px"
                                                                     ng-change="ACselectchange($index,dtl.HSN_Code,dtl.Unit_price,dtl.qty,dtl.Discount,dtl.hsn_igstrate)"
                                                                     ng-model="dtl.Discount"
                                                                     ng-blur="product_rate($index)"/></td>
                                            <td align="right">{{dtl.Amount_todb | number: 2}}</td>
                                            <td align="right"><input ng-disabled="!GSTKEYIN.value"
                                                                     class="textboxgeneral"
                                                                     ng-change="ACselectchange($index,dtl.HSN_Code,dtl.Unit_price,dtl.qty,dtl.Discount,dtl.hsn_igstrate)"
                                                                     style="width:100px"
                                                                     maxlength="32" valid-number
                                                                     ng-model="dtl.IGST"
                                                                     ng-blur="product_rate($index)"/></td>
                                            <td align="right">
                                                <input valid-number
                                                       ng-disabled="!GSTKEYIN.value"
                                                       ng-change="ACselectchange($index,dtl.HSN_Code,dtl.Unit_price,dtl.qty,dtl.Discount,dtl.hsn_igstrate)"
                                                       style="width:100px"
                                                       class="textboxgeneral"
                                                       maxlength="32"
                                                       ng-model="dtl.CGST" ng-blur="product_rate($index)"/>
                                            </td>
                                            <td align="right"><input valid-number
                                                                     ng-disabled="!GSTKEYIN.value"
                                                                     ng-change="ACselectchange($index,dtl.HSN_Code,dtl.Unit_price,dtl.qty,dtl.Discount,dtl.hsn_igstrate)"
                                                                     style="width:100px"
                                                                     class="textboxgeneral"
                                                                     maxlength="32"
                                                                     ng-model="dtl.SGST"
                                                                     ng-blur="product_rate($index)"/></td>
                                            <td align="right">{{dtl.Total_amount | number: 2}}</td>
                                            <td align="center"><a href="" ng-click="deleteinvoice($index)"><i
                                                    class="material-icons"
                                                    style="material-icons.line-height:3px">delete</i></a>
                                            </td>
                                            <span style="display: none;">Total: {{ getInvTotal() }}</span>

                                        </tr>
                                        </tbody>
                                        <tfoot>
                                        <tr>
                                            <td>
                                                Total
                                            </td>
                                            <td></td>
                                            <td ng-show="imprest_view"></td>
                                            <td></td>
                                            <td></td>

                                            <td></td>

                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td>{{Amount_todb_sum | number:2}}</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td>{{calculatePay | number:2}}</td>
                                            <td></td>
                                        </tr>
                                        </tfoot>


                                    </table>
                                </div>

                                <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                       ng-show="isSet(4)" ng-hide="!podetail">
                                    <thead class="header">

                                    <tr>
                                        <th>S.No</th>
                                        <th>Item</th>
                                        <th>Desc</th>
                                        <th>Hsn Code / percent</th>
                                        <th>Unit Price</th>
                                        <th>Qty</th>
                                        <th>Amount</th>
                                        <th>IGST</th>
                                        <th>CGST</th>
                                        <th>SGST</th>
                                        <th>Total Amount</th>
                                        <th>Action</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="dtl in invoicePOdetails ">
                                        <td>{{$index+1}}
                                        </td>
                                        <td ng-model="dtl.item">{{dtl.Item_Name}}
                                        </td>
                                        <td ng-model="dtl.description">{{dtl.description}}</td>
                                        <td>{{dtl.HSN_Code}}</td>
                                        <td align="right" ng-model="dtl.Unit_price">{{dtl.Unit_Price}}</td>
                                        <td align="right" ng-model="dtl.qty">{{dtl.Quantity}}</td>
                                        <td align="right">{{dtl.Amount}}</td>
                                        <td align="right" ng-model="dtl.IGST">{{dtl.IGST}}</td>
                                        <td align="right" ng-model="dtl.CGST">{{dtl.CGST}}</td>
                                        <td align="right" ng-model="dtl.SGST">{{dtl.SGST}}
                                        </td>
                                        <td align="right">{{dtl.Total_Amount | number:2}}</td>
                                        <td></td>
                                    </tr>
                                    </tbody>
                                    <tfoot>
                                    <tr>
                                        <td>
                                            Total
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td align="right">{{calculatePay | number:2}}</td>
                                        <td></td>
                                    </tr>
                                    </tfoot>

                                </table>
                                <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                       ng-show="isSet(2)">
                                    <thead class="header">
                                    <tr>
                                        <!--                            <th>S.No</th>-->
                                        <th>Inv Slno</th>
                                        <th>Category</th>
                                        <th>Sub Category</th>
                                        <th>GL No</th>
                                        <th>BS</th>
                                        <th>CC</th>
                                        <th>Amount</th>
                                        <th>Adjustment Amt</th>
                                        <th>Split</th>
                                        <th>Amount</th>
                                        <th>Percentage</th>
                                        <th>Action</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-if="0" ng-repeat-start="dtll in invoicedetails">

                                    <tr ng-repeat="dtl in dtll.DEBIT_DETAILS">

                                        <!--                            <td>-->
                                        <!--                                <center>{{$parent.$parent.$index + $index+1}}</center>-->
                                        <!--                            </td>-->
                                        <td>
                                            <center>{{dtl.Inv_Sl_no}}</center>
                                        </td>
                                        <td>
                                            <md-input-container class="md-block inputcontainer">
                                                <label>Category</label>
                                                <md-select ng-model="dtl.Category_Gid" ng-disabled="dtl.ISAMOUNT == 'N'"
                                                           required>
                                                    <md-option ng-repeat="x in tablevalue"
                                                               ng-click="category_click(x.category_gid,$parent.$index,$parent.$parent.$index);dtl.category_name = x.category_name"
                                                               ng-value="x.category_gid">{{ x.category_code }}
                                                    </md-option>
                                                </md-select>
                                            </md-input-container>
                                            <span> <a>{{dtl.category_name}}</a></span>
                                        </td>
                                        <td align="center">
                                            <md-input-container class="md-block inputcontainer">
                                                <label>Sub Category</label>
                                                <md-select ng-model="dtl.Sub_Category_Gid"
                                                           ng-disabled="dtl.ISAMOUNT == 'N'"
                                                           required>
                                                    <md-option ng-repeat="x in dtl.subcategory"
                                                               ng-click="glno_click(x,$parent.$index,$parent.$parent.$index,dtl.subcategory);dtl.subcategory_name = x.subcategory_name;dtl.gldesc = x.gl_name"

                                                               ng-value="x.subcategory_gid">{{
                                                        x.subcategory_code }}
                                                    </md-option>
                                                </md-select>
                                            </md-input-container>
                                            <span> <a>{{dtl.subcategory_name}}</a></span>
                                        </td>
                                        <td><input class="textboxgeneral" no-special-char maxlength="32"
                                                   ng-disabled="true"
                                                   style="width:150px"
                                                   ng-model="dtl.GL_No"/>
                                            <span> <a>{{dtl.gldesc}}</a></span>
                                        </td>
                                        <td align="center">
                                            <md-input-container class="md-block inputcontainer">
                                                <label>bs</label>
                                                <md-select ng-model="dtl.bs_gid" ng-disabled="dtl.ISAMOUNT == 'N'"
                                                           required>
                                                    <md-option ng-repeat="x in bsvalue"
                                                               ng-click="bs_click(x.tbs_gid,$parent.$index,$parent.$parent.$index)"
                                                               ng-value="x.tbs_gid">{{ x.tbs_name }}
                                                    </md-option>
                                                </md-select>
                                            </md-input-container>
                                        </td>
                                        <td align="center">
                                            <md-input-container class="md-block inputcontainer">
                                                <label>cc</label>
                                                <md-select ng-model="dtl.cc_gid" ng-disabled="dtl.ISAMOUNT == 'N'"
                                                           required>
                                                    <md-option ng-repeat="x in dtl.CC_DropData"
                                                               ng-click="cc_click(x,$parent.$index,$parent.$parent.$index,dtl.subcategory)"
                                                               ng-value="x.tcc_gid">{{ x.tcc_name }}
                                                    </md-option>
                                                </md-select>
                                            </md-input-container>
                                        </td>

                                        <td align="right"><input class="textboxgeneral" ng-disabled="dtll.Debit_checked"
                                                                 valid-number
                                                                 maxlength="32"
                                                                 style="width:150px"
                                                                 ng-model="dtl.Debit_Amount"
                                        />
                                        </td>

                                        <td align="right"><input class="textboxgeneral"
                                                                 valid-number
                                                                 maxlength="32"
                                                                 style="width:150px"
                                                                 ng-model="dtl.Deduction_amt"
                                                                 ng-change="debit_deductionchange($index,$parent.$index,dtl)"
                                        />
                                        <td align="center"><a href="" ng-hide="dtl.ISAMOUNT != 'Y'"
                                                              ng-click="Debit_split($index,$parent.$index)"><i
                                                class="material-icons">
                                            call_split
                                        </i></a>

                                        </td>
                                        <td align="right"><input class="textboxgeneral"
                                                                 ng-disabled="dtl.ISAMOUNT == 'N'"
                                                                 valid-number
                                                                 maxlength="32"
                                                                 style="width:150px"
                                                                 ng-model="dtl.Debit_Amount "
                                                                 ng-blur="debit_rate($index,$parent.$index,dtl.Debit_Amount,dtl.Debit_percentage)"/>
                                        </td>
                                        <td align="right"><input class="textboxgeneral"
                                                                 ng-disabled="dtl.ISAMOUNT == 'N'"
                                                                 valid-number
                                                                 style="width:150px"
                                                                 maxlength="32"
                                                                 ng-model="dtl.Debit_percentage"
                                                                 ng-change="debit_rate_percentage($index,$parent.$index,dtl.Debit_Amount,dtl.Debit_percentage)"/>
                                        </td>
                                        <td align="center"><a href="" ng-click="deletedebit($index,$parent.$index)"
                                        ><i
                                                class="material-icons"
                                                style="material-icons.line-height:3px">delete</i></a>
                                        </td>
                                        <span style="display: none;">Total: {{ getTotal() }}</span>
                                    </tr>
                                    <tr ng-if="0" ng-repeat-end></tr>
                                    </tr>
                                    </tbody>

                                </table>
                                <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                       ng-show="isSet(3)">
                                    <thead class="header">
                                    <tr>
                                        <th>S.No</th>
                                        <th>Paymode</th>
                                        <th>Acc Detail</th>
                                        <th>Transaction/payable branch</th>
                                        <th>Refno</th>
                                        <th>Bank Name</th>
                                        <th>Branch Name</th>
                                        <th>IFSC Code</th>
                                        <th>Beneficiary Name</th>
                                        <th>Tax Type</th>
                                        <th>Tax Rate</th>
                                        <th>TDS Excempt</th>
                                        <th>Taxable Amt</th>
                                        <th>Gl No</th>

                                        <th>Amount</th>
                                        <th>Amount change</th>
                                        <th>Action</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="dtl in Creditdetail.slice(((currentPage-1)*itemsPerPage), ((currentPage)*itemsPerPage))  | filter:searchquery ">
                                        <td>
                                            <center>{{((currentPage-1)*itemsPerPage)+$index+1}}</center>
                                        </td>
                                        <td ng-show="!create_screen">
                                            <md-input-container class="md-block inputcontainer"
                                            >
                                                <label>Payment Mode</label>
                                                <md-select ng-model="dtl.Paymode_Gid"
                                                           ng-disabled="dtl.Ref_No == 'DEDUCTION'"
                                                           required>
                                                    <md-option ng-repeat="x in dtl.paymode_dropdwn"
                                                               ng-click="paymodeclick($parent.$index,x.Paymode_name,x.paymode_glno,x.paymode_gid )"
                                                               ng-selected="dtl.Paymode_name ==  x.Paymode_name "
                                                               ng-value="x.paymode_gid">{{ x.Paymode_name }}
                                                    </md-option>
                                                </md-select>
                                            </md-input-container>
                                            <!--<span style="padding: 22px" ng-hide="dtl.bankdetails_beneficiaryname !== ''">{{dtl.Paymode_name}}</span>-->
                                        </td>
                                        <td ng-show="!create_screen">
                                            <md-input-container class="md-block inputcontainer"
                                                                ng-show="dtl.Paymode_name == 'NEFT' || dtl.Paymode_name == 'ERA' || dtl.Paymode_name == 'BRA' || dtl.Paymode_name == 'KVBAC' "
                                            >
                                                <label>Acc no</label>
                                                <md-select ng-model="dtl.Ref_No" required>
                                                    <md-option
                                                            ng-repeat="x in Credit  | filter:{ Paymode_name: dtl.Paymode_name }"
                                                            ng-click="Accnoclick($parent.$index,x)"

                                                            ng-value="x.bankdetails_acno">{{ x.bankdetails_acno }}
                                                    </md-option>
                                                </md-select>
                                            </md-input-container>
                                            <!--<span style="padding: 22px" ng-hide="dtl.bankdetails_beneficiaryname !== ''">{{dtl.Paymode_name}}</span>-->
                                        </td>
                                        <td ng-show="create_screen">
                                            {{dtl.Paymode_name}}
                                        </td>
                                        <td>
                                            <div ng-hide="dtl.Paymode_name != 'DD'">
                                                <md-autocomplete

                                                        md-clear-button="true" md-floating-label="Payable Branch"
                                                        md-input-maxlength=126
                                                        md-item-text="itemm.branch_code"
                                                        md-items="itemm in soourcedata(dtl.paybranch)"

                                                        md-min-length=0 md-search-text="dtl.paybranch"
                                                        ng-model="itemss" md-no-cache="true" size="5"
                                                        md-selected-item="itemm.branch_code">
                                                    <md-item-template>
                                                        <span md-highlight-text="searchbrancheName"> {{itemm.branch_code}}</span>
                                                    </md-item-template>
                                                    <md-not-found>
                                                        No Branch Name matching "{{search Branch Name}}"
                                                        were
                                                        found.
                                                    </md-not-found>
                                                </md-autocomplete>
                                                <md-autocomplete

                                                        md-clear-button="true" md-floating-label="Transaction Branch"
                                                        md-input-maxlength=126
                                                        md-item-text="item.branch_code"
                                                        md-items="item in soourcedata(dtl.trnbranch)"

                                                        md-min-length=0 md-search-text="dtl.trnbranch"
                                                        ng-model="itemss" md-no-cache="true" size="5"
                                                        md-selected-item="item.branch_code">
                                                    <md-item-template>
                                                        <span md-highlight-text="searchbrancheName"> {{item.branch_code}}</span>
                                                    </md-item-template>
                                                    <md-not-found>
                                                        No Branch Name matching "{{search Branch Name}}"
                                                        were
                                                        found.
                                                    </md-not-found>
                                                </md-autocomplete>
                                            </div>
                                        </td>
                                        <td>{{dtl.Ref_No}}</td>
                                        <td>{{dtl.bank_name}}</td>
                                        <td>{{dtl.bankbranch_name}}</td>
                                        <td align="center">{{dtl.bankbranch_ifsccode}}
                                        </td>
                                        <td>{{dtl.bankdetails_beneficiaryname}}</td>
                                        <td ng-show="!create_screen">
                                            <md-input-container class="md-block inputcontainer" ng-show="dtl.TDS_Click">
                                                <label>TYPE</label>
                                                <md-select ng-model="dtl.Rate_type"
                                                           required>
                                                    <md-option ng-repeat="x in Tax_Type"
                                                               ng-click="Tax_click($parent.$index,x)"
                                                               ng-value="x.Rate_type">{{ x.Type }} - {{x.Rate}}
                                                        <!--                                            <span ng-model="dtl.Tax_Type" ng-init="dtl.Tax_Type =x.Type"></span>-->

                                                    </md-option>
                                                </md-select>
                                            </md-input-container>
                                        </td>
                                        <td ng-show="create_screen">{{dtl.Tax_Type}}</td>
                                        <td align="right">{{dtl.Tax_Rate}}</td>
                                        <td align="right">{{dtl.TDS_Exempt}}</td>
                                        <td align="right"><input class="textboxgeneral" ng-model="dtl.taxable_amt"
                                                                 valid-number
                                                                 ng-show="dtl.TDS_Click"
                                                                 style="width:150px"
                                                                 ng-change="Taxableamt_change($index,dtl.taxable_amt)"/>
                                        </td>
                                        <td><input class="textboxgeneral"
                                                   ng-disabled="true"
                                                   style="width:150px"
                                                   ng-model="dtl.GL_No"
                                        /></td>

                                        <td align="right"><input class="textboxgeneral" valid-number
                                                                 ng-disabled="invoiceview"
                                                                 style="width:100px"
                                                                 ng-model="dtl.Credit_Amount | number:2 "
                                                                 ng-change="credit_rate()"/></td>

                                        <td align="right"><input class="textboxgeneral" valid-number
                                                                 style="width:100px"
                                                                 ng-model="dtl.change_Amount "
                                                                 ng-change="changecredit_rate(dtl.change_Amount,$index)"/>
                                        </td>
                                        <td align="center"><a href=""
                                                              ng-click="deletecredit($index)" ng-hide="invoiceview"><i
                                                class="material-icons"
                                                style="material-icons.line-height:3px">delete</i></a></td>
                                    </tr>
                                    </tbody>

                                </table>
                                <div ng-show="isSet(1)">
                                    <div class="row ">
                                        <div class="col-lg-12 col-sm-12 pull-right">
                                            <div class="col-md-2 pull-right">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Rounding Off</label>
                                                    <input ng-model="othrchrges" ng-change="chargesenter()" valid-number
                                                           maxlength="32" required/>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row ">
                                        <div class="col-lg-12 col-sm-12 pull-right">
                                            <div class="col-md-2 pull-right">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Other Adjustment
                                                    </label>
                                                    <input ng-model="othrdeduction"
                                                           ng-disabled="other_deduction" valid-number
                                                           maxlength="32" required/>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row ">
                                        <div class="col-lg-12 col-sm-12 pull-right">
                                            <div class="col-md-2 pull-right">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Net Amount</label>
                                                    <input ng-model="netamt  | number:2" ng-disabled="true"
                                                           maxlength="160"
                                                           required/>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div ng-show="isSet(4)">
                                    <div class="row ">
                                        <div class="col-lg-12 col-sm-12 pull-right">
                                            <div class="col-md-2 pull-right">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Rounding Off</label>
                                                    <input ng-model="othrchrges" ng-change="chargesenter()"
                                                           ng-disabled="other_charge" valid-number
                                                           maxlength="32" required/>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row ">
                                        <div class="col-lg-12 col-sm-12 pull-right">
                                            <div class="col-md-2 pull-right">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Other Adjustment
                                                    </label>
                                                    <input ng-model="othrdeduction"
                                                           ng-disabled="other_deduction" valid-number
                                                           maxlength="32" required/>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row ">
                                        <div class="col-lg-12 col-sm-12 pull-right">
                                            <div class="col-md-2 pull-right">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Net Amount</label>
                                                    <input ng-model="netamt  | number:2" ng-disabled="true"
                                                           maxlength="160"
                                                           required/>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="row " ng-show="isSet(2)">
                                        <div class="row ">
                                            <div class="col-lg-12 col-sm-12 pull-right">
                                                <div class="col-md-2 pull-right">
                                                    <md-input-container class="md-block inputcontainer">
                                                        <label>Rounding Off</label>
                                                        <input ng-model="othrchrges" ng-change="chargesenter()"
                                                               valid-number
                                                               maxlength="32" required/>
                                                    </md-input-container>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row ">
                                            <div class="col-lg-12 col-sm-12 pull-right">
                                                <div class="col-md-2 pull-right">
                                                    <md-input-container class="md-block inputcontainer">
                                                        <label>Other Adjustment
                                                        </label>
                                                        <input ng-model="othrdeduction"
                                                               ng-disabled="other_deduction" valid-number
                                                               maxlength="32" required/>
                                                    </md-input-container>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-12 col-sm-12 pull-right">
                                            <div class="col-md-2 pull-right">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Debit Net Amount</label>
                                                    <input ng-model="debit_netamt | number:2" ng-disabled="true"
                                                           maxlength="160"
                                                           required/>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="row " ng-show="isSet(3)">
                                        <div class="row ">
                                            <div class="col-lg-12 col-sm-12 pull-right">
                                                <div class="col-md-2 pull-right">
                                                    <md-input-container class="md-block inputcontainer">
                                                        <label>Other Adjustment
                                                        </label>
                                                        <input ng-model="othrdeduction"
                                                               ng-disabled="other_deduction" valid-number
                                                               maxlength="32" required/>
                                                    </md-input-container>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-12 col-sm-12">
                                            <div class="col-md-2" ng-hide="viaecf==false">
                                                <label>TDS Applicability:{{invoiceheader_tds}}</label>
                                            </div>
                                            <div class="col-md-8">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Payment / TDS Instruction</label>
                                                    <input ng-model="payment_ins">
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-2">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>credit Net Amount</label>
                                                    <input ng-model="credit_netamt  | number:2" ng-disabled="true"
                                                           maxlength="160"
                                                           required/>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row ">
                                    <div class="col-lg-12 col-sm-12 text-right">
                                        <md-button ng-click="unlock_data()" ng-hide="approval" class="md-raised">
                                            Close
                                            <md-tooltip>Close</md-tooltip>
                                        </md-button>
                                        <md-button ng-click="save_details('CHECKER',' ')" ng-hide="hide_show"
                                                   class="md-raised md-warn">Submit
                                            <md-tooltip>Submit</md-tooltip>
                                        </md-button>
                                    </div>
                                </div>
                                <div class="row  text-left" ng-show="approval">
                                    <form role="form" name="approvel">
                                        <div class="col-lg-3 col-sm-3 ">

                                            <md-input-container class="md-block inputcontainer">
                                                <label>Rejection Reason</label>
                                                <md-select ng-model="selectreason" ng-disabled="reproces" required
                                                           ng-disabled="">
                                                    <md-optgroup label="Rejection Reason">
                                                        <md-option ng-repeat="c in reasondropdown" ng-value="c">
                                                            {{c.rejectreason_reason}}
                                                        </md-option>
                                                    </md-optgroup>
                                                </md-select>
                                            </md-input-container>
                                        </div>
                                    </form>
                                    <div class="col-lg-3 col-sm-3 ">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Approval Remarks</label>
                                            <input id="prremarksapp" maxlength="256" ng-model="approvelremark"
                                                   ng-disabled="reproces" ng-change="approvelreject=''" required/>
                                        </md-input-container>
                                    </div>
                                    <div class="col-lg-6 col-sm-6 text-right">
                                        <md-button type="button" value="Approve"
                                                   ng-show="reproces" class="md-raised md-primary"
                                                   ng-click="apapproved('REPROCESS',approvelreject)">Reprocess
                                        </md-button>
                                        <md-button type="button" value="Reject" ng-click="claimrejectclick()"
                                                   class="md-raised md-warn"
                                                   ng-show="reproces">Reject
                                        </md-button>

                                        <md-button type="button" value="Reject"
                                                   ng-click="apapproved('Reject',approvelreject)"
                                                   class="md-raised md-warn"
                                                   ng-hide="reproces">Reject
                                        </md-button>
                                        <md-button type="button" value="Approve"
                                                   ng-click="apapproved('Approved',approvelremark)"
                                                   class="md-raised md-primary" ng-hide="reproces">Approve
                                        </md-button>
                                        <md-button ng-click="Close()" href="makersummary" class="md-raised">Close
                                            <md-tooltip>Close</md-tooltip>
                                        </md-button>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <!--                        <pre>{{invoicedetails| json}}</pre>-->
                    </div>

                    <div class="col-md-3" style="margin-top: 20px;">
                        <input class="ng-isolate-scope" file-model="files"
                               fileinput="file" id="file" multiple type="file"
                               onchange="angular.element(this).scope().imageUpload(event)"/>
                    </div>
                    <div class="col-md-2" style="margin-top: 35px;" ng-show="image_visible=='true'">
                        <button type="button" class="btn btn-info" ng-click="view_images_popup()">View Images
                        </button>
                    </div>

                </td>
            </tr>

            </tbody>
        </table>


        <div class="modal fade" id="mdl_present" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabel">
                            PPX Details
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                           md-progress="deferred">
                                        <thead class="header">
                                        <tr style="text-align:center">
                                            <th>S.No</th>
                                            <th>Received By</th>
                                            <th>Ref No</th>
                                            <th>Invoice no</th>
                                            <th>Branch Name</th>
                                            <th>Branch Code</th>
                                            <th>Po Number</th>
                                            <th>Intial amount</th>
                                            <th>Balance</th>
                                            <th>GL</th>
                                            <th>Liquidate</th>
                                            <th>Select</th>

                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="ppx in ppxdetails_grid">
                                            <td class="text-center" ng-model="dept_name">
                                                {{((currentPage-1)*itemsPerPage)+$index+1}}
                                            </td>
                                            <td>
                                                {{ppx.Advance_By}}
                                            </td>
                                            <td>
                                                {{ppx.invoiceheader_crno}}
                                            </td>
                                            <td>
                                                {{ppx.invoiceheader_invoiceno}}
                                            </td>
                                            <td>
                                                {{ppx.branch_name}}
                                            </td>
                                            <td>
                                                {{ppx.branch_code}}
                                            </td>
                                            <td>
                                                {{ppx.invoiceheader_ponumber}}
                                            </td>


                                            <td>
                                                {{ppx.ppxheader_amount}}
                                            </td>
                                            <td>
                                                {{ppx.ppxheader_balance}}
                                            </td>
                                            <td>
                                                {{ppx.debit_glno}}
                                            </td>
                                            <td>
                                                <input class="textboxgeneral" valid-number ng-change="qtyvalid(ppx)"
                                                       ng-model="ppx.Liquidate"
                                                       ng-change="credit_rate()"/>
                                            </td>

                                            <td align="center"><label><input type="checkbox"
                                                                             ng-click="toggleCheck(ppx)"></label>
                                            </td>
                                        </tr>
                                        </tbody>

                                    </table>
                                </div>
                            </div>
                            <div class="row ">
                                <div class="col-lg-12 col-sm-12 text-right">
                                    <md-button ng-click="Close()" data-dismiss="modal" class="md-raised">
                                        Close
                                    </md-button>
                                    <md-button ng-click="save_ppx()" ng-hide="hide_show"
                                               data-dismiss="modal" class="md-raised md-warn">Submit
                                    </md-button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="modal fade" id="mdl_ccbs" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">


                    <div class="modal-header popup-header">

                        <h5 class="modal-title" id="s">
                            Supplier Details
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>

                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-4">
                                    <md-autocomplete
                                            ng-disabled="selectedtype == 'PETTYCASH'"
                                            md-clear-button="true" md-floating-label="Choose Branch"
                                            md-input-maxlength=126
                                            md-item-text="item.branch_detail"
                                            md-items="item in soourcedata(invoicedetails[supplierindex].branch)"
                                            md-selected-item-change="branchNameChanged($index,item)"
                                            md-min-length=0 md-search-text="invoicedetails[supplierindex].branch"
                                            ng-model="itemss" md-no-cache="true" size="5"
                                            md-selected-item="item.branch_detail">
                                        <md-item-template>
                                            <span md-highlight-text="searchbrancheName"> {{item.branch_detail}}</span>
                                        </md-item-template>
                                        <md-not-found>
                                            No Branch Name matching "{{search Branch Name}}"
                                            were
                                            found.
                                        </md-not-found>
                                    </md-autocomplete>
                                </div>
                                <div class="col-md-3">
                                    <md-input-container class="md-block inputcontainer" ng-disabled="true">
                                        <!--ng-hide="!checkboxModel.value">-->
                                        <label>Branch GST No</label>
                                        <input ng-model="invoicedetails[supplierindex].dest_gstno" ng-disabled="true"
                                               maxlength="16"/>
                                    </md-input-container>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="col-md-3">
                                    <md-input-container class="md-block inputcontainer">
                                        <label>Supplier Name</label>
                                        <input ng-model="invoicedetails[supplierindex].suppliername" maxlength="160"
                                               required/>
                                    </md-input-container>
                                </div>
                                <div class="col-md-3">
                                    <md-input-container class="md-block inputcontainer">
                                        <label>Supplier Pin-Code</label>
                                        <input ng-model="invoicedetails[supplierindex].suppliercode" maxlength="160"
                                               required/>
                                    </md-input-container>
                                </div>
                                <div class="col-md-3">
                                    <md-input-container class="md-block inputcontainer">
                                        <label>Supplier Gst-No</label>
                                        <input ng-model="invoicedetails[supplierindex].suppliergstno" maxlength="160"
                                               required/>
                                    </md-input-container>
                                </div>
                                <div class="col-md-3">
                                    <md-input-container class="md-block inputcontainer">
                                        <label>Invoice No</label>
                                        <input ng-model="invoicedetails[supplierindex].invoiceno" maxlength="160"
                                               required/>
                                    </md-input-container>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="col-md-3">
                                    <md-input-container class="md-block inputcontainer">
                                        <label>Date</label>
                                        <md-datepicker md-hide-icons="calendar"
                                                       ng-model="invoicedetails[supplierindex].invoicedate"
                                                       md-hide-icons="calendar" ng-click="date"
                                                       ng-change="validate_date(invoicedetails[supplierindex].invoicedate)"
                                                       md-max-date="minDate" required></md-datepicker>
                                    </md-input-container>
                                    <!--                                    <p style="color:red;">{{six_month_date_alert}}</p>-->
                                </div>
                            </div>
                            <div class="row ">
                                <div class="col-lg-12 col-sm-12 text-right">
                                    <md-button ng-click="Close_supplier(supplierindex)" data-dismiss="modal"
                                               class="md-raised">
                                        Close
                                    </md-button>
                                    <md-button ng-click="save_supplierdata(supplierindex)"
                                               class="md-raised md-warn">Submit
                                    </md-button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="modal fade" id="audit_popup" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabela">
                            Audit checklist
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                           md-progress="deferred">
                                        <thead class="header">
                                        <tr style="text-align:center">
                                            <th>S.no</th>
                                            <th>Question</th>
                                            <th>Ok/NOT-OK</th>

                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="qs in qadetails">
                                            <td class="text-center">
                                                {{$index + 1}}
                                            </td>
                                            <td align="center" ng-click="invoicehistory(sum)">
                                                {{qs.auditchklist_question}}
                                            </td>
                                            <td align="center" ng-model="qs.selected">
                                                <div class="btn-group" id="statusa" data-toggle="buttons">
                                                    <label class="btn btn-default btn-on btn-xs "
                                                           ng-click="selected_chk($index,1)">
                                                        <input type="radio" checked="checked">OK</label>
                                                    <label class="btn btn-default btn-off btn-xs active"
                                                           ng-click="selected_chk($index,0)">
                                                        <input type="radio">NOT-OK</label>
                                                    <label class="btn btn-default btn-na btn-xs "
                                                           ng-click="selected_chk($index,2)">
                                                        <input type="radio">N/A</label>
                                                </div>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="row ">
                                <div class="col-md-12">
                                    <!--                                    <div class="col-md-3">-->
                                    <!--                                        <md-autocomplete-->
                                    <!--                                                md-clear-button="true" md-floating-label="Choose Reason"-->
                                    <!--                                                md-input-maxlength=126-->
                                    <!--                                                md-item-text="itempn.rejectreason_reason"-->
                                    <!--                                                md-items="itempn in getrejectName(searchrejectName)"-->
                                    <!--                                                md-selected-item-change="reasonNameChanged(itempn)"-->
                                    <!--                                                md-min-length=0 md-search-text="searchrejectName"-->
                                    <!--                                                ng-model="itempn" md-no-cache="true" size="5"-->
                                    <!--                                                md-selected-item="itempn.rejectreason_reason">-->
                                    <!--                                            <md-item-template>-->
                                    <!--                                                <span md-highlight-text="searchrejectName"> {{itempn.rejectreason_reason}}</span>-->
                                    <!--                                            </md-item-template>-->
                                    <!--                                            <md-not-found>-->
                                    <!--                                                No Reject matching "{{search Reject Name}}"-->
                                    <!--                                                were-->
                                    <!--                                                found.-->
                                    <!--                                            </md-not-found>-->
                                    <!--                                        </md-autocomplete>-->
                                    <!--                                    </div>-->

                                    <div class="col-md-5" ng-hide="apprver_view=='0'">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Remarks</label>
                                            <input ng-model="reject_remark" required/>
                                        </md-input-container>
                                    </div>
                                    <!--                                    <div class="col-md-2" ng-hide="main_status=='0'">-->
                                    <!--                                        <md-button class="md-raised custbutton" ng-disabled="!reject_remark"-->
                                    <!--                                                   ng-click="reject_set('REJECTED')">-->
                                    <!--                                            REJECT-->
                                    <!--                                        </md-button>-->
                                    <!--                                    </div>-->
                                    <div class="col-md-2" ng-hide="main_status=='0'">
                                        <md-button class="md-raised custbutton" ng-disabled="!reject_remark"
                                                   ng-click="save_details('BOUNCE',reject_remark)">
                                            BOUNCE
                                        </md-button>
                                    </div>
                                </div>
                                <div class="col-lg-12 col-sm-12 text-right">
                                    <md-button ng-click="Close()" data-dismiss="modal" class="md-raised">
                                        Close
                                    </md-button>
                                    <md-button ng-click="save_qa()" ng-hide="hide_show"
                                               data-dismiss="modal" class="md-raised md-warn">Submit
                                    </md-button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="view_tran_details" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document" style="width:70%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabels">
                            Transaction Details
                            <button type="button" class="close" data-dismiss="modal"
                                    ng-click="close_pr_popup()"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="body">
                        <form class="modal-body popup-body" name="supplier" novalidate>
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div class="row table-responsive">
                                        <div class="col-md-12 col-lg-12 col-sm-12">
                                            <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                                   md-progress="deferred">
                                                <thead class="header">
                                                <tr>
                                                    <th>S.No</th>
                                                    <th>Type</th>
                                                    <th>Status</th>
                                                    <th>From Date</th>
                                                    <th>Remarks</th>
                                                    <th>Employee Name</th>
                                                    <th>Approver Name</th>
                                                    <th>Approved By</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr align="center"
                                                    ng-repeat="ass in ecf_tran_summary.slice(((currentPages-1)*itemsPerPages),((currentPages)*itemsPerPages)) | filter:search:strict">
                                                    <td>{{((currentPages-1)*itemsPerPages)+$index+1}}
                                                    </td>
                                                    <td>{{ass.type}}</td>
                                                    <td>{{ass.tran_status}}</td>
                                                    <td>{{ass.tran_fromdate}}</td>
                                                    <td>{{ass.tran_remarks}}</td>
                                                    <td>{{ass.employee_name}}<br>
                                                        <span ng-hide="ass.employee_name==null"
                                                              ng-click=view_emp(ass.employee_gid) style="color:green">View Details</span>
                                                    </td>
                                                    <td>{{ass.approvername}}<br>
                                                        <span ng-hide="ass.approvername==null"
                                                              ng-click=view_emp(ass.approver_gid) style="color:green">View Details</span>
                                                    </td>
                                                    <td>{{ass.approvedby}}<br>
                                                        <span ng-hide="ass.approvedby==null"
                                                              ng-click=view_emp(ass.approveby_gid) style="color:green">View Details</span>
                                                    </td>

                                                </tr>
                                                </tbody>
                                                <tfoot>
                                                <tr align="center">
                                                    <td colspan="6">
                                                        <ul uib-pagination
                                                            total-items="ecf_tran_summary.length"
                                                            ng-model="currentPages"
                                                            max-size="maxSizes"
                                                            class="pagination-sm"
                                                            boundary-links="true"
                                                            items-per-page="itemsPerPages"></ul>
                                                    </td>
                                                    <td colspan="2">
                                                        Total Count:{{ecf_tran_summary.length}}
                                                    </td>
                                                </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-4">
                                        <span class="md-title title-color">Employee Name : </span>
                                        <span class="md-subhead">{{emp_details[0].employee_name}}</span>
                                    </div>
                                    <div class="col-md-4">
                                        <span class="md-title title-color">Branch Code : </span>
                                        <span class="md-subhead">{{emp_details[0].branch_code}}</span>
                                    </div>
                                    <div class="col-md-4">
                                        <span class="md-title title-color">Designation: </span>
                                        <span class="md-subhead">{{emp_details[0].designation_name}}</span>
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-md-offset-5">
                                    <md-button class="md-raised" value="close"
                                               aria-label="Close" data-dismiss="modal">Cancel
                                    </md-button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="show_file" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document" style="width:90%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="view_files">
                            {{url_data[0].file_name}}
                            <button type="button" class="close" data-dismiss="modal"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <br/>
                    <div class="body">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-12" align="center">
                                    <img src="{{url_data[0].file_path}}" alt="{{url_data[0].file_name}}"
                                         class="img-thumbnail" align="center">
                                    <hr/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-offset-6">
                                    <md-button class="md-raised md-warn" value="close" data-dismiss="modal"
                                               aria-label="Close">Cancel
                                    </md-button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="view_dedupe_data" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false" aria-labelledby="exampleModalLabel" aria-hidden="true" style="overflow:auto">
            <div class="modal-dialog modal-lg" role="document" style="width:80%">
                <div class="modal-content" style="overflow:auto;">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabel_dedupe">
                            DEDUPE
                            <button type="button" class="close" data-dismiss="modal"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="body" style="overflow:auto">
                        <form class="modal-body popup-body" name="dedube" novalidate>
                            <div class="row">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div class="colmd-1">
                                        <h4>EXACT_MATCH</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div class="row table-responsive">
                                        <div class="col-md-12 col-lg-12 col-sm-12">
                                            <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                                   md-progress="deferred">
                                                <thead class="header" style="background-color:#4E8888;">
                                                <tr>
                                                    <th>S.No</th>
                                                    <th>Invoice Number</th>
                                                    <th>Invoice Header Amount</th>
                                                    <th>Status</th>
                                                    <th>CR Number</th>
                                                    <th>Supplier Name</th>
                                                    <th>Branch Name</th>
                                                    <th>Employee Name</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr align="center"
                                                    ng-repeat="exc in exact_mathch.slice(((ex_mat_currentPage-1)*ex_mat_itemsPerPage),((ex_mat_currentPage)*ex_mat_itemsPerPage)) | filter:search:strict">
                                                    <td>
                                                        <center>
                                                            {{((ex_mat_currentPage-1)*ex_mat_itemsPerPage)+$index+1}}
                                                        </center>
                                                    </td>
                                                    <td>{{exc.invoiceheader_invoiceno}}</td>
                                                    <td>{{exc.invoiceheader_amount}}</td>
                                                    <td>{{exc.invoiceheader_status}}</td>
                                                    <td>{{exc.invoiceheader_crno}}</td>
                                                    <td>{{exc.supplier_name}}</td>
                                                    <td>{{exc.branch_name}}</td>
                                                    <td>{{exc.employee_name}}</td>

                                                </tr>
                                                <tr ng-show="exact_mathch.length == 0">
                                                    <td class="warning" colspan="12">
                                                        No Records Found.
                                                    </td>
                                                </tr>
                                                </tbody>
                                                <tfoot>
                                                <tr align="center">
                                                    <td colspan="7">
                                                        <ul uib-pagination
                                                            total-items="exact_mathch.length"
                                                            ng-model="ex_mat_currentPage"
                                                            max-size="ex_mat_maxSize"
                                                            class="pagination-sm"
                                                            boundary-links="true"
                                                            items-per-page="ex_mat_itemsPerPage"></ul>
                                                    </td>
                                                    <td colspan="2">
                                                        Total Amount:{{exact_mathch.length}}
                                                    </td>
                                                </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div class="colmd-1">
                                        <h4>WITHOUT_SUPPLIER</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div class="row table-responsive">
                                        <div class="col-md-12 col-lg-12 col-sm-12">
                                            <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                                   md-progress="deferred">
                                                <thead class="header" style="background-color:#4E8888;">
                                                <tr>
                                                    <th>S.No</th>
                                                    <th>Invoice Number</th>
                                                    <th>Invoice Header Amount</th>
                                                    <th>Status</th>
                                                    <th>CR Number</th>
                                                    <th>Supplier Name</th>
                                                    <th>Branch Name</th>
                                                    <th>Employee Name</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr align="center"
                                                    ng-repeat="with_sup in without_supplier.slice(((wi_out_sup_currentPage-1)*wi_out_sup_itemsPerPage),((wi_out_sup_currentPage)*itemsPerPage)) | filter:search:strict">
                                                    <td>
                                                        <center>
                                                            {{((wi_out_sup_currentPage-1)*wi_out_sup_itemsPerPage)+$index+1}}
                                                        </center>
                                                    </td>
                                                    <td>{{with_sup.invoiceheader_invoiceno}}</td>
                                                    <td>{{with_sup.invoiceheader_amount}}</td>
                                                    <td>{{with_sup.invoiceheader_status}}</td>
                                                    <td>{{with_sup.invoiceheader_crno}}</td>
                                                    <td>{{with_sup.supplier_name}}</td>
                                                    <td>{{with_sup.branch_name}}</td>
                                                    <td>{{with_sup.employee_name}}</td>

                                                </tr>
                                                <tr ng-show="without_supplier.length == 0">
                                                    <td class="warning" colspan="12">
                                                        No Records Found.
                                                    </td>
                                                </tr>
                                                </tbody>
                                                <tfoot>
                                                <tr align="center">
                                                    <td colspan="7">
                                                        <ul uib-pagination
                                                            total-items="without_supplier.length"
                                                            ng-model="wi_out_sup_currentPage"
                                                            max-size="wi_out_sup_maxSize"
                                                            class="pagination-sm"
                                                            boundary-links="true"
                                                            items-per-page="wi_out_sup_itemsPerPage"></ul>
                                                    </td>
                                                    <td colspan="2">
                                                        Total Count:{{without_supplier.length}}
                                                    </td>
                                                </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div class="colmd-1">
                                        <h4>WITHOUT_INVOICE_AMOUNT</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div class="row table-responsive">
                                        <div class="col-md-12 col-lg-12 col-sm-12">
                                            <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                                   md-progress="deferred">
                                                <thead class="header" style="background-color:#4E8888;">
                                                <tr>
                                                    <th>S.No</th>
                                                    <th>Invoice Number</th>
                                                    <th>Invoice Header Amount</th>
                                                    <th>Status</th>
                                                    <th>CR Number</th>
                                                    <th>Supplier Name</th>
                                                    <th>Branch Name</th>
                                                    <th>Employee Name</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr align="center"
                                                    ng-repeat="inv_amount in without_invoice_amount.slice(((wi_in_amt_currentPage-1)*wi_in_amt_itemsPerPage),((wi_in_amt_currentPage)*wi_in_amt_itemsPerPage)) | filter:search:strict">
                                                    <td>
                                                        <center>
                                                            {{((wi_in_amt_currentPage-1)*wi_in_amt_itemsPerPage)+$index+1}}
                                                        </center>
                                                    </td>
                                                    <td>{{inv_amount.invoiceheader_invoiceno}}</td>
                                                    <td>{{inv_amount.invoiceheader_amount}}</td>
                                                    <td>{{inv_amount.invoiceheader_status}}</td>
                                                    <td>{{inv_amount.invoiceheader_crno}}</td>
                                                    <td>{{inv_amount.supplier_name}}</td>
                                                    <td>{{inv_amount.branch_name}}</td>
                                                    <td>{{inv_amount.employee_name}}</td>

                                                </tr>
                                                <tr ng-show="without_invoice_amount.length == 0">
                                                    <td class="warning" colspan="12">
                                                        No Records Found.
                                                    </td>
                                                </tr>
                                                </tbody>
                                                <tfoot>
                                                <tr align="center">
                                                    <td colspan="7">
                                                        <ul uib-pagination
                                                            total-items="without_invoice_amount.length"
                                                            ng-model="wi_in_amt_currentPage"
                                                            max-size="wi_in_amt_maxSize"
                                                            class="pagination-sm"
                                                            boundary-links="true"
                                                            items-per-page="wi_in_amt_itemsPerPage"></ul>
                                                    </td>
                                                    <td colspan="2">
                                                        Total Count:{{without_invoice_amount.length}}
                                                    </td>
                                                </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div class="colmd-1">
                                        <h4>WITHOUT_INVOICE_NUMBER</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div class="row table-responsive">
                                        <div class="col-md-12 col-lg-12 col-sm-12">
                                            <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                                   md-progress="deferred">
                                                <thead class="header" style="background-color:#4E8888;">
                                                <tr>
                                                    <th>S.No</th>
                                                    <th>Invoice Number</th>
                                                    <th>Invoice Header Amount</th>
                                                    <th>Status</th>
                                                    <th>CR Number</th>
                                                    <th>Supplier Name</th>
                                                    <th>Branch Name</th>
                                                    <th>Employee Name</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr align="center"
                                                    ng-repeat="inv_nom in without_invoice_number.slice(((wi_in_num_currentPage-1)*wi_in_num_itemsPerPage),((wi_in_num_currentPage)*wi_in_num_itemsPerPage)) | filter:search:strict">
                                                    <td>
                                                        <center>
                                                            {{((wi_in_num_currentPage-1)*wi_in_num_itemsPerPage)+$index+1}}
                                                        </center>
                                                    </td>
                                                    <td>{{inv_nom.invoiceheader_invoiceno}}</td>
                                                    <td>{{inv_nom.invoiceheader_amount}}</td>
                                                    <td>{{inv_nom.invoiceheader_status}}</td>
                                                    <td>{{inv_nom.invoiceheader_crno}}</td>
                                                    <td>{{inv_nom.supplier_name}}</td>
                                                    <td>{{inv_nom.branch_name}}</td>
                                                    <td>{{inv_nom.employee_name}}</td>

                                                </tr>
                                                <tr ng-show="without_invoice_number.length == 0">
                                                    <td class="warning" colspan="12">
                                                        No Records Found.
                                                    </td>
                                                </tr>
                                                </tbody>
                                                <tfoot>
                                                <tr align="center">
                                                    <td colspan="7">
                                                        <ul uib-pagination
                                                            total-items="without_invoice_number.length"
                                                            ng-model="wi_in_num_currentPage"
                                                            max-size="maxSizes"
                                                            class="pagination-sm"
                                                            boundary-links="true"
                                                            items-per-page="wi_in_num_itemsPerPage"></ul>
                                                    </td>
                                                    <td colspan="2">
                                                        Total Count:{{without_invoice_number.length}}
                                                    </td>
                                                </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div class="colmd-1">
                                        <h4>WITHOUT_INVOICE_DATE</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div class="row table-responsive">
                                        <div class="col-md-12 col-lg-12 col-sm-12">
                                            <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                                   md-progress="deferred">
                                                <thead class="header" style="background-color:#4E8888;">
                                                <tr>
                                                    <th>S.No</th>
                                                    <th>Invoice Number</th>
                                                    <th>Invoice Header Amount</th>
                                                    <th>Status</th>
                                                    <th>CR Number</th>
                                                    <th>Supplier Name</th>
                                                    <th>Branch Name</th>
                                                    <th>Employee Name</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr align="center"
                                                    ng-repeat="inv_nom in without_invoice_date.slice(((wi_in_date_currentPage-1)*wi_in_date_itemsPerPage),((wi_in_date_currentPage)*wi_in_date_itemsPerPage)) | filter:search:strict">
                                                    <td>
                                                        <center>
                                                            {{((wi_in_date_currentPage-1)*wi_in_date_itemsPerPage)+$index+1}}
                                                        </center>
                                                    </td>
                                                    <td>{{inv_nom.invoiceheader_invoiceno}}</td>
                                                    <td>{{inv_nom.invoiceheader_amount}}</td>
                                                    <td>{{inv_nom.invoiceheader_status}}</td>
                                                    <td>{{inv_nom.invoiceheader_crno}}</td>
                                                    <td>{{inv_nom.supplier_name}}</td>
                                                    <td>{{inv_nom.branch_name}}</td>
                                                    <td>{{inv_nom.employee_name}}</td>

                                                </tr>
                                                <tr ng-show="without_invoice_date.length == 0">
                                                    <td class="warning" colspan="12">
                                                        No Records Found.
                                                    </td>
                                                </tr>
                                                </tbody>
                                                <tfoot>
                                                <tr align="center">
                                                    <td colspan="7">
                                                        <ul uib-pagination
                                                            total-items="without_invoice_date.length"
                                                            ng-model="wi_in_date_currentPage"
                                                            max-size="maxSizes"
                                                            class="pagination-sm"
                                                            boundary-links="true"
                                                            items-per-page="wi_in_date_itemsPerPage"></ul>
                                                    </td>
                                                    <td colspan="2">
                                                        Total Count:{{without_invoice_date.length}}
                                                    </td>
                                                </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-offset-5">
                                        <md-button class="md-raised" value="close" data-dismiss="modal"
                                                   aria-label="Close">Cancel
                                        </md-button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div aria-hidden="" aria-labelledby="exampleModalLabel"
             class="modal fade"
             data-backdrop="" data-keyboard="false"
             id="viewcreditgl">
            <div class="modal-dialog modal-md modal-style" role="document">
                <div class="modal-content">
                    <div class="header">
                        <div class="modal-header popup-header">
                            <h5 class="modal-title" id="exampleModalLabel1">
                                <strong>Credit GL</strong>
                                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </h5>
                        </div>
                    </div>
                    <br/>
                    <form name="creditgl_valid" novalidate role="form">
                        <div class="body">
                            <div class="modal-body popup-body">
                                <div class="row">
                                    <div class="col-lg-12 col-sm-12">
                                        <div class="row table-responsive">
                                            <div class="col-md-12 col-lg-12 col-sm-12">
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <md-input-container class="md-block inputcontainer">
                                                            <label>Paymode Name</label>
                                                            <input type="text" ng-model="paymode_data"
                                                                   disabled
                                                                   placeholder="Paymode Name">
                                                        </md-input-container>

                                                    </div>
                                                    <div class="col-md-3">
                                                        <md-input-container class="md-block inputcontainer"
                                                        >
                                                            <label>Credit Gl</label>
                                                            <md-select ng-model="select_creditgl" required>
                                                                <md-option ng-repeat="x in paymodedtl_dropdwn"
                                                                           ng-click=""
                                                                           ng-value="x">{{
                                                                    x.paymodedetails_glno }}
                                                                </md-option>
                                                            </md-select>
                                                        </md-input-container>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 text-center">
                                <md-button class="btn btn-info custbutton" ng-click="selected_creditgl()"
                                           ng-disabled="creditgl_valid.$invalid">Submit
                                    <md-tooltip>Submit</md-tooltip>
                                </md-button>
                                <md-button class="md-raised" data-dismiss="modal">Back
                                    <md-tooltip>close</md-tooltip>
                                </md-button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" data-backdrop="static"
             data-keyboard="false" id="viewnotepad" role="dialog" style="height:auto;width:100%">
            <div class="modal-dialog modal-lg modal-style" style="width:1200px" role="document">
                <div class="modal-content">
                    <div class="header">
                        <div class="modal-header popup-header">
                            <h5 class="modal-title" id="exampleModalLabelsss">
                                <strong> Note Pad</strong>
                                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </h5>
                        </div>
                    </div>
                    <div class="body">
                        <div class="modal-body popup-body">
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div text-angular="text-angular" id="con" name="htmlcontent"
                                         ng-focus="displaynamechng('content_flag')"
                                         ng-model="htmlcontent">

                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <md-button class="md-raised" data-dismiss="modal">Back
                                <md-tooltip>close</md-tooltip>
                            </md-button>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="modal fade" id="view_images" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document" style="width:90%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabels2">
                            ALL IMAGES
                            <button type="button" class="close" data-dismiss="modal"
                                    ng-click="close_pr_popup()"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="body">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="center" ng-show="file_path.length=='0'">
                                    <h3>No Attached File</h3>
                                </div>
                                <div class="col-md-offset-10" ng-show="file_path.length!='0'">
                                    <span class="editlink" ng-click="remove_all_files()">
                                    <span class="material-icons removelink">delete</span>
                                <md-tooltip>Remove All</md-tooltip>
                                </span>
                                    <span>Remove All</span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div ng-repeat="files in file_path">
                                    <div class="col-md-10">
                                        <h5 style="color:blue">{{files.file_name}}</h5>
                                        <img src="{{files.file}}" alt="{{files}}" ng-hide="files.extension=='pdf'"
                                             class="myimage img-responsive thumbnail">

                                        <object width="870px" height="500px" ng-show="files.extension=='pdf'"
                                                data="{{files.file}}" class="internal">
                                            <embed src="{{files.file}}"/>
                                            <br/>
                                        </object>
                                        <hr/>
                                    </div>
                                    <div class="col-md-1" style="margin-top:200px;">
                                        <span class="editlink" ng-click="delete_one_file($index,files.file_name)">
                                        <span class="material-icons removelink">delete</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-offset-6">
                                <md-button class="md-raised md-warn" value="close" data-dismiss="modal"
                                           aria-label="Close">OK
                                </md-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="Tds_Details" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false" aria-labelledby="exampleModalLabel" aria-hidden="true" style="overflow:auto">
            <div class="modal-dialog modal-lg" role="document" style="width:80%">
                <div class="modal-content" style="overflow:auto;">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabel_tds">
                            TDS Details
                            <button type="button" class="close" data-dismiss="modal"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="body" style="overflow:auto">
                        <form class="modal-body popup-body" name="dedube" novalidate>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-10"><h4>Supplier Name : {{supplier_name_}}</h4></div>
                                </div>
                            </div>
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                           md-progress="deferred">
                                        <thead class="header">
                                        <tr>
                                            <th>S.No</th>
                                            <th>CR Number</th>
                                            <th>Taxable Amount</th>
                                            <th>Tax Type</th>
                                            <th>TDS Rate</th>
                                            <th>TDS Amount</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="tds in Tax_Amount_Data.slice(((tds_currentPage-1)*tds_itemsPerPage),((tds_currentPage)*tds_itemsPerPage)) | filter:search:strict">
                                            <td>
                                                <center>
                                                    {{((tds_currentPage-1)*tds_itemsPerPage)+$index+1}}
                                                </center>
                                            </td>
                                            <td class="text-center">{{tds.invoiceheader_crno}}</td>
                                            <td class="text-center">{{tds.invoiceheader_taxableamt}}</td>
                                            <td class="text-center">{{tds.credit_suppliertaxtype}}</td>
                                            <td class="text-center">{{tds.credit_taxableamount}}</td>
                                            <td class="text-center">{{tds.credit_amount}}</td>
                                        </tr>
                                        <tr ng-show="Tax_Amount_Data.length == 0">
                                            <td class="warning" colspan="4">
                                                No Records Found.
                                            </td>
                                        </tr>
                                        </tbody>
                                        <tfoot>
                                        <tr align="center">
                                            <td colspan="2" class="text-center">
                                                <ul uib-pagination
                                                    total-items="Tax_Amount_Data.length"
                                                    ng-model="tds_currentPage"
                                                    max-size="tds_maxSize"
                                                    class="pagination-sm"
                                                    boundary-links="true"
                                                    items-per-page="tds_itemsPerPage"></ul>
                                            </td>
                                            <td colspan="1" class="text-center">
                                                Total:{{total_taxable_amount}}
                                            </td>
                                            <td colspan="3" class="text-center">
                                                Total Records:{{Tax_Amount_Data.length}}
                                            </td>
                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                           md-progress="deferred">
                                        <thead class="header">
                                        <tr>
                                            <th>S.No</th>
                                            <th>Section</th>
                                            <th>Threshold Limit</th>
                                            <th>Taxable Amount Total</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="tds in Subtax_Amount_Data.slice(((tds_g_currentPage-1)*tds_g_itemsPerPage),((tds_g_currentPage)*tds_g_itemsPerPage)) | filter:search:strict">
                                            <td>
                                                <center>
                                                    {{((tds_g_currentPage-1)*tds_g_itemsPerPage)+$index+1}}
                                                </center>
                                            </td>
                                            <td class="text-center">{{tds.subtax_name}}</td>
                                            <td class="text-center">{{tds.subtax_amount}}</td>
                                            <td class="text-center">{{total_taxable_amount}}</td>
                                        </tr>
                                        <tr ng-show="single_tds_group_by_gdetails.length == 0">
                                            <td class="warning" colspan="6">
                                                No Records Found.
                                            </td>
                                        </tr>
                                        </tbody>
                                        <tfoot>
                                        <tr align="center">
                                            <td colspan="3" align="center">
                                                <ul uib-pagination
                                                    total-items="Subtax_Amount_Data.length"
                                                    ng-model="tds_g_currentPage"
                                                    max-size="tds_g_maxSize"
                                                    class="pagination-sm"
                                                    boundary-links="true"
                                                    items-per-page="tds_g_itemsPerPage"></ul>
                                            </td>
                                            <td colspan="2" align="center">
                                                Total Records:{{Subtax_Amount_Data.length}}
                                            </td>
                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-offset-5">
                                    <md-button class="md-raised" value="close" data-dismiss="modal"
                                               aria-label="Close">Close
                                    </md-button>
                                </div>
                            </div>
                            <div class="row"></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>


    </div>
</div>
{% endverbatim %}
<style>



 h5 {
    margin-top: -24px;
    margin-bottom: 10px;
    align-items: right;
}

.title-color{
color:#2159A6;
}






.btn-default.btn-on.active{background-color: #5BB75B;color: white;}
.btn-default.btn-off.active{background-color: #DA4F49;color: white;}
.btn-default.btn-off.active{background-color: #DA4F49;color: white;}

.btn-default.btn-on-1.active{background-color: #006FFC;color: white;}
.btn-default.btn-off-1.active{background-color: #DA4F49;color: white;}

.btn-default.btn-on-2.active{background-color: #00D590;color: white;}
.btn-default.btn-off-2.active{background-color: #A7A7A7;color: white;}

.btn-default.btn-on-3.active{color: #5BB75B;font-weight:bolder;}
.btn-default.btn-off-3.active{color: #DA4F49;font-weight:bolder;}

.btn-default.btn-on-4.active{background-color: #006FFC;color: #5BB75B;}
.btn-default.btn-off-4.active{background-color: #DA4F49;color: #DA4F49;}















































































































































</style>
<style>
 .md-select-menu-container.md-active {
    z-index: 1060;
    }
    .md-autocomplete-suggestions-container{
   z-index:100000 !important;
  }
    .md-dialog-container{
    z-index:100000 !important;
    }
    .thumb{
    width:100px;
    margin:5px;
    float:left;
}




table.rz-table {
   table-layout: fixed;
   border-collapse: collapse;
 }

table.rz-table th {
    position: relative;
    min-width: 25px;
}

table.rz-table th .rz-handle {
    width: 10px;
    height: 100%;
    position: absolute;
    top: 0;
    right: 0;
    cursor: ew-resize !important;
}

table.rz-table th .rz-handle.rz-handle-active {
    border-right: 1px dotted #000;
}

table {
  border-collapse: collapse;
}

table th {
  min-width: 10px;

}

table th, table td {
  text-align: left;
  overflow: auto;
  white-space: nowrap;
  text-overflow: ellipsis;
  padding: .75em;
  border-right: 1px solid green;
}

.rz-handle {
  background: repeating-linear-gradient(
    45deg,
    transparent,
    transparent 0px,
    rgba(0, 0, 0, 0.05) 2px,
    rgba(0, 0, 0, 0.05) 4px
  );


}






































































































































</style>
<script>(function (global) {

    if(typeof (global) === "undefined") {
        throw new Error("window is undefined");
    }

    var _hash = "!";
    var noBackPlease = function () {
        global.location.href += "#";

        // making sure we have the fruit available for juice (^__^)
        global.setTimeout(function () {
            global.location.href += "!";
        }, 50);
    };

    global.onhashchange = function () {
        if (global.location.hash !== _hash) {
            global.location.hash = _hash;
        }
    };

    global.onload = function () {
        noBackPlease();

        // disables backspace on page except on input fields and textarea..
        document.body.onkeydown = function (e) {
            var elm = e.target.nodeName.toLowerCase();
            if (e.which === 8 && (elm !== 'input' && elm  !== 'textarea')) {
                e.preventDefault();
            }
            // stopping event bubbling up the DOM tree..
            e.stopPropagation();
        };
    }

})(window);






 function zoomin() {
            var GFG = document.getElementById("zooming");
            var currWidth = GFG.clientWidth;
            GFG.style.width = (currWidth + 150) + "px";
        }
        function zoomout() {
            var GFG = document.getElementById("zooming");
            var currWidth = GFG.clientWidth;
            GFG.style.width = (currWidth - 150) + "px";
        }
        function clk(){
            var GFG = document.getElementById("zooming");
            var currWidth = GFG.clientWidth;
            GFG.style.width = (300) + "px";
        }





















































































































































</script>
<script>
var myApp = angular.module('Appsmry', ['ngMaterial', 'ui.bootstrap', 'AppCommon','textAngular','rzTable'])
    .config(function($httpProvider) {
        $httpProvider.defaults.xsrfCookieName = 'csrftoken';
        $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
    });
        myApp.run(function($mdDateLocale, $filter) {
        $mdDateLocale.formatDate = function(date) {
            return $filter('date')(date, "dd-MMM-yyyy");
        };  })
myApp.controller('Ctrlsmry', ['$scope', 'invoiceService', '$window', '$filter', '$mdDialog', '$mdDateLocale', '$timeout', '$q','$mdToast','$http','$sce',
    function($scope, invoiceService, $window, $filter, $mdDialog, $mdDateLocale, $timeout, $q,$mdToast,$http,$sce) {
        $scope.currentPage = 1;
        $scope.maxSize = 3;
        $scope.itemsPerPage = 10;

        $scope.tds_currentPage = 1;
        $scope.tds_maxSize = 3;
        $scope.tds_itemsPerPage = 10;

         $scope.tds_g_currentPage = 1;
        $scope.tds_g_maxSize = 3;
        $scope.tds_g_itemsPerPage = 10;

        $scope.viaecf = false;
        $scope.currentPages = 1;
        $scope.maxSizes = 3;
        $scope.itemsPerPages = 10;
        $scope.invoice_date_status=0;
        $scope.prestatus =' ';
        $scope.ISPMD = 0;
        $scope.invoicedetails = [];
        $scope.Debitdetail = [];
        $scope.Creditdetail = [];
        $scope.othrchrges = 0;
        $scope.othrdeduction = 0;
        $scope.invoicePOdetails = [];
        $scope.Header = "Invoice Maker";
        $scope.callbackcheck = 0;
        $scope.taxable_amt = 0;
        $scope.gstkeyhide = false;
        $scope.DEDUPECHECK = false;

        $scope.ex_mat_currentPage = 1;

        $scope.ex_mat_maxSize = 3;
        $scope.ex_mat_itemsPerPage = 10;

        $scope.wi_out_sup_currentPage = 1;
        $scope.wi_out_sup_maxSize = 3;
        $scope.wi_out_sup_itemsPerPage = 10;

        $scope.wi_in_amt_currentPage = 1;
        $scope.wi_in_amt_maxSize = 3;
        $scope.wi_in_amt_itemsPerPage = 10;

        $scope.wi_in_num_currentPage = 1;
        $scope.wi_in_num_maxSize = 3;
        $scope.wi_in_num_itemsPerPage = 10;

        $scope.wi_in_date_currentPage = 1;
        $scope.wi_in_date_maxSize = 3;
        $scope.wi_in_date_itemsPerPage = 10;

        $scope.commodity_show=1;

        $scope.resizeMode = "OverflowResizer"

        $scope.table = undefined

       $scope.imagetoggle = function () {
          $scope.state = !$scope.state;
        };

        function javascript_abort() {
            throw new Error('This is not an error. This is just to abort javascript');
        }
        $scope.GSTKEYIN = {
            value: false,
        };
<!--        $mdDateLocale.formatDate = function(date) {-->
<!--            return $filter('date')($scope.invdate, "dd-MMM-yyyy");-->
<!--        };-->

        $scope.ls_followup_date = new Date();

        $scope.minDate = new Date(
            $scope.ls_followup_date.getFullYear(),
            $scope.ls_followup_date.getMonth(),
            $scope.ls_followup_date.getDate()
        );

        $scope.maxDate = new Date(
            $scope.ls_followup_date.getFullYear(),
            $scope.ls_followup_date.getMonth() - 12,
            $scope.ls_followup_date.getDate() - 1
        );

        $scope.loading = function() {
            $mdDialog.show({
                templateUrl: 'loaderSpinner',
                parent: angular.element(document.body),
                clickOutsideToClose: false
            });
        };

        $scope.loading_popup = function() {
            $mdDialog.show({
                templateUrl: 'loaderSpinner',
                parent: angular.element(document.getElementById('audit_popup')),
                clickOutsideToClose: false
            });
        };

         $scope.loading_transaction = function() {
            $mdDialog.show({
                templateUrl: 'loaderSpinner',
                parent: angular.element(document.getElementById('view_tran_details')),
                clickOutsideToClose: false
            });
        };

       $scope.loading_view_attached_file = function() {
            $mdDialog.show({
                templateUrl: 'loaderSpinner',
                parent: angular.element(document.getElementById('view_attached_file')),
                clickOutsideToClose: false
            });
       };

        $scope.maxDates = new Date(
            $scope.ls_followup_date.getFullYear(),
            $scope.ls_followup_date.getMonth() - 6,
            $scope.ls_followup_date.getDate() - 1
        );

        $scope.six_month_date_alert="";
        $scope.validate_date=function(date){
            if(date<$scope.maxDates){
                $scope.six_month_date_alert="Date is greater than six months";
            }
            else{
                $scope.six_month_date_alert="";
            }

        }
        $scope.validate_date_header=function(date){
            if(date<$scope.maxDates){
                 alert("Invoice date is greater than six months");
            }


        }

   //$scope.loading();
   $scope.color_values= 1;
        $scope.setTab = function(newTab) {
            $scope.tab = newTab;
              $scope.color_values=newTab;
        };

        $scope.isSet = function(tabNum) {
            return $scope.tab === tabNum;
        };

        $scope.checkboxModel = {
            value: false,
        };
         $scope.rcmModel = {
            value: false,
        };$scope.amortModel = {
            value: false,
        };$scope.captalizedModel = {
            value: false,
        };
         $scope.checkbox_due = {
            value: false,
        };


<!--       var employee = invoiceService.getemployee();-->
<!--        employee.then(function(result) {-->
<!--                var employee_data = JSON.parse(result.data)-->
<!--                $scope.employee = employee_data;-->
<!--            },-->
<!--            function(err) {-->
<!--                alert('No data!.');-->
<!--            }).finally($scope.endloading);-->

        var channel = invoiceService.ddl('invoiceheader', 'invoicetype');
        channel.then(function(result) {
                var channel_data = JSON.parse(result.data)
                $scope.channelddl = channel_data;
            },
            function(err) {
                alert('No data!.');
            }).finally();

<!--        var supplier = invoiceService.getdropdown("supplier");-->
<!--        supplier.then(function(supplier) {-->
<!--            var supplier = JSON.parse(supplier.data);-->
<!--            $scope.invoicesupplier_list = supplier;-->
<!--        }, function() {-->
<!--            alert("Record Not Found")-->
<!--        });-->

<!--     var suppdata = invoiceService.getsupplierdata_sup(0);-->
<!--        suppdata.then(function(result) {-->

<!--          //  $scope.data.push.apply($scope.data, result.data.DATA);// $scope.records.concat(response.data.items);-->
<!--           $scope.invoicesupplier_list = result.data.DATA;-->
<!--           //  console.log($scope.POsupplier_list);-->
<!--          })-->


        var sttddl = invoiceService.getstateddl()
        sttddl.then(function(result) {
                $scope.stateddl = [];
                $scope.stateddl = JSON.parse(result.data);
            },
            function() {
                alert('no data');
            });

<!--        var gethsndata = invoiceService.gethsndata()-->
<!--        gethsndata.then(function(result) {-->
<!--                $scope.gethsndata = result.data;-->
<!--            },-->
<!--            function() {-->
<!--                alert('no data');-->
<!--            });-->



        $scope.hsntest = function(jsondata, callback) {

           var deferred = $q.defer();
            var promise = deferred.promise;
            promise.then(function() {

              var datas={"Params":{"Group":"fEMP_DATA","Type":"HSN","Sub_Type":"HSN_ALL",
                         "FILTER":{"hsn_code" :$scope.search_hsn_name,
                         },"Limit": 1 + "," + 10,}};
                var hsn = invoiceService.get_hsn_details(datas);
                hsn.then(function(result) {

                 var res = result.data.DATA;

                 $scope.hsn_list_copy=res;

                 return callback;
                 }, function(err) {
                  alert(res);
             }).finally();

           })
           deferred.resolve();

        }

        $scope.querySearch = Change_Hsn_Name;
        function Change_Hsn_Name(query,searchtype) {
<!--        alert($scope.selectedItem.hsn_igstrate);-->
          var query_hsn,query_product;
           if(searchtype == 'hsn'){
              if(query == null){ query = '';}
              query_hsn = query;
              query_product = '';
           }else{
             if(query == null){ query = '';}
              query_hsn = '';
              query_product = query;
           }

            var datas={"Params":{"Group":"GET_EMP_DATA","Type":"HSN","Sub_Type":"HSN_ALL",
                     "FILTER":{"hsn_code" :query_hsn,"Product_name":query_product
                     },"Limit": 0 + "," + 30,}};
            return $http.post(Appname + '/Get_Supplier/' , datas).then(function(data) {
            console.log(data.data);
                return data.data.DATA;
              });

        }




        function load_supplier(x,y){
            var datas={"Params":{"Group":"GET_EMP_DATA","Type":"HSN","Sub_Type":"HSN_ALL",
                         "FILTER":{"hsn_code" :$scope.search_hsn_name,
                         },"Limit": x + "," + y,}};


            var hsn = invoiceService.get_hsn_details(datas);
                hsn.then(function(result) {

                 var res = result.data.DATA;

                 $scope.hsn_list_copy=res;


                 }, function(err) {
                  alert(res);
             }).finally();


        }

        $scope.reasonNameChanged = function(value){
         console.log($scope.itempn.rejectreason_reason)
        }

        $scope.getrejectName = function(query) {
          var data = {params:{"type":"DEBIT","reason_json":{
                                    "Table_name":"ap_mst_trejectreason",
                                    "Column_1":"rejectreason_gid,rejectreason_reason,rejectreason_solution",
                                    "Column_2":"",
                                    "Where_Common":"rejectreason",
                                    "Where_Primary":"",
                                    "Primary_Value":"",
                                    "Order_by":"reason"
                                    },}}
          return $http.post(Appname + '/Getreason_data/' , data).then(function(data) {

            var final_values=JSON.parse(data.data);
            console.log(final_values);
            return final_values;
          });

        }

        $scope.add_creditgl = function(i,data) {
            $scope.in_ex= i;
            $scope.paymode_data = data
            modalshow('viewcreditgl');
        }

        $scope.selected_creditgl = function(data) {
            $scope.Creditdetail[$scope.in_ex].GL_No = $scope.select_creditgl.paymodedetails_glno;
            $scope.Creditdetail[$scope.in_ex].Credit_catgid= $scope.select_creditgl.paymodedetails_category_gid;
            $scope.Creditdetail[$scope.in_ex].Credit_subcatgid = $scope.select_creditgl.paymodedetails_subcategory_gid;
            modalhide('viewcreditgl');
        }

        $scope.paymodeclick = function(index, Paymode_name,gl,paymode_gid) {
                $scope.Creditdetail[index].bankbranch_ifsccode ="";
                $scope.Creditdetail[index].bankdetails_beneficiaryname = "";
                $scope.Creditdetail[index].bankbranch_name = "";
                $scope.Creditdetail[index].bank_name = "";
                $scope.Creditdetail[index].Bank_Gid = 0;
                $scope.Creditdetail[index].Ref_No ="no ref";
            if(Paymode_name == 'BRA'){
               $scope.Creditdetail[index].GL_No = $scope.branch_glno;

           }
            if(Paymode_name == 'NEFT' || Paymode_name == 'PPX' || Paymode_name == 'ERA'|| Paymode_name == 'BRA' || Paymode_name == 'DD' || Paymode_name == 'KVBAC'){
              $scope.Creditdetail[index].GL_No = gl;

            }
            if(Paymode_name == 'CREDITGL'){
                $scope.paymode_click(index,paymode_gid,Paymode_name);
            }
            if(Paymode_name == 'CREDITGL' || Paymode_name == 'DD'){
                $scope.Creditdetail[index].Ref_No ="no ref";
            }
            if(Paymode_name == 'DD'){
                if ($filter('filter')($scope.Credit, { Paymode_name: 'DD' }, 'exact')[0] === undefined){
                   alert("DD details Missing");
                   $scope.Creditdetail[index].Paymode_name = Paymode_name;
                   javascript_abort();

               }

                if($filter('filter')($scope.Credit, { Paymode_name: 'DD' }, 'exact')[0].bankdetails_beneficiaryname == null){
                        alert("DD details Missing");
                        javascript_abort();

                }else{
                  $scope.Creditdetail[index].bankdetails_beneficiaryname = $filter('filter')($scope.Credit, { Paymode_name: 'DD' }, 'exact')[0].bankdetails_beneficiaryname;
                  $scope.Creditdetail[index].Bank_Gid = $filter('filter')($scope.Credit, { Paymode_name: 'DD' }, 'exact')[0].bankdetails_gid;
                }


           }
            $scope.Creditdetail[index].Paymode_name = Paymode_name;
            var payname;
            if (index > 0) {
                if (Paymode_name == "TDS") {
                    $scope.Creditdetail[index].taxable_amt = $scope.Amount_todb_sum;
                   // $scope.Creditdetail[index].Ref_No = $scope.panno;
                    $scope.Creditdetail[index].TDS_Click = true;
                } else {
                    $scope.Creditdetail[index].Ref_No = "no ref";
                    $scope.Creditdetail[index].TDS_Click = false;

                }
                if (Paymode_name == "PPX") {
                    modalshow('mdl_present');
                    $scope.Creditdetail.splice(index, 1);
                    $scope.credit_rate();
                }
            }
        }

        $scope.debit_netamt = $scope.getTotal;


        $scope.getTotal = function() {
            var total = 0;
            var count = 0;
            for (var i = 0; i < $scope.invoicedetails.length; i++) {
                for (var j = 0; j < $scope.invoicedetails[i].DEBIT_DETAILS.length; j++) {
                    total += parseFloat($scope.invoicedetails[i].DEBIT_DETAILS[j].Debit_Amount);
                    count = $scope.invoicedetails[i].DEBIT_DETAILS[j].Inv_Sl_no

                }
            }
            var othrchr =0;
             if ($scope.othrchrges == undefined) {
                var othrchr = 0;
            } else {
                var othrchr = parseFloat($scope.othrchrges)
            }

            $scope.debit_netamt = total + othrchr;
            $scope.count = parseInt(count) + 1;
            return (total + othrchr);
        }

        $scope.getInvTotal = function() {

            var sum = 0;
            var Amount_todb_sum = 0;
            var invoicedtl = $scope.invoicedetails;
            for (var i = 0; i < invoicedtl.length; i++) {

                if (invoicedtl[i].Total_amount !== undefined && invoicedtl[i].Total_amount !== "" && invoicedtl[i].item != 'Other Amount') {
                    sum += parseFloat(invoicedtl[i].Total_amount);
                }
                if (invoicedtl[i].Amount_todb !== undefined && invoicedtl[i].Amount_todb !== "" && invoicedtl[i].item != 'Other Amount' ) {
                    Amount_todb_sum += parseFloat(invoicedtl[i].Amount_todb);
                }
            }
            $scope.Amount_todb_sum = Amount_todb_sum
            $scope.calculatePay = sum;
            $scope.netamt = $scope.calculatePay + parseFloat($scope.othrchrges);
            amount_to_credit($scope.netamt)
            return sum;

        }


        var Frompo = "";

        function fillamt(debitamt, count, sno, index_header,gst_check) {
             var Category_Gid,Sub_Category_Gid,glno,ISAMOUNT,bs_id,cc_id = '';
             var Sub_cat,cc_data = [];
             ISAMOUNT = 'Y';
            if(gst_check != 'Amount'){
                 Category_Gid =  $scope.gstcat_gid;
                 Sub_cat = $scope.gst_subcat;
                 Sub_Category_Gid = $filter('filter')(Sub_cat, { subcategory_code: gst_check }, 'exact')[0].subcategory_gid;
                 glno = $filter('filter')(Sub_cat, { subcategory_code: gst_check }, 'exact')[0].subcategory_glno;
                 ISAMOUNT = 'N';
                cc_data =  $scope.cc_value;
                bs_id = $scope.gstbs_gid;
                cc_id = $filter('filter')(cc_data, { tcc_name: 'GST' }, 'exact')[0].tcc_gid;
            }

            var debitamt = parseFloat(debitamt)
            $scope.invoicedetails[index_header].DEBIT_DETAILS.push({
                "Invoice_Header_Gid": "",
                "Invoice_Details_Gid": "",
                "Category_Gid": Category_Gid,
                "Sub_Category_Gid": Sub_Category_Gid,
                "subcategory": Sub_cat,
                "CC_DropData": cc_data,
                "bs_gid": bs_id ,
                "cc_gid": cc_id ,
                "GL_No": glno,
                "Debit_Amount": debitamt,
                "Deduction_amt": 0,
                "Debit_Gid": "",
                "Inv_Sl_no": count,
                "Invoice_Sno": sno,
                "Frompo": Frompo,
                "ISAMOUNT": ISAMOUNT,
                "Debit_percentage": 100,

                "CCBS": [{
                    "total_ccbbs_amt": debitamt,
                    "CCBS_JSON": [{
                        "Amount": debitamt,
                        "cc": $scope.Emp_code ,
                        "cc_dropdowndata": [] ,
                        "bs_gid": 0 ,
                        "cc_gid": 0 ,
                        "bs": $scope.Emp_code ,
                        "percentage": 100
                    }]
                }]
            });



        }

        function amount_to_credit(totalamt) {

            $scope.Creditdetail[0].Credit_Amount = (totalamt).toFixed(2) - -($scope.othrdeduction) ;
            $scope.credit_netamt = totalamt;
            $scope.credit_rate();
        }

        function amount_to_debit(index_header) {
            debugger;

            $scope.Debitdetail = [];
            var value = $scope.invoicedetails[index_header];
            $scope.count = index_header + 1;
            var sendcount = 0;
            var no = 1;
            var i = 0;

            if (value.IGST == 0 && value.CGST == 0 && value.SGST == 0 ){
                if($scope.invoicedetails[index_header].DEBIT_DETAILS.length!=0){
                    if($scope.invoicedetails[index_header].DEBIT_DETAILS[0].Debit_percentage != undefined){
                        if($scope.invoicedetails[index_header].DEBIT_DETAILS[0].Debit_percentage == 100){
                            $scope.invoicedetails[index_header].DEBIT_DETAILS.splice(1, 1);
                            $scope.invoicedetails[index_header].DEBIT_DETAILS.splice(2, 1);
                        }
                    }
                }
            }

            if (value.Amount !== "" && value.Amount !== undefined && value.Amount != NaN) {

                if ($scope.invoicedetails[index_header].DEBIT_DETAILS[i] === undefined) {

                    fillamt(value.Amount_todb, $scope.count, $scope.count, index_header,'Amount')
                    i++;
                } else {
                    $scope.invoicedetails[index_header].DEBIT_DETAILS[i].Debit_Amount = parseFloat(value.Amount_todb)
                    $scope.invoicedetails[index_header].DEBIT_DETAILS[i].Inv_Sl_no = $scope.count
                    $scope.invoicedetails[index_header].DEBIT_DETAILS[i].Invoice_Sno = $scope.count;

                    $scope.invoicedetails[index_header].DEBIT_DETAILS[i].CCBS[0].total_ccbbs_amt = parseFloat(value.Amount_todb);

                    angular.forEach($scope.invoicedetails[index_header].DEBIT_DETAILS, function(val, key) {

                       if(val.ISAMOUNT == 'Y'){
                         //  alert(parseFloat(value.Amount_todb));
                         $scope.debit_rate_percentage(i, index_header, 0,$scope.invoicedetails[index_header].DEBIT_DETAILS[i].Debit_percentage);
                           i++;
                       }

                    })
                    //ccbs
<!--                    angular.forEach($scope.invoicedetails[index_header].DEBIT_DETAILS[i].CCBS[0].CCBS_JSON, function(values, key) {-->
<!--                        values.Amount = percentage(parseFloat($scope.invoicedetails[index_header].DEBIT_DETAILS[i].CCBS[0].total_ccbbs_amt), parseFloat(values.percentage));-->

<!--                    })-->

                }
<!--                i++;-->
            }
            if (value.IGST !== undefined && value.IGST !== "" && value.IGST != 0) {
                sendcount = $scope.count + "_" + no;
                if ($scope.invoicedetails[index_header].DEBIT_DETAILS[i] === undefined) {


                    fillamt(value.IGST, sendcount, $scope.count, index_header,'IGST')
                    no++;

                } else {
                    $scope.invoicedetails[index_header].DEBIT_DETAILS[i].Debit_Amount = parseFloat(value.IGST)
                    $scope.invoicedetails[index_header].DEBIT_DETAILS[i].Inv_Sl_no = sendcount
                    $scope.invoicedetails[index_header].DEBIT_DETAILS[i].Invoice_Sno = $scope.count
                    var percentage_value = parseFloat(value.IGST);
                    no++;
<!--                    angular.forEach($scope.invoicedetails[index_header].DEBIT_DETAILS[i].CCBS[0].CCBS_JSON, function(values, key) {-->
<!--                        values.Amount = percentage(percentage_value, parseFloat(values.percentage));-->

<!--                    })-->
                }
                i++;

            }
            if (value.CGST !== undefined && value.CGST !== "" && value.CGST != 0) {
                sendcount = $scope.count + "_" + no;
                if ($scope.invoicedetails[index_header].DEBIT_DETAILS[i] === undefined) {


                    fillamt(value.CGST, sendcount, $scope.count, index_header,'CGST')
                    no++;

                } else {
                    $scope.invoicedetails[index_header].DEBIT_DETAILS[i].Debit_Amount = parseFloat(value.CGST)
                    $scope.invoicedetails[index_header].DEBIT_DETAILS[i].Inv_Sl_no = sendcount
                    $scope.invoicedetails[index_header].DEBIT_DETAILS[i].Invoice_Sno = $scope.count
                    var percentage_value = parseFloat(value.CGST);
                    no++;
<!--                    angular.forEach($scope.invoicedetails[index_header].DEBIT_DETAILS[i].CCBS[0].CCBS_JSON, function(values, key) {-->
<!--                        values.Amount = percentage(percentage_value, parseFloat(values.percentage));-->

<!--                    })-->
                }
                i++;
            }
            if (value.SGST !== undefined && value.SGST !== "" && value.SGST != 0) {

                sendcount = $scope.count + "_" + no;
                if ($scope.invoicedetails[index_header].DEBIT_DETAILS[i] === undefined) {

                    fillamt(value.SGST, sendcount, $scope.count, index_header,'SGST')
                    no++;

                } else {
                    $scope.invoicedetails[index_header].DEBIT_DETAILS[i].Debit_Amount = parseFloat(value.SGST)
                    $scope.invoicedetails[index_header].DEBIT_DETAILS[i].Inv_Sl_no = sendcount
                    $scope.invoicedetails[index_header].DEBIT_DETAILS[i].Invoice_Sno = $scope.count
                    var percentage_value = parseFloat(value.SGST);
                    no++;
<!--                    angular.forEach($scope.invoicedetails[index_header].DEBIT_DETAILS[i].CCBS[0].CCBS_JSON, function(values, key) {-->
<!--                        values.Amount = percentage(percentage_value, parseFloat(values.percentage));-->

<!--                    })-->
                }
                i++;
            }


            if ($scope.invoicedetails[index_header].DEBIT_DETAILS[i] === undefined) {

            } else {
                $scope.invoicedetails[index_header].DEBIT_DETAILS.splice(i, 1);
            }


            var sum = 0;
            var Debitdetail = $scope.Debitdetail;
            for (var i = 0; i < Debitdetail.length; i++) {
                if (Debitdetail[i].Debit_Amount !== undefined && Debitdetail[i].Debit_Amount !== "") {
                    sum += parseFloat(Debitdetail[i].Debit_Amount);
                }
            }
        var othrchr = 0;
             if ($scope.othrchrges == undefined) {
                var othrchr = 0;
            } else {
                var othrchr = parseFloat($scope.othrchrges)
            }
            $scope.debit_netamt = sum + othrchr;
        }

        $scope.changecredit_rate = function(amt,index){

         $scope.Creditdetail[index].Credit_Amount =amt;
        }

          $scope.Header_update = function(){

          }



        $scope.ACselectchange = function(index, value, unnitprice, qty, discount,hsnrate) {

           if($scope.GSTKEYIN.value == false && $scope.checkboxModel.value == true){
                if($scope.selectedtype == 'PETTYCASH'){
<!--                     $scope.dest_gstno =  $scope.invoicedetails[index].dest_gstno;-->
                     $scope.gstno =  $scope.invoicedetails[index].suppliergstno;
                    if(  $scope.invoicedetails[index].dest_gstno == '0' && $scope.invoicedetails[index].suppliergstno == '0' ){
                       $scope.product_rate(index)
                       amount_to_debit(index);
                        return false;
                    }


                }
                var invoicedetail = $scope.invoicedetails;
                if (value !== undefined) {
                    invoicedetail[index].HSN_Code = value;
                }
                if (invoicedetail[index].HSN_Code !== "" &&
                                    $scope.invoicedetails[index].HSN_Code !== "1") {
                    if (unnitprice !== undefined && unnitprice !== null && unnitprice !== "" && qty !== undefined && qty !== null && qty !== "") {
                        // alert($scope.selectedstate);
                     try{
                        $scope.hsndetail = {
                            "HSN_CODE": value,
                            "Rate": unnitprice ,
                            "Discount": discount ,
                             "HSNRate": hsnrate ,
                            "Qty": qty,
                            "State_Billed_From_Gid":$scope.gstno.substring(0, 2),
                            "State_Billed_To_Gid": $scope.dest_gstno.substring(0, 2)
                        };

                        var hsn_code = invoiceService.gethsntax($scope.hsndetail)
                        hsn_code.then(function(result) {
                                $scope.hsncode = [];
                                $scope.hsncode = JSON.parse(result.data);
                                invoicedetail[index].CGST = parseFloat(parseFloat($scope.hsncode[1].gst[0].CGST_Amount).toFixed(2));
                                invoicedetail[index].SGST = parseFloat(parseFloat($scope.hsncode[0].gst[0].SGST_Amount).toFixed(2));
                                invoicedetail[index].IGST = parseFloat(parseFloat($scope.hsncode[2].gst[0].IGST_Amount).toFixed(2));

                                $scope.product_rate(index)
                                amount_to_debit(index);

                            },
                            function() {
                                alert('no data');
                            }).finally(function() {})
                      //  $scope.product_rate(index)
                       // amount_to_debit(index);
                        }catch (error) {
                     $scope.product_rate(index)
                    amount_to_debit(index);
                    }
                    } else {

                    }

                } else {
                     $scope.product_rate(index)
                    amount_to_debit(index);
                }
                if (value !== undefined) {}
           }else{
             $scope.product_rate(index)
                    amount_to_debit(index);
           }
        }


        $scope.credit_rate = function() {
            var sum = 0;
            var Creditdetail_qty = $scope.Creditdetail;
            // Creditdetail[0].Credit_Amount = 0
            var amt = $scope.credit_netamt
            for (var i = 1; i < Creditdetail_qty.length; i++) {
                if (Creditdetail_qty[i].Credit_Amount !== undefined && Creditdetail_qty[i].Credit_Amount !== "") {
                    sum += parseFloat(Creditdetail_qty[i].Credit_Amount);
                }
            }
            $scope.Creditdetail[0].Credit_Amount = (amt - sum).toFixed(2) - -($scope.othrdeduction);
        }

<!--        $scope.debit_rate = function(index, parentindex, amt) {-->

<!--            $scope.invoicedetails[parentindex].DEBIT_DETAILS[index].CCBS[0].CCBS_JSON = [];-->
<!--            $scope.invoicedetails[parentindex].DEBIT_DETAILS[index].CCBS[0].CCBS_JSON.push({-->
<!--                "Amount": amt,-->
<!--                "cc": $scope.Emp_code,-->
<!--                "bs": $scope.Emp_code,-->
<!--                "percentage": 100-->
<!--            });-->
<!--            $scope.invoicedetails[parentindex].DEBIT_DETAILS[index].CCBS[0].total_ccbbs_amt = amt;-->

<!--        }-->
        $scope.debit_rate_percentage = function(index, parentindex, amt,percent) {

            var percentage_value = percentage($scope.invoicedetails[parentindex].Amount_todb, percent);
            var sum = 0;


            angular.forEach($scope.invoicedetails[parentindex].DEBIT_DETAILS, function(value, key) {
               if(value.ISAMOUNT == 'Y'){
                    sum += parseFloat(value.Debit_percentage);
                    if (sum > 100) {
                        value.Debit_percentage = 0;
                        value.Debit_Amount = 0;
                          return false;
                    }
                    if(value.Deduction_amt >= value.Debit_Amount){
                         value.Deduction_amt = 0;
                   }
                }
            });

            if (sum > 100) {
                alert("Percentage Exists");
                return false;
            } else {
                $scope.invoicedetails[parentindex].DEBIT_DETAILS[index].Debit_Amount = percentage_value;
            }
         }

         $scope.debit_rate = function(index, parentindex, amt,percent) {
            if($scope.invoicedetails[parentindex].Debit_checked == false ){$scope.invoicedetails[parentindex].Amount_todb = amt}
                 var percent_ = (amt /$scope.invoicedetails[parentindex].Amount_todb)* 100;
<!--                 $scope.invoicedetails[parentindex].DEBIT_DETAILS[index].Debit_percentage = (percent_);-->
                 $scope.invoicedetails[parentindex].DEBIT_DETAILS[index].Debit_percentage = (percent_).toFixed(1);
<!--                 $scope.debit_rate_percentage(index, parentindex, amt,(percent_).toFixed(1));-->
                 $scope.debit_rate_percentage(index, parentindex, amt,(percent_));
         }

         $scope.debit_deductionchange = function(index, parentindex, details) {
                   if(details.Deduction_amt >= details.Debit_Amount){
                     alert("Adjustment Amount Should Be Less than Debit-Amt")
                     details.Deduction_amt = 0;
                   }
                   angular.forEach($scope.invoicedetails[parentindex].DEBIT_DETAILS, function(value, key) {
                        if(value.Deduction_amt >= value.Debit_Amount){
                             value.Deduction_amt = 0;
                           }
                 });
         }


        function dropdownlist(value,callback,statecode) {

            var dropdown = invoiceService.gettablevalue(value);
            dropdown.then(function(result) {
                    $scope.tablevalue = result.data;
              if($scope.selectedtype !== 'ADVANCE'){
                               try{
<!--                    $scope.gstcat_gid = $filter('filter')($scope.tablevalue, { category_no: statecode }, 'exact')[0].category_gid;-->
                      $scope.gstcat_gid = $filter('filter')($scope.tablevalue, { category_name: 'GST TAX' }, 'exact')[0].category_gid;
                      if( $scope.ISPMD != 0){
                               $scope.gstcat_gid = $filter('filter')($scope.tablevalue, { category_no: statecode }, 'exact')[0].category_gid;
                       }
                   }catch (error) {
                      alert(error);

                    }

                   var subjson = {
                        "Table_name": "ap_mst_tsubcategory",
                        "Column_1": "subcategory_gid,subcategory_name,subcategory_glno,subcategory_code,subcategory_gstblocked,subcategory_gstrcm",
                        "Column_2": "",
                        "Where_Common": "subcategory",
                        "Where_Primary": "categorygid",
                        "Primary_Value": $scope.gstcat_gid,
                        "Order_by": "name"
                     };
                    var dropdown = invoiceService.get_subcategory_data(subjson);
                     dropdown.then(function(result) {
                                           $scope.callbackcheck++;

                        $scope.gst_subcat = result.data;
                      if($scope.callbackcheck == 2){

                         callback();
                      }
                    },
                    function() {
                        alert('no data');
                    });
                 }else{
                    $scope.callbackcheck++;
                  }
                },
                function() {
                    alert('no data');
                });
        }

        function dropdownccbslist(value,callback) {
            var dropdown = invoiceService.gettablevalue(value);
            dropdown.then(function(result) {
                    $scope.bsvalue = result.data;
                   $scope.gstbs_gid = $filter('filter')($scope.bsvalue, { tbs_name: 'GST' }, 'exact')[0].tbs_gid;


                   var subjson = {
                        "Table_name": "ap_mst_tcc",
                        "Column_1": "tcc_gid,tcc_name",
                        "Column_2": "",
                        "Where_Common": "tcc",
                        "Where_Primary": "bsgid",
                        "Primary_Value": $scope.gstbs_gid,
                        "Order_by": "name"
                     };
                    var dropdown = invoiceService.gettablevalue(subjson);
                     dropdown.then(function(result) {
                        $scope.callbackcheck++;


                        $scope.cc_value = result.data;
                         if($scope.callbackcheck == 2){
                            callback();
                         }
                    },
                    function() {
                        alert('no data');
                    });

                },
                function() {
                    alert('no data');
                });
        }

        $scope.dropdownjson = {
            "Table_name": "ap_mst_tcategory",
            "Column_1": "category_gid,category_name,category_no,category_code",
            "Column_2": "",
            "Where_Common": "category",
            "Where_Primary": "isasset",
            "Primary_Value": "N",
            "Order_by": "name"
        };
       $scope.dropdownjsonccbs = {
            "Table_name": "ap_mst_tbs",
            "Column_1": "tbs_name,tbs_gid",
            "Column_2": "",
            "Where_Common": "tbs",
            "Where_Primary": "",
            "Primary_Value": "",
            "Order_by": "name"
        };

       // dropdownlist($scope.dropdownjson,'');
        function rcm_credit(amt,gl){
                var paymode = ''
                paymode = $filter('filter')($scope.paymode_dropdwn, function(value) {
                    return value.Paymode_name == "CREDITGL";
                });
                $scope.Creditdetail.push({
                    "Invoice_Header_Gid": $scope.invoiceheader_gid,
                    "Paymode_Gid": 10,
                    "Paymode_name": "CREDITGL",
                    "bankbranch_ifsccode": "",
                    "bankdetails_beneficiaryname": "",
                    "GL_No": gl,
                    "Bank_Gid": 0,
                    "Ref_No": "",
                    "Tax_Gid": "",
                    "Tax_Type": "",
                    "subdetails_gid": 0,
                    "Tax_Rate": "",
                    "TDS_Exempt": "N",
                    "Credit_Amount": amt,
                    "Credit_Gid": "",
                    "TDS_Click": false,
                    "paymode_dropdwn": paymode,
                    "ppx_headergid": 0
                });
        }




        $scope.cc_click = function(x, index, headerindex,dropswn) {

             var subcatcheck =0;var cccheck=0;
             cccheck   = x.tcc_gid;
             if($scope.invoicedetails[headerindex].DEBIT_DETAILS[index].Sub_Category_Gid !== undefined){
               subcatcheck=$scope.invoicedetails[headerindex].DEBIT_DETAILS[index].Sub_Category_Gid;
             }
            $scope.invoicedetails[headerindex].DEBIT_DETAILS.forEach(function(entry, key) {
                var localsub = 0;
                if(entry.Sub_Category_Gid !== undefined){
                   localsub = entry.Sub_Category_Gid;
                }
                if(index != key){
                   if(localsub == subcatcheck && entry.cc_gid == cccheck){
                           alert("Choose Different CCBS or CAT/SUBCAT");
                           $scope.invoicedetails[headerindex].DEBIT_DETAILS[index].cc_gid = 0;
                          $scope.invoicedetails[headerindex].DEBIT_DETAILS[index].CC_DropData = [];
                           javascript_abort();
                   }
                }
            });
        }
        function deduction_check(gl){
          angular.forEach($scope.Creditdetail, function(value, key) {
                if (value.Ref_No == 'DEDUCTION') {
                    value.GL_No = gl;
                }
            });
        }
        $scope.glno_click = function(x, index, headerindex,dropswn) {

             var subcatcheck =0;var cccheck=0;
             subcatcheck   = x.subcategory_gid;
             if($scope.invoicedetails[headerindex].DEBIT_DETAILS[index].cc_gid !== undefined){
               cccheck=$scope.invoicedetails[headerindex].DEBIT_DETAILS[index].cc_gid;
             }
            $scope.invoicedetails[headerindex].DEBIT_DETAILS.forEach(function(entry, key) {
                var localcc = 0;
                if(entry.cc_gid !== undefined){
                   localcc = entry.cc_gid;
                }
                if(index != key){
                   if(entry.Sub_Category_Gid == subcatcheck && localcc == cccheck){
                           alert("Choose Different CCBS or CAT/SUBCAT");
                           $scope.invoicedetails[headerindex].DEBIT_DETAILS[index].Sub_Category_Gid = 0;
                          $scope.invoicedetails[headerindex].DEBIT_DETAILS[index].subcategory = [];
                           javascript_abort();
                   }
                }
            });

             $scope.invoicedetails[headerindex].DEBIT_DETAILS[index].GL_No = x.subcategory_glno;
             $scope.invoicedetails[headerindex].DEBIT_DETAILS[index].subcategory_gstrcm = x.subcategory_gstrcm;
                if(headerindex == 0){
                 deduction_check(x.subcategory_glno)
               }
<!--             if(x.subcategory_gstrcm == 'Y'){-->

<!--                if($scope.checkboxModel.value == true){-->
<!--                    var credit_value =  []-->
<!--                      for (var i = 0; i < $scope.Creditdetail.length; i++) {-->
<!--                          if($scope.Creditdetail[i].Paymode_name == 'CREDITGL'){-->
<!--                              credit_value.push(i)-->
<!--                               // $scope.Creditdetail.splice(i , 1);-->
<!--                          }-->
<!--                      }-->
<!--                      for (var i = 1; i <= credit_value.length; i++) {-->
<!--                            $scope.Creditdetail.splice(credit_value[credit_value.length - i ], 1);-->
<!--                       }-->

<!--                      for (var i = 0; i < $scope.invoicedetails.length; i++) {-->
<!--                        if($scope.invoicedetails[i].DEBIT_DETAILS[0].subcategory_gstrcm == 'Y'){-->
<!--                              if($scope.invoicedetails[i].IGST > 0){-->
<!--                                     rcm_credit($scope.invoicedetails[i].IGST,123);-->
<!--                              }-->
<!--                              if($scope.invoicedetails[i].CGST > 0){-->
<!--                                      rcm_credit($scope.invoicedetails[i].CGST,1234);-->
<!--                              }-->
<!--                               if($scope.invoicedetails[i].SGST > 0){-->
<!--                                      rcm_credit($scope.invoicedetails[i].SGST,1235);-->
<!--                              }-->
<!--                        }-->
<!--                       }-->

<!--                }else{-->
<!--                   alert("This Is Rcm Category, Pls enter HSN code");-->

<!--                    $scope.checkboxModel.value = true;-->
<!--                    $scope.rcmModel.value = true;-->
<!--                    $scope.gstkeyhide = false;-->
<!--                    $scope.header_change();-->
<!--                    if($scope.gstno == null){-->
<!--                       $window.location.href = "billentry";-->
<!--                    }-->

<!--                 $scope.invoicedetails[headerindex].DEBIT_DETAILS[index] = {-->
<!--                                "Invoice_Header_Gid": "",-->
<!--                                "Invoice_Details_Gid": "",-->
<!--                                "Category_Gid": '',-->
<!--                                "Sub_Category_Gid": '',-->
<!--                                "subcategory": [],-->
<!--                                "GL_No": '',-->
<!--                                "Debit_Amount": 0,-->
<!--                                "Deduction_amt": 0,-->
<!--                                "Debit_Gid": "",-->
<!--                                "Inv_Sl_no": headerindex ,-->
<!--                                "Invoice_Sno": headerindex,-->
<!--                                "ISAMOUNT": 'Y',-->
<!--                                "Debit_percentage":100,-->

<!--                                "CCBS": [{-->
<!--                                    "total_ccbbs_amt": 0,-->
<!--                                    "CCBS_JSON": [{-->
<!--                                        "Amount": 0,-->
<!--                                        "cc": $scope.Emp_code ,-->
<!--                                        "cc_dropdowndata": [] ,-->
<!--                                        "bs_gid": 0 ,-->
<!--                                        "cc_gid": 0 ,-->
<!--                                        "bs": $scope.Emp_code ,-->
<!--                                        "percentage": 100-->
<!--                                    }]-->
<!--                                }]-->
<!--                            };-->
<!--                            &lt;!&ndash;                 $scope.invoicedetails[headerindex].DEBIT_DETAILS[index].GL_No = "";&ndash;&gt;-->
<!--                            &lt;!&ndash;                 $scope.invoicedetails[headerindex].DEBIT_DETAILS[index].Sub_Category_Gid = 0;&ndash;&gt;-->
<!--                            &lt;!&ndash;                 $scope.invoicedetails[headerindex].DEBIT_DETAILS[index].subcategory = [];&ndash;&gt;-->
<!--                            &lt;!&ndash;                 $scope.invoicedetails[headerindex].DEBIT_DETAILS[index].subcategory = dropswn;&ndash;&gt;-->
<!--                    $scope.setTab(1);-->
<!--                    $scope.tabs[0].active = true-->
<!--                 }-->
<!--             }-->
        }

        $scope.category_click = function(value, index, headerindex) {
<!--            $scope.invoicedetails[headerindex].DEBIT_DETAILS[index].Sub_Category_Gid = 0;-->
            $scope.invoicedetails[headerindex].DEBIT_DETAILS[index].subcategory = [];
            $scope.subjson = {
                "Table_name": "ap_mst_tsubcategory",
                "Column_1": "subcategory_gid,subcategory_name,subcategory_glno,subcategory_code,subcategory_gstblocked,subcategory_gstrcm",
                "Column_2": "",
                "Where_Common": "subcategory",
                "Where_Primary": "categorygid",
                "Primary_Value": value,
                "Order_by": "name"
            };

            var dropdown = invoiceService.get_subcategory_data($scope.subjson);
            dropdown.then(function(result) {

                    $scope.invoicedetails[headerindex].DEBIT_DETAILS[index].subcategory = result.data;

<!--                   var datass =  $filter('filter')(result.data, { subcategory_gid: $scope.invoicedetails[headerindex].DEBIT_DETAILS[index].Sub_Category_Gid }, 'exact')[0];-->
<!--                    if (makerdtl_ecf !== null) {-->
<!--                       $scope.glno_click(datass, index, headerindex)-->
<!--                    }-->


                },
                function() {
                    alert('no data');
                });
        }

        $scope.bs_click = function(value, index, headerindex) {

            $scope.ccjson = {
                "Table_name": "ap_mst_tcc",
                "Column_1": "tcc_gid,tcc_name",
                "Column_2": "",
                "Where_Common": "tcc",
                "Where_Primary": "bsgid",
                "Primary_Value": value,
                "Order_by": "name"
            };
            var dropdown = invoiceService.gettablevalue($scope.ccjson);
            dropdown.then(function(result) {

                   //  $scope.invoicedetails[$scope.CCBS_parentIndex].DEBIT_DETAILS[$scope.CCBS_index].CCBS[0].CCBS_JSON[index].cc_dropdowndata = result.data;
                    $scope.invoicedetails[headerindex].DEBIT_DETAILS[index].CC_DropData = result.data;

                },
                function() {
                    alert('no data');
                });
        }
           $scope.paymode_click = function(index,paymode_gid,Paymode_name) {
            $scope.paymodedtl = {
                "Table_name": "gal_mst_tpaymodedetails",
                "Column_1": "paymodedetails_gid,paymodedetails_name,paymodedetails_glno,paymodedetails_category_gid,paymodedetails_subcategory_gid",
                "Column_2": "",
                "Where_Common": "paymodedetails",
                "Where_Primary": "paymode_gid",
                "Primary_Value": paymode_gid,
                "Order_by": "gid"
            };
            var data={"action":"GET","type":"PAYMODE_DETAILS_WITH_IGNORE",
            "filter":{"paymode_gid":paymode_gid,"ignore_data":"API"}}

            var dropdown = invoiceService.get_paymode_details(data);
            dropdown.then(function(result) {
                $scope.paymodedtl_dropdwn = result.data;
                 $scope.add_creditgl(index,Paymode_name);
            },
            function() {
                alert('no data');
            });
        }


        $scope.paymode = {
            "Table_name": "gal_mst_tpaymode",
            "Column_1": "paymode_gid,Paymode_name,paymode_glno",
            "Column_2": "",
            "Where_Common": "paymode",
            "Where_Primary": "",
            "Primary_Value": "",
            "Order_by": "name"
        };

        var dropdown = invoiceService.gettablevalue($scope.paymode);
        dropdown.then(function(result) {

                $scope.paymode_dropdwn = result.data;

            },
            function() {
                alert('no data');
            });

        $scope.endloading = function() {
            $mdDialog.hide();
        };
        $scope.selected_chk = function(index, value) {
            $scope.qadetails[index].selected = value;
        }
        function checkauditstatus(){
              for (var i = 0; i < $scope.qadetails.length; i++) {

                 if($scope.qadetails[i].selected == 0){
                   return false;
                 }
              }
         return true
        }

       function checkauditstatus_bounce(){
              for (var i = 0; i < $scope.qadetails.length; i++) {

                 if($scope.qadetails[i].selected == 0){
                   return true;
                 }
              }
         return false
        }

        function checkdebit_deduction(){
            var sumdeduction = 0;
            for (var i = 0; i < $scope.invoicedetails.length; i++) {
                for (var j = 0; j < $scope.invoicedetails[i].DEBIT_DETAILS.length; j++) {
                    sumdeduction += parseFloat($scope.invoicedetails[i].DEBIT_DETAILS[j].Deduction_amt);
                }
            }
            if(sumdeduction.toFixed(2) == parseFloat($scope.othrdeduction).toFixed(2)){
              return true;
            }else{
             return false;
            }
        }

        function check_othercharges(){
            var other_chargechk =  []
            for (var i = 0; i < $scope.invoicedetails.length; i++) {
                if ($scope.invoicedetails[i].checked == false) {
                    other_chargechk.push(i)
                    //$scope.invoicedetails.splice(i, 1);
                }
            }



            for (var i = 1; i <= other_chargechk.length; i++) {

                $scope.invoicedetails.splice(other_chargechk[other_chargechk.length - i ], 1);
            }

        }


        $scope.addrow = function() {
            check_othercharges();
            $scope.invoicedetails.push({
                item: "",
                description: "",
                HSN_Code: "",
                Unit_price: "",
                qty: "",
                Amount: "",
                Discount: 0,
                Amount_todb: 0,
                IGST: "0",
                CGST: "0",
                SGST: "0",
                Total_amount: "",
                Invoice_Sno: "",
                PODATA: "N",
                DEBIT_DETAILS: [],
                checked: true,
                Debit_checked : true
            });
        }

        $scope.add_debit_ppx = function() {


            $scope.invoicedetails.push({
                item: "",
                description: "",
                HSN_Code: "",
                Unit_price: "",
                qty: "",
                Amount: "",
                IGST: "0",
                CGST: "0",
                SGST: "0",
                Total_amount: "",
                Invoice_Sno: "",
                PODATA: "N",
                checked: false,
                TYPE: "ADVANCE",
                Debit_checked : false,
                DEBIT_DETAILS: [{
                    "Invoice_Header_Gid": "",
                    "Invoice_Details_Gid": "",
                    "Category_Gid": "",
                    "Sub_Category_Gid": [],
                    "GL_No": "",
                    "Debit_Amount": "",
                    "Deduction_amt": 0,
                    "Debit_Gid": "",
                    "Inv_Sl_no": $scope.count,
                    "Invoice_Sno": 1,
                    "Frompo": true,
                    "Debit_percentage": 0,
                    "CCBS": [{
                        "total_ccbbs_amt": 0,
                        "CCBS_JSON": [{
                            "Amount": 0,
                            "cc": $scope.Emp_code ,
                            "bs": $scope.Emp_code ,
                            "percentage": 100
                        }]
                    }]
                }]
            });

            $scope.count++


        }

        $scope.add_debit = function() {

            $scope.invoicedetails.push({
                item: "",
                description: "",
                HSN_Code: "",
                Unit_price: "",
                qty: "",
                Amount: "",
                IGST: "0",
                CGST: "0",
                SGST: "0",
                Total_amount: "",
                Invoice_Sno: "",
                Amount_todb: 0,
                PODATA: "N",
                checked: false,
                Debit_checked : false,
                "CC_DropData": [],

                DEBIT_DETAILS: [{
                    "Invoice_Header_Gid": "",
                    "Invoice_Details_Gid": "",
                    "Category_Gid": "",
                    "Sub_Category_Gid": [],
                    "GL_No": "",
                    "Debit_Amount": 0,
                    "Deduction_amt": 0,
                    "Debit_Gid": "",
                    "Inv_Sl_no": $scope.count,
                    "Invoice_Sno": 999,
                    "Frompo": true,
                    "ISAMOUNT": 'Y',
                    "bs_gid": 0 ,
                    "cc_gid": 0 ,
                    "Debit_percentage": 100,
                    "CCBS": [{
                        "total_ccbbs_amt": 0,
                        "CCBS_JSON": [{
                            "Amount": 0,
                            "cc": $scope.Emp_code ,
                            "bs": $scope.Emp_code ,
                            "percentage": 100
                        }]
                    }]
                }]
            });

            $scope.count++
        }

        $scope.save_ppx = function() {
            var paymode = ''
            paymode = $filter('filter')($scope.paymode_dropdwn, function(value) {
                return value.Paymode_name !== "CHEQUE" && value.Paymode_name !== "NEFT";
            });

            var credit_del = [];

            angular.forEach($scope.Creditdetail, function(value, key) {
                if (value.Paymode_name == 'PPX') {
                    credit_del.push(key)
                }
            });

            for (var i = 0; i < credit_del.length; i++) {
                $scope.Creditdetail.splice(credit_del[0], 1);
            }

            if ($scope.checkppx.length > 0) {

                angular.forEach($scope.checkppx, function(value, key) {

                    $scope.Creditdetail.push({
                        "Invoice_Header_Gid": $scope.invoiceheader_gid,
                        "Paymode_Gid": 4,
                        "Paymode_name": "PPX",
                        "bankbranch_ifsccode": "",
                        "bankdetails_beneficiaryname": "",
                        "GL_No": value.debit_glno,
                        "Bank_Gid": 0,
                        "Ref_No": value.invoiceheader_crno,
                        "Tax_Gid": "",
                        "Tax_Type": "",
                        "Tax_Rate": "",
                        "TDS_Exempt": "N",
                        "Credit_Amount": value.Liquidate,
                        "Credit_Gid": "",
                        "TDS_Click": false,
                        "paymode_dropdwn": paymode,
                        "ppx_headergid": value.ppxheader_gid,
                        "Credit_catgid":value.debit_categorygid,
                        "Credit_subcatgid":value.debit_subcategorygid
                    });
                })
            }
            $scope.credit_rate();

        }

        $scope.qtyvalid = function(ppx_dtl) {

            if (ppx_dtl.ppxheader_balance - (ppx_dtl.ecfqty = ppx_dtl.ecfqty || 0) < ppx_dtl.Liquidate) {
                alert("Amount Cannot Exists Balance Amount");
                ppx_dtl.Liquidate = 0;
            }
        }

        $scope.checkppx = [];
        $scope.toggleCheck = function(ppx) {
            if ($scope.checkppx.indexOf(ppx) === -1) {
                $scope.checkppx.push(ppx);
            } else {
                $scope.checkppx.splice($scope.checkppx.indexOf(ppx), 1);
            }
            //  alert( JSON.stringify($scope.checkppx))
        };

        function ppx_getfunction(action) {
           var filterdata_ppx = {"Employee_gid":$scope.Emp_gid,"Supplier_gid":$scope.supplier_gid}

            var ppx_details = invoiceService.ppxdetails(action,filterdata_ppx);
            ppx_details.then(function(result) {

                if(((JSON.parse(result.data)).length) > 0 ){
                        $mdToast.show(
                      $mdToast.simple()
                        .textContent('Check For Advance')
                        .position('bottom right')
                      .theme('error-toast')
                        .hideDelay(0)
                    );
                }else{

                }
                $scope.ppxdetails_grid = JSON.parse(result.data);

            })
        }

        $scope.add_credit = function(type_) {
            var paymode = ''
            paymode = $filter('filter')($scope.paymode_dropdwn, function(value) {
                return value.Paymode_name !== "CHEQUE" && value.Paymode_name !== "NEFT" &&
                 value.Paymode_name !== "CRD"&& value.Paymode_name !== "ERA"&& value.Paymode_name !== "BRA"&& value.Paymode_name !== "AMORT"&& value.Paymode_name !== "CN";
            });

            if(type_ == 'tds'){
                  paymode = $filter('filter')($scope.paymode_dropdwn, function(value) {
                    return value.Paymode_name == "TDS" });
            }
            $scope.Creditdetail.push({
                "Invoice_Header_Gid": $scope.invoiceheader_gid,
                "Paymode_Gid": 0,
                "Paymode_name": "",
                "bankbranch_ifsccode": "",
                "bankdetails_beneficiaryname": "",
                "GL_No": "",
                "Bank_Gid": 0,
                "Ref_No": "",
                "Tax_Gid": "",
                "Tax_Type": "",
                "subdetails_gid": 0,
                "Tax_Rate": "",
                "TDS_Exempt": "N",
                "Credit_Amount": "",
                "Credit_Gid": "",
                "TDS_Click": false,
                "paymode_dropdwn": paymode,
                "ppx_headergid": 0
            });

        }

        $scope.Addccbs = function() {

            $scope.invoicedetails[$scope.CCBS_parentIndex].DEBIT_DETAILS[$scope.CCBS_index].CCBS[0].CCBS_JSON.push({
                "Amount": 0,
                "cc": "",
                "bs": "",
                "percentage": 0
            });
        }

        $scope.CCBS_click = function(index, parentindex) {

            $scope.CCBS_index = index;
            $scope.CCBS_DETAILS = $scope.invoicedetails[parentindex].DEBIT_DETAILS[index].CCBS[0].CCBS_JSON;
            $scope.ccbs_debit_amount = $scope.invoicedetails[parentindex].DEBIT_DETAILS[index].CCBS[0].total_ccbbs_amt;
            $scope.CCBS_parentIndex = parentindex;

            modalshow('mdl_ccbs');
        }

            // IMPREST WITH GST//

         $scope.save_supplierdata = function(index){
         debugger;
            $scope.invoicedetails[index].product_name="";
            $scope.invoicedetails[index].HSN_Code="";
             $scope.invoicedetails[index].hsn_igstrate="";
             $scope.invoicedetails[index].IGST=0;
             $scope.invoicedetails[index].CGST=0;
             $scope.invoicedetails[index].SGST=0;
              if($scope.invoicedetails[index].suppliergstno == '0'){
                $scope.invoicedetails[index].dest_gstno="0";
                $scope.invoicedetails[index].branch="";
                $scope.invoicedetails[index].branch_gid="0";
             }
             amount_to_debit(index);



            $scope.today_date = new Date();
            $scope.maxDates = new Date(
                    $scope.today_date.getFullYear(),
                    $scope.today_date.getMonth() - 6,
                    $scope.today_date.getDate() - 1
            );
            $scope.other_date=new Date($scope.invoicedetails[index].invoicedate)
            if( $scope.other_date<$scope.maxDates){
                $scope.six_month_date_alert="Date is greater than six months";
                 var r = confirm("Date is greater than six months, Are you sure to continue");
                  if (r == true) {

                  } else {
                    return false;
                  }
            }
            else{
                $scope.six_month_date_alert="";
            }


            if($scope.invoicedetails[index].suppliergstno != undefined && $scope.invoicedetails[index].dest_gstno != undefined &&  $scope.invoicedetails[index].dest_gstno != "" ){
<!--                  var gstno = '4'+$scope.invoicedetails[index].suppliergstno.substring(0, 2)-->
<!--                  $scope.invoicedetails[index].Category_Gid = $filter('filter')($scope.tablevalue, { category_no: gstno }, 'exact')[0].category_gid;-->
<!--                       // $scope.gstcat_gid = $filter('filter')($scope.tablevalue, { category_no: '464' }, 'exact')[0].category_gid;-->
<!--                        var subjson = {-->
<!--                            "Table_name": "ap_mst_tsubcategory",-->
<!--                            "Column_1": "subcategory_gid,subcategory_name,subcategory_glno,subcategory_code",-->
<!--                            "Column_2": "",-->
<!--                            "Where_Common": "subcategory",-->
<!--                            "Where_Primary": "categorygid",-->
<!--                            "Primary_Value": $scope.invoicedetails[index].Category_Gid,-->
<!--                            "Order_by": "name"-->
<!--                         };-->
<!--                        var dropdown = invoiceService.gettablevalue(subjson);-->
<!--                         dropdown.then(function(result) {-->
<!--                           if(result.data.length != 0 ){-->
<!--                               $scope.invoicedetails[index].subcategory = result.data;-->

<!--                                modalhide('mdl_ccbs')-->
<!--                           }else{-->
<!--                             alert("Enter valid supplier gstno")-->
<!--                           }-->
<!--                        },-->
<!--                        function() {-->
<!--                            alert('no data');-->
<!--                        });-->
                                  modalhide('mdl_ccbs')

            } else{
                var r = confirm("Enter valid branch and supplier gst, Proceed Without gst");
                  if (r == true) {
                     modalhide('mdl_ccbs')
                  } else {
                  }

            }
         }

          $scope.Close_supplier=function(index){
         debugger;
            if($scope.invoicedetails[index].suppliergstno==0 || $scope.invoicedetails[index].suppliergstno==undefined){
             $scope.invoicedetails[index].dest_gstno="";
             $scope.invoicedetails[index].branch="";
             $scope.invoicedetails[index].branch_gid="";
             }
         }

        $scope.soourcedata = function(query) {

             var datas={params:{"type":"Mode","Sub_Type":"Summary_new",
                               "FILTER":{"Limit_Start":0,"Limit_End":30,"branch_name":"","branch_detail":query,
                                            "branch_code":""},"CLASSIFICATION":{"Entity_Gid":[0]}}};

             return $http.post(Appname + '/classificationdata_get/' , datas).then(function(data) {
                var final_values=data.data.DATA;
                console.log(final_values);
                return final_values;
              });
        }

        $scope.branchNameChanged = function (index,branch){

           if(branch != undefined){

               $scope.invoicedetails[$scope.supplierindex].branch_gid  =branch.branch_gid;
          //    $scope.invoicedetails[$scope.supplierindex].dest_gstno  =branch.branch_gid;


                  var branchData = $filter('filter')(JSON.parse(branch.branchdetail), {
                        metadata_value: "GSTNO"
                    });

                $scope.invoicedetails[$scope.supplierindex].dest_gstno = branchData[0].branch_metadatavalue;

           }else{

            $scope.invoicedetails[$scope.supplierindex].dest_gstno = "";

           }
        }
       $scope.Supplier_split = function(index) {
            if ($scope.selectedtype == "PETTYCASH") {
                $scope.invoicedetails[index].branch=$scope.branch_name_;
                $scope.invoicedetails[index].dest_gstno=$scope.dest_gstno;
            }

                    $scope.supplierindex = index;
                     modalshow('mdl_ccbs');

       }


       $scope.Debit_split = function(index, parentindex) {

           $scope.invoicedetails[parentindex].DEBIT_DETAILS.splice(index +1,0,{
                "Invoice_Header_Gid": "",
                "Invoice_Details_Gid": "",
                "Category_Gid": '',
                "Sub_Category_Gid": '',
                "subcategory": [],
                "GL_No": '',
                "Debit_Amount": 0,
                "Deduction_amt": 0,
                "Debit_Gid": "",
                "Inv_Sl_no": parentindex +1,
                "Invoice_Sno": parentindex +1,
                "ISAMOUNT": 'Y',
                "Debit_percentage":0,

                "CCBS": [{
                    "total_ccbbs_amt": 0,
                    "CCBS_JSON": [{
                        "Amount": 0,
                        "cc": $scope.Emp_code ,
                        "cc_dropdowndata": [] ,
                        "bs_gid": 0 ,
                        "cc_gid": 0 ,
                        "bs": $scope.Emp_code ,
                        "percentage": 100
                    }]
                }]
            });
        }

        $scope.CCBS_PERchange = function(index, value) {

            var percentage_value = percentage($scope.ccbs_debit_amount, value);
            var sum = 0;

            angular.forEach($scope.invoicedetails[$scope.CCBS_parentIndex].DEBIT_DETAILS[$scope.CCBS_index].CCBS[0].CCBS_JSON, function(value, key) {
                sum += parseFloat(value.percentage);
                if (sum > 100) {
                    value.percentage = 0;
                    value.Amount = 0;
                }
            });

            if (sum > 100) {
                alert("Percentage Exists");
                return false;
            } else {
                $scope.invoicedetails[$scope.CCBS_parentIndex].DEBIT_DETAILS[$scope.CCBS_index].CCBS[0].CCBS_JSON[index].Amount = percentage_value;
            }
        }

         $scope.CCBS_ccclick = function(index, value) {

            var percentage_value = percentage($scope.ccbs_debit_amount, value);
            var sum = 0;

            angular.forEach($scope.invoicedetails[$scope.CCBS_parentIndex].DEBIT_DETAILS[$scope.CCBS_index].CCBS[0].CCBS_JSON, function(value, key) {
                sum += parseFloat(value.percentage);
                if (sum > 100) {
                    value.percentage = 0;
                    value.Amount = 0;
                }
            });

            if (sum > 100) {
                alert("Percentage Exists");
                return false;
            } else {
                $scope.invoicedetails[$scope.CCBS_parentIndex].DEBIT_DETAILS[$scope.CCBS_index].CCBS[0].CCBS_JSON[index].Amount = percentage_value;
            }
        }

        function percentage(num, per) {

            return (num / 100) * per;
        }
       $scope.View_auditcheck = function(){
        modalshow('audit_popup');
       }


        //POMAKER CLICK


        $scope.header_change = function(){
            var d = $scope.invdate;
            var curr_date = d.getDate();
            var curr_month = d.getMonth();
            curr_month++;
            var curr_year = d.getFullYear();
            $scope.dat_toupdate = curr_year + "-" + curr_month + "-" + curr_date;
             if($scope.checkboxModel.value == true){$scope.gst_p = 'Y';
             } else{$scope.gst_p = 'N';
             }
              if($scope.rcmModel.value == true){     $scope.rcm_p = 'Y';
             } else{    $scope.rcm_p = 'N';

             }
              if($scope.amortModel.value == true){ $scope.amort_p = 'Y';
             } else{  $scope.amort_p = 'N';
             }
             if($scope.captalizedModel.value == true){
                $scope.cap_p = 'Y';
             } else{
                 $scope.cap_p = 'N';
             }


             var header_json = {
                    "HEADER": [{
                        "Invoice_Header_Gid": $scope.invoiceheader_gid,
                        "Is_GST":$scope.gst_p,
                        "IS_AMMORT":$scope.amort_p,
                        "IS_cap":$scope.cap_p,
                        "Is_RCM":$scope.rcm_p,
                        "Invoice_Date":$scope.dat_toupdate,
                        "Invoice_No":$scope.invoicenum,
                        "Invoice_Tot_Amount":$scope.invoiceamount,
                        "taxableamt":$scope.invoicetaxamount,
                    }]

                }
          // var save_service = invoiceService.invoiceset_update(header_json);
          // save_service.then(function(result) {
          //                 if(result.data == 'SUCCESS'){
          //                    alert("Invoice Updated Successfully")

          //                  }else{
          //                    alert("Error")
          //                  }
          //  });

        }


        $scope.ponumberclick = function() {

            var POdtl = {
                pono: $scope.POno,
                supplier_gid: $scope.POsupplier_gid,
                invoiceheader_gid: $scope.invoiceheader_gid,
                Status: "NEW",
                CHECKLIST: CHECKLIST
            };
            sessionStorage.setItem('POdtl', JSON.stringify(POdtl));
            $window.location.href = "POinvoicemk";
        }
<!--          $scope.pmd_igst = 0;-->
<!--          $scope.pmd_cgst = 0;-->
<!--          $scope.pmd_sgst = 0;-->
          $scope.cr_no="";

        $scope.screen = function(jsondata, callback) {
            var channel = invoiceService.getauditchklist($scope.selectedtype);
            channel.then(function(result) {
                        modalshow('audit_popup');

                    $scope.qadetails = JSON.parse(result.data);


                },
            function(err) {
                alert('No data!.');
            }).finally();

            var deferred = $q.defer();
            var promise = deferred.promise;
            promise.then(function() {
                var summary = invoiceService.getmakerservice(jsondata.id, jsondata.status);
                summary.then(function(result) {
                      //  alert(JSON.stringify(result.data))
                        $scope.loading()

                        $scope.invoiceheader_rcmapplicable = result.data[0].invoiceheader_rcmapplicable;
                        try{
                            //$scope.get_note_key(result.data[0].invoiceheader_crno);
                        }catch (error) {
                                              alert(error);

                        }
                        $scope.cr_no=result.data[0].invoiceheader_crno;
                        $scope.pan_no_ = result.data[0].supplier_panno;
                        $scope.transactionbranch =  result.data[0].branch_code;
                        $scope.Pono = result.data[0].invoiceheader_ponumber;
                        $scope.invoiceheader_imagepath = result.data[0].invoiceheader_imagepath;
                        $scope.invoicenum = result.data[0].invoiceheader_invoiceno;
                        $scope.invoiceheader_invoiceisoriginal = result.data[0].invoiceheader_invoiceisoriginal;
                        $scope.invoiceamount = result.data[0].invoiceheader_amount;
                        $scope.invoicetaxamount = result.data[0].invoiceheader_taxableamt;
                        $scope.invoiceheader_gid = result.data[0].invoiceheader_gid;
	                    $scope.invoiceheader_status = result.data[0].invoiceheader_status;

	                    //six month date finding
                        $scope.invdate_temp = new Date(result.data[0].invoiceheader_invoicedate_full);
                        console.log($scope.invdate);
                        var invoice_date=new Date($scope.invdate_temp);
                        $scope.six_month_before_date=load_FromDatas();
                        function load_FromDatas(){
                            return new Date(
                               invoice_date.getFullYear(),
                               invoice_date.getMonth()+6,
                               invoice_date.getDate()
                            );
                        }
                        $scope.Todate=new Date();
                        if($scope.six_month_before_date < $scope.Todate){
                            $scope.invoice_date_status=1;
                        }
                        //six month date finding completed


                        $scope.gstno = result.data[0].gst_no;
                        if(result.data[0].gst_no == null){
                              $scope.gstno = "NOGST"
                        }
//alert($scope.gstno)
                        if(result.data[0].gst_no !== null){
                            $scope.statecode = 4 + (result.data[0].gst_no).substring(0, 2);

                        }else{
                           $scope.statecode = 0;
                        }
                        $scope.ppx_present = result.data[0].invoiceheader_ppx;
                        $scope.supplier_name_ = result.data[0].supplier_branchname;

                        $scope.Emp_gid = result.data[0].invoiceheader_employeegid;
                        $scope.employee_name_ = result.data[0].employee_name;
                        $scope.Emp_code = result.data[0].employee_code;
                        //alert($scope.Emp_code )
                        $scope.remarks = result.data[0].invoiceheader_remarks;
                        $scope.to_date = result.data[0].invoiceheader_invoicedate;
                        $scope.invdate = new Date(result.data[0].invoiceheader_invoicedate_full);
                        $scope.selectedstate = result.data[0].address_state_gid;
                            $scope.selectedsource = result.data[0].branch_gid;
                            $scope.branch_name_ = result.data[0].branch_name;

                        if(result.data[0].invoiceheader_dueadjustment == 'Y'){
                          $scope.checkbox_due.value = true;
                        }
                        if(result.data[0].invoiceheader_rcmapplicable == 'Y'){
                          $scope.rcmModel.value = true;
                        } if(result.data[0].invoiceheader_captalisedflag == 'Y'){

                          $scope.captalizedModel.value = true;
                        } if(result.data[0].invoiceheader_amortinvoice == 'Y'){
                          $scope.amortModel.value = true;
                        }

                        if( $scope.rcmModel.value == true && $scope.gstno == null){
                              $scope.gstno = '34';
                              $scope.statecode = 4 + $scope.gstno.substring(0, 2);
                        }

                        $scope.Gstvalidate = result.data[0].IS_GST;


<!--                             var dest_data = JSON.parse(result.data[0].branchdetail);-->
                            $scope.dest_gstno = result.data[0].branch_metadatavalue;

<!--                            var branchData = $filter('filter')(dest_data, {-->
<!--                                metadata_value: "GSTNO"-->
<!--                            });-->
<!--                            $scope.dest_gstno = branchData[0].branch_metadatavalue;-->
<!--                            var stateData = $filter('filter')(dest_data, {-->
<!--                                metadata_value: "State_gid"-->
<!--                            });-->
<!--                            $scope.dest_stategid = stateData[0].branch_metadatavalue-->

                        if(result.data[0].pmdbranch_gstno != 0){
                              $scope.dest_gstno =result.data[0].pmdbranch_gstno;
<!--                              $scope.pmd_igst = result.data[0].pmdbranch_igst_accountno;-->
<!--                              $scope.pmd_cgst = result.data[0].pmdbranch_cgst_accountno;-->
<!--                              $scope.pmd_sgst = result.data[0].pmdbranch_sgst_accountno;-->
                                $scope.ISPMD =result.data[0].pmdbranch_gstno;
                              $scope.statecode = 8 + (result.data[0].pmdbranch_gstno).substring(0, 2);

                        }

                        if (result.data[0].IS_GST == 'Y') {
                        debugger;
                            $scope.checkboxModel.value = true;
                            $scope.gstkeyhide = true;




                        }

<!--                        if (jsondata.status == "MAKER" || jsondata.status == "Checker" || jsondata.status == "Reject") {-->
                        if (jsondata.status != "NEW") {
                            $scope.selectedtype = result.data[0].invoiceheader_invoicetype;
                            $scope.supplier_gid = result.data[0].supplier_gid;
                            $scope.othrchrges = result.data[0].invoiceheader_otheramount;
                            $scope.netamt = result.data[0].invoiceheader_amount
                            $scope.debit_netamt = result.data[0].invoiceheader_amount
                            $scope.credit_netamt = result.data[0].invoiceheader_amount
                            if ($scope.selectedtype == "Non PO") {
                                $scope.pohide = !$scope.pohide;
                                $scope.poarrow = !$scope.poarrow;
                            } else {
                                $scope.POno = result.data[0].po_no;
                                $scope.ponumbr = true;
                                $scope.poarrow = !$scope.poarrow;
                            }
                        }
                        if ($scope.selectedtype == "PETTYCASH" || $scope.selectedtype == "TCF") {
                             $scope.imprest_view = true;
                          }
                         if($scope.selectedtype == 'ADVANCE'){
                          $scope.statecode = 0;
                           $scope.dropdownjson = {
                                "Table_name": "ap_mst_tcategory",
                                "Column_1": "category_gid,category_name,category_no,category_code",
                                "Column_2": "",
                                "Where_Common": "category",
                                "Where_Primary": "name",
                                "Primary_Value": "ADVANCE",
                                "Order_by": "name"
                            };
                        }
                                dropdownlist($scope.dropdownjson, callback,$scope.statecode);
                                dropdownccbslist($scope.dropdownjsonccbs, callback);


                    },
                    function(err) {
                        alert('No data!.');
                    }).finally($scope.endloading);

            }).then(function() {
                // callback();
            });
            deferred.resolve();
        };


        var makerdtl_ecf = JSON.parse(sessionStorage.getItem('makerdtl_ecf'));

        if (makerdtl_ecf !== null) {
            $scope.viaecf = true;

            $scope.selectedtype = makerdtl_ecf.type;
            $scope.prestatus = makerdtl_ecf.prestatus;
            $scope.invoiceheader_gid = makerdtl_ecf.invoiceheader_gid;
            $scope.POsupplier_gid = makerdtl_ecf.supplier_gid;
            $scope.supplier_gid = makerdtl_ecf.supplier_gid;
              $scope.status_ = makerdtl_ecf.status_;
            var json_fordatafetch = {
                "id": $scope.invoiceheader_gid,
                "status":  $scope.status_
            }
            $scope.screen(json_fordatafetch, function() {
                if(makerdtl_ecf.type != 'ADVANCE'){
                    ppx_getfunction('PAYMENT_EMPLOYEE');
                }


                if (makerdtl_ecf.type !== 'PO_' || makerdtl_ecf.type == 'Non PO' || makerdtl_ecf.type == 'ADVANCE' || makerdtl_ecf.type == 'EMP Claim') {

                    if (makerdtl_ecf.type !== 'PO_' || makerdtl_ecf.type == 'Non PO' || makerdtl_ecf.type == 'EMP Claim') {

                        $scope.tablehide = $scope.tablehide
                        $scope.pohide = !$scope.pohide;
                        $scope.poarrow = !$scope.poarrow;
                        $scope.tab = 1;
                    } else {
                        $scope.tablehide = $scope.tablehide
                        $scope.PPX_HTML = !$scope.PPX_HTML;
                        $scope.tab = 2;

                        $scope.netamt = $scope.invoiceamount;
                        $scope.credit_ppx = $scope.invoiceamount;
                        $scope.credit_inc = 1;
                    }
                    if (makerdtl_ecf.type == 'ADVANCE'){
                         $scope.tablehide = $scope.tablehide
                        $scope.PPX_HTML = !$scope.PPX_HTML;
                        $scope.tab = 2;
                    }
                 //   var editer = invoiceService.ECFcheckersummary(makerdtl_ecf.ECF_no, $scope.selectedtype);
                         var datas={params:{"action":"GET","type":"APPROVER_NAME_1", "filter":{"InvoiceHeader_CRNO":makerdtl_ecf.ECF_no,"invoicetype":$scope.selectedtype}}};
<!--                    var checker = invoiceService.ECFcheckersummary_NEW(makerdtl_ecf.ECF_no, $scope.selectedtype);-->
                    var checker = invoiceService.ECFcheckersummary_NEW(datas);
            checker.then(function(result) {

                    $scope.count = 1;
                angular.forEach(result.data.invoice, function(value, key) {

                    var no = 0
                    var debitdata = JSON.parse(value.DEBIT_DETAILS)
                    var debitdetails = []
                    var categorygidpush = []
                    var bsgidpush = [];

                    $scope.payment_ins = value.invoiceheader_paymentinstruction;
                    $scope.invoiceheader_tds = value.invoiceheader_tds;
                    console.log($scope.invoiceheader_tds);

                    if(value.invoiceheader_otheramount > 0){
                        $scope.othrchrges = value.invoiceheader_otheramount;

                    }

                    if (value.invoicedetails_item == 'Other Amount') {
                        var checked = false;
                        var Invoice_Sno = 999
                        $scope.othrchrges = value.invoicedetails_totalamt;
                    } else {
                        var checked = true;
                        var Invoice_Sno = $scope.count
                    }



                    var categoryvalue = []
                    angular.forEach(debitdata, function(values, keys) {
                        var tbs_name = values.tbs_name
                        var isamt = 'Y';
                        var ccbs = JSON.parse(values.CCBS)
                        var ccbsjson =[]// JSON.parse(ccbs[0].CCBS_JSON)
                        categoryvalue.push(debitdata.Category_Gid)
                        var sendcount = $scope.count// + "_" + no;
                        if(tbs_name == 'GST'){
                            var sendcount = $scope.count + "_" + no;
                              no++
                              isamt = 'N';
                        }
                        categorygidpush.push(values.Category_Gid)
                        bsgidpush.push(values.bs_id);

                        debitdetails.push({
                            "Invoice_Header_Gid": "",
                            "Invoice_Details_Gid": "",
                            "Category_Gid": values.Category_Gid,
                            "category_name": values.category_name,
                            "Sub_Category_Gid": values.Sub_Category_Gid,
                            "subcategory_name": values.subcategory_name,
                            "GL_No": values.GL_No,
                            "Debit_Amount": values.Debit_Amount,
                            "Deduction_amt": values.Deduction_amt,
                            "Debit_Gid": "",
                            "Inv_Sl_no": sendcount,
                            "Invoice_Sno": Invoice_Sno,
                            "bs_gid": values.bs_id,
                            "cc_gid": values.cc_id,
                            "Frompo": true,
                            "ISAMOUNT": isamt,
                            "Debit_percentage":values.percent,
                            "CCBS": [{
                                "total_ccbbs_amt": values.Debit_Amount,
                                "CCBS_JSON": ccbsjson
                            }]
                        })

                    })
                    $scope.taxable_amt = value.invoiceheader_taxableamt;
                    $scope.othrdeduction = value.invoiceheader_deductionamount;

                    $scope.invoicedetails.push({
                        "item": value.invoicedetails_item,
                        "description": value.invoicedetails_desc,
                        "HSN_Code": value.invoicedetails_hsncode,
                        "Unit_price": value.invoicedetails_unitprice,
                        "qty": value.invoicedetails_qty,
                        "Amount": value.invoicedetails_amount + value.invoicedetails_discount,
                        "Discount": value.invoicedetails_discount,
                        "Amount_todb": value.invoicedetails_amount ,
                        "IGST": value.invoicedetails_igst,
                        "CGST": value.invoicedetails_cgst,
                        "SGST": value.invoicedetails_sgst,
                        "Total_amount": value.invoicedetails_totalamt,
                        "PO_Header_Gid": value.ecfinvoicepo_poheadergid,
                        "PO_Detail_Gid": value.ecfinvoicepo_podetailsgid,
                        "GRN_Header_Gid": value.ecfinvoicepo_grninwardheadergid,
                        "GRN_Detail_Gid": value.ecfinvoicepo_grninwarddetailsgid,
                        "product_name": value.invoicedetails_productname,
                        "detailProduct_name": value.invoicedetails_productname,
                        "detailProduct_gid": value.invoicedetails_productgid,
                        "Invoice_Header_gid": "",
                        "supplier_gid": "",
                        "pono": "",
                        "state": "",
                        "checked": checked,
                        "Debit_checked" : true,
                        "Invoice_Sno": value.invoicedetails_gid,
                        "DEBIT_DETAILS": debitdetails,
                        "TYPE": $scope.selectedtype,
                        "dest_gstno": value.invoicedetails_branchgstno,
                        "invoiceno": value.invoicedetails_invoiceno,
                        "suppliercode": value.invoicedetails_suppliercode,
                        "suppliergstno": value.invoicedetails_suppliergstno,
                        "suppliername": value.invoicedetails_suppliername,
                        "invoicedate": new Date(value.invoicedetails_invoicedate),
                        "branch_gid": value.invoicedetails_branchgid,
                    })
                    $scope.count++

                        for (var i = 0; i < categorygidpush.length; i++) {
                            $scope.category_click(categorygidpush[i], i, key)

                        }
                       for (var i = 0; i < bsgidpush.length; i++) {
                            $scope.bs_click(bsgidpush[i], i, key)

                        }
                })


<!--                if ($scope.selectedtype != 'PO' ) {-->
<!--                    credit_data_checker($scope.supplier_gid, $scope.selectedtypee, result.data.credit);-->
<!--                } else {-->
<!--                   if( $scope.ppx_present == 'E'){-->

<!--                    credit_data_checker($scope.Emp_gid, 'PPX_emp', result.data.credit);-->
<!--                   }else if( $scope.ppx_present == 'S' ){-->

<!--                    credit_data_checker($scope.supplier_gid, $scope.selectedtype, result.data.credit);-->
<!--                   }else{-->

<!--                   credit_data_checker($scope.Emp_gid, $scope.selectedtype, result.data.credit);-->

<!--                   }-->
<!--                }-->

                    if($scope.ppx_present == 'I' ){
                         credit_data_checker($scope.selectedsource, $scope.ppx_present, result.data.credit);

                    }else if($scope.ppx_present == 'E'){
                        credit_data_checker($scope.Emp_gid, $scope.ppx_present, result.data.credit);

                    }else{
                        credit_data_checker($scope.supplier_gid, $scope.ppx_present, result.data.credit);
                    ppx_getfunction('PAYMENT_SUPPLIER');

                    }

            })

                }

            });

        }

        function credit_data_ecf(id, type, ecf_value) {

            var credit = invoiceService.creditget(id, 'PPX_emp')
            credit.then(function(result) {
                    $scope.Credit = JSON.parse(result.data);
                    if ($scope.Credit.length <= 0) {
                        alert("No Credit Record")
                    }
                    $scope.Tax_Type = [];
                    $scope.panno = $scope.Credit[0].taxdetails_taxno;
                    var key = 0;
                    angular.forEach($scope.Credit, function(value, key) {

                        if (key == 0) {
                            angular.forEach(ecf_value, function(ecf_value, ecf_key) {

                                if (ecf_value.Paymode_name == 'CHEQUE' || ecf_value.Paymode_name === "NEFT") {

                                    $scope.Creditdetail.push({
                                        "Invoice_Header_Gid": $scope.invoiceheader_gid,
                                        "Paymode_Gid": "",
                                        "Paymode_name": ecf_value.Paymode_name,
                                        "bankbranch_ifsccode": value.bankbranch_ifsccode,
                                        "bankdetails_beneficiaryname": value.bankdetails_beneficiaryname,
                                        "bankbranch_name": value.bankbranch_name,
                                        "bank_name": value.bank_name,
                                        "GL_No": "",
                                        "Bank_Gid": value.bankdetails_bank_gid,
                                        "Ref_No": value.bankdetails_acno,
                                        "Tax_Gid": "",
                                        "Tax_Type": "",
                                        "Tax_Rate": "",
                                        "TDS_Exempt": "N",
                                        "Credit_Amount": "",
                                        "Credit_Gid": "",
                                        "TDS_Click": false,
                                        "paymode_dropdwn": [],
                                        "ppx_headergid": 0,
                                        "Check": true
                                    });

                                    $scope.Creditdetail[ecf_key].paymode_dropdwn = $filter('filter')($scope.paymode_dropdwn, function(value) {
                                        return value.Paymode_name === "CHEQUE" || value.Paymode_name === "NEFT";
                                    });
                                } else if (ecf_value.Paymode_name == 'PPX' || ecf_value.Paymode_name == 'TDS') {

                                    $scope.Creditdetail.push({
                                        "Invoice_Header_Gid": $scope.invoiceheader_gid,
                                        "Paymode_Gid": "",
                                        "Paymode_name": ecf_value.Paymode_name,
                                        "bankbranch_ifsccode": "",
                                        "bankdetails_beneficiaryname": "",
                                        "bankbranch_name": "",
                                        "bank_name": "",
                                        "GL_No": "",
                                        "Bank_Gid": 0,
                                        "Ref_No": ecf_value.ppxheader_crno,
                                        "Tax_Gid": "",
                                        "Tax_Type": ecf_value.credit_suppliertaxrate,
                                        "Tax_Rate": ecf_value.credit_suppliertaxttype,
                                        "TDS_Exempt": "N",
                                        "Credit_Amount": ecf_value.credit_amount,
                                        "Credit_Gid": "",
                                        "TDS_Click": false,
                                        "paymode_dropdwn": [],
                                        "ppx_headergid": ecf_value.ppxheadergid,
                                        "Check": true
                                    });

                                    $scope.Creditdetail[ecf_key].paymode_dropdwn = $filter('filter')($scope.paymode_dropdwn, function(value) {
                                        return value.Paymode_name != "CHEQUE" || value.Paymode_name != "NEFT";
                                    });

                                }

                            })

                        }
                        $scope.Tax_Type.push({
                            "Type": value.tds_tax_type,
                            "Rate": value.tax_rate,
                            "Exempt_Rate": value.exempt_rate,
                            "Exempt_Threshold_Amount": value.exempt_threshold_amount,
                        });
                        key++;
                    })
                },
                function() {
                    alert('no data');
                }).finally(function() {
                <!--                if ($scope.credit_inc == 1) {-->
                <!--                    amount_to_credit($scope.netamt);-->
                <!--                    $scope.credit_inc++-->
                <!--                }-->
            });
        }

        var ppx_rejectdata = [];

        function credit_data_checker(id, type, check_value) {

            var credit = invoiceService.creditget_bank(id, type,$scope.selectedsource)
            credit.then(function(result) {
                    $scope.Credit = JSON.parse(result.data);
                    if ($scope.Credit.length <= 0) {
                        alert("No Credit Record")
                    }
                    $scope.Tax_Type = [];
                    $scope.panno = $scope.Credit[0].taxdetails_taxno;
                    var key = 0;

                   try {
                     angular.forEach($scope.Credit, function(value, key1) {
                        if(key1 == 0){
                            angular.forEach(JSON.parse(value.tds_data), function(tdsvalue, key) {
                                       if(tdsvalue.tds_tax_type != null){
                                           $scope.Tax_Type.push({
                                                "Type": tdsvalue.tds_tax_type,
                                                "Subtax_glno": tdsvalue.subtax_glno,
                                                "Rate": tdsvalue.tax_rate,
                                                "Rate_type": tdsvalue.tds_tax_type.concat(tdsvalue.tax_rate),
                                                "Exempt_Rate": tdsvalue.exempt_rate,
                                                "Exempt_Threshold_Amount": tdsvalue.exempt_threshold_amount,
                                                "ISEXEMPT": tdsvalue.ISEXEMPT,
                                                "subtax_categorygid": tdsvalue.subtax_categorygid,
                                                "subtax_subcategorygid": tdsvalue.subtax_subcategorygid,
                                            });
                                        }
                                  })
                         }

                        //key++;
                     })
                   }catch(err) {
                              alert(err)
                    }
                        if (key == 0) {
                            angular.forEach(check_value, function(check_value, ecf_key) {

                                if (check_value.Paymode_name == 'CHEQUE' || check_value.Paymode_name === "NEFT" || check_value.Paymode_name === "CRD"|| check_value.Paymode_name === "BRA"|| check_value.Paymode_name === "ERA"|| check_value.Paymode_name === "KVBAC") {

                                    $scope.Creditdetail.push({
                                        "Invoice_Header_Gid": $scope.invoiceheader_gid,
                                        "Paymode_Gid": "",
                                        "Paymode_name": check_value.Paymode_name,
                                        "bankbranch_ifsccode": check_value.bankbranch_ifsccode,
                                        "bankdetails_beneficiaryname":check_value.bankdetails_beneficiaryname,
                                        "bankbranch_name": check_value.bankbranch_name,
                                        "bank_name": check_value.bank_name,
                                        "GL_No": check_value.credit_glno,
                                        "Bank_Gid": check_value.bankdetails_gid,
                                        "Ref_No": check_value.bankdetails_acno,
                                        "Tax_Gid": "",
                                        "Tax_Type": "",
                                        "Tax_Rate": "",
                                        "TDS_Exempt": "N",
                                        "Credit_Amount": "",
                                        "Credit_Gid": "",
                                        "TDS_Click": false,
                                        "paymode_dropdwn": [],
                                        "ppx_headergid": 0,
                                        "Check": true
                                    });
                                    var payname2 ='';
                                      if($scope.ppx_present == 'E'){
                                         payname2 = 'ERA';
                                     }

                                      if($scope.ppx_present == 'I'){
                                         payname2 = 'BRA';
                                     }
                                      if($scope.ppx_present == '' || $scope.ppx_present == 'S'){
                                         payname2 = 'NEFT';
                                     }

                                    if(  $scope.checkbox_due.value == false){
<!--                                        $scope.Creditdetail[ecf_key].paymode_dropdwn = $filter('filter')($scope.paymode_dropdwn, function(value) {-->
<!--                                            return value.Paymode_name === "ERA" || value.Paymode_name === "BRA" || value.Paymode_name === "NEFT";-->
<!--                                        });-->
<!--                                        -->
                                          if($scope.ppx_present == ''  || $scope.ppx_present == 'S'){
                                                $scope.Creditdetail[ecf_key].paymode_dropdwn = $filter('filter')($scope.paymode_dropdwn, function(value) {
                                                 return  value.Paymode_name === 'NEFT' || value.Paymode_name === 'DD'|| value.Paymode_name === 'CREDITGL'|| value.Paymode_name === 'KVBAC';
                                                });
                                          }else{
                                               $scope.Creditdetail[0].paymode_dropdwn = $filter('filter')($scope.paymode_dropdwn, function(value) {
                                                return   value.Paymode_name === payname2 ;
                                                });
                                          }
                                    }else {
                                        $scope.Creditdetail[0].paymode_dropdwn = $filter('filter')($scope.paymode_dropdwn, function(value) {
                                        return value.Paymode_name === "CRD" ;
                                      });

                                    }
                                } else if (check_value.Paymode_name == 'PPX' || check_value.Paymode_name == 'TDS') {

                                     if (check_value.ppxdetails_gid > 0) {

                                            ppx_rejectdata.push({
                                                "Details_Gid": check_value.ppxdetails_gid,
                                            })
                                      }
                                      var TDS_Click = false;
                                      if(check_value.Paymode_name == 'TDS'){
                                        TDS_Click = true
                                      }
                                     // alert(check_value.ppxdetails_ppxheadergid)
                                    $scope.Creditdetail.push({
                                        "Invoice_Header_Gid": $scope.invoiceheader_gid,
                                        "Paymode_Gid": "",
                                        "Paymode_name": check_value.Paymode_name,
                                        "bankbranch_ifsccode": "",
                                        "bankdetails_beneficiaryname": "",
                                        "bankbranch_name": "",
                                        "GL_No": check_value.credit_glno,
                                        "Bank_Gid": 0,
                                        "Ref_No": check_value.credit_refno,
                                        "Tax_Gid": "",
                                        "Tax_Type": check_value.credit_suppliertaxtype,
                                        "Tax_Rate": check_value.credit_suppliertaxtrate,
                                        "Rate_type": check_value.credit_suppliertaxtype.concat(check_value.credit_suppliertaxtrate),
                                        "TDS_Exempt": "N",
                                        "taxable_amt":check_value.credit_taxableamount,
                                        "Credit_Amount": check_value.credit_amount,
                                        "Credit_Gid": "",
                                        "Credit_catgid": check_value.credit_categorygid,
                                        "Credit_subcatgid": check_value.credit_subcategorygid,
                                        "TDS_Click": TDS_Click,
                                        "paymode_dropdwn": [],
                                        "ppx_headergid": check_value.ppxdetails_ppxheadergid,
                                        "Check": false
                                    });

                                    $scope.Creditdetail[ecf_key].paymode_dropdwn = $filter('filter')($scope.paymode_dropdwn, function(value) {
                                        return value.Paymode_name == "TDS" || value.Paymode_name == "PPX" ;
                                    });

                                }else if(check_value.Paymode_name == 'DD' || check_value.Paymode_name == 'CREDITGL'){
                                  if( check_value.Paymode_name == 'CREDITGL'){
                                     check_value.bankdetails_gid = 0;
                                  }
                                  $scope.Creditdetail.push({
                                        "Invoice_Header_Gid": $scope.invoiceheader_gid,
                                        "Paymode_Gid": "",
                                        "Paymode_name": check_value.Paymode_name,
                                        "bankbranch_ifsccode": "",
                                        "bankdetails_beneficiaryname":check_value.bankdetails_beneficiaryname,
                                        "bankbranch_name": "",
                                        "GL_No": check_value.credit_glno,
                                        "Bank_Gid": check_value.bankdetails_gid,
                                        "Ref_No": check_value.credit_refno,
                                        "Tax_Gid": "",
                                        "Tax_Type": "",
                                        "trnbranch": check_value.credit_ddtranbranch,
                                        "paybranch": check_value.credit_ddpaybranch,
                                        "Tax_Rate": "",
                                        "TDS_Exempt": "N",
                                        "Credit_Amount": check_value.credit_amount,
                                        "Credit_Gid": "",
                                        "TDS_Click": false,
                                        "paymode_dropdwn": [],
                                        "ppx_headergid": 0,
                                        "Check": true
                                    });

                                     $scope.Creditdetail[ecf_key].paymode_dropdwn = $filter('filter')($scope.paymode_dropdwn, function(value) {
                                        return value.Paymode_name == "DD" || value.Paymode_name == "CREDITGL";
                                    });
                                    if($scope.ppx_present == ''  || $scope.ppx_present == 'S'){
                                                $scope.Creditdetail[ecf_key].paymode_dropdwn = $filter('filter')($scope.paymode_dropdwn, function(value) {
                                                 return  value.Paymode_name === 'NEFT' || value.Paymode_name === 'DD'|| value.Paymode_name === 'CREDITGL'|| value.Paymode_name === 'KVBAC';
                                                });
                                          }


                                }

                            })

                        }

                },
                function() {
                    alert('no data');
                }).finally(function() {
                <!--                if ($scope.credit_inc == 1) {-->
                <!--                    amount_to_credit($scope.netamt);-->
                <!--                    $scope.credit_inc++-->
                <!--                }-->
            });
        }

        var makerdtl = JSON.parse(sessionStorage.getItem('makerdtl'));
<!--        var CHECKLIST = JSON.parse(sessionStorage.getItem('CHECKLIST'));-->

        if (makerdtl !== null) {
            $scope.selectedtype = makerdtl.type;
            $scope.prestatus = makerdtl.prestatus;
            $scope.invoiceheader_gid = makerdtl.invoiceheader_gid;
            $scope.POsupplier_gid = makerdtl.supplier_gid;
            $scope.supplier_gid = makerdtl.supplier_gid;
             $scope.status_ = makerdtl.status_;
            var json_fordatafetch = {
                "id": $scope.invoiceheader_gid,
                "status": makerdtl.status_
            }
            $scope.screen(json_fordatafetch, function() {

                if (makerdtl.type == 'Non PO') {
                    $scope.tablehide = $scope.tablehide
                    $scope.pohide = !$scope.pohide;
                    $scope.poarrow = !$scope.poarrow;
                    $scope.tab = 1;

                    $scope.invoicedetails = [{
                        item: "",
                        description: "",
                        HSN_Code: "",
                        Unit_price: "",
                        qty: "",
                        Amount: 0,
                        Discount: 0,
                        Amount_todb: 0,
                        IGST: "0",
                        CGST: "0",
                        SGST: "0",
                        Total_amount: 0,
                        Invoice_Sno: "",
                        checked: true,
                        Debit_checked : true,
                        TYPE: "Non PO",
                        DEBIT_DETAILS: []
                    }];

                    credit_data($scope.supplier_gid, $scope.ppx_present);
                    ppx_getfunction('PAYMENT_SUPPLIER');

                } else if (makerdtl.type == 'PO') {
                    $scope.tablehide = !$scope.tablehide
                    $scope.tab = 4;
                    $scope.podetail = !$scope.podetail;
                    ppx_getfunction('PAYMENT_SUPPLIER');
                } else if (makerdtl.type == 'ADVANCE') {
                    $scope.tablehide = $scope.tablehide
                    $scope.PPX_HTML = !$scope.PPX_HTML;
                    $scope.tab = 2;
                    $scope.invoicedetails = [{
                        item: "ADVANCE",
                        description: "ADVANCE",
                        HSN_Code: "1",
                        Unit_price: "1",
                        qty: "1",
                        Amount: $scope.invoiceamount,
                        IGST: "0",
                        CGST: "0",
                        SGST: "0",
                        TYPE: "ADVANCE",
                        Total_amount: $scope.invoiceamount,
                        Invoice_Sno: "1",
                        checked: true,
                        TYPE: "ADVANCE",
                        DEBIT_DETAILS: []
                    }];

                    $scope.netamt = $scope.invoiceamount;
                    $scope.credit_ppx = $scope.invoiceamount;
                    $scope.credit_inc = 1;
                    if($scope.ppx_present  == 'E'){
                        credit_data($scope.Emp_gid, $scope.ppx_present);
                     }  else{
                       credit_data($scope.supplier_gid, $scope.ppx_present);
                     }
<!--                   if($scope.ppx_present == 'E'){-->
<!--                        credit_data($scope.Emp_gid, 'PPX_emp'); //using employee gid to get bank detail employee record-->
<!--                   }else{-->
<!--                       credit_data($scope.supplier_gid, 'PPX_supp'); //using employee gid to get bank detail employee record-->
<!--                   }-->

                } else {

                    $scope.tablehide = $scope.tablehide
                    $scope.pohide = !$scope.pohide;
                    $scope.poarrow = !$scope.poarrow;
                    $scope.tab = 1;
                    $scope.invoicedetails = [{
                        item: "",
                        description: "",
                        HSN_Code: "",
                        Unit_price: "",
                        qty: "",
                        Amount: 0,
                        Discount: 0,
                        Amount_todb: 0,
                        IGST: "0",
                        CGST: "0",
                        SGST: "0",
                        Total_amount: 0,
                        Invoice_Sno: "",
                        checked: true,
                        TYPE: "Non PO",
                        DEBIT_DETAILS: []
                    }];
                                        credit_data($scope.supplier_gid, $scope.ppx_present);

<!--                    credit_data($scope.Emp_gid, 'EMP Claim');-->
                    ppx_getfunction('PAYMENT_EMPLOYEE');
                }
            });
        }
         $scope.changededuction = function() {
           if($scope.othrdeduction == undefined){
                    $scope.othrdeduction = 0;
           }
            if($scope.othrdeduction != 0){
                  paymode = $filter('filter')($scope.paymode_dropdwn, function(value) {
                            return value.Paymode_name == "CREDITGL" ;
                        });
                 for(i=0;i<$scope.Creditdetail.length;i++){
                    if($scope.Creditdetail[i].Ref_No=="DEDUCTION"){
                        $scope.Creditdetail.splice(i, 1);
                    }
                 }
                   $scope.Creditdetail.push({
                    "Invoice_Header_Gid": $scope.invoiceheader_gid,
                    "Paymode_Gid": 10,
                    "Paymode_name": "CREDITGL",
                    "bankbranch_ifsccode": "",
                    "bankdetails_beneficiaryname": "",
                    "GL_No": "123",
                    "Bank_Gid": 0,
                    "Ref_No": "DEDUCTION",
                    "Tax_Gid": "",
                    "Tax_Type": "",
                    "subdetails_gid": 0,
                    "Tax_Rate": "",
                    "TDS_Exempt": "N",
                    "Credit_Amount": $scope.othrdeduction,
                    "Credit_Gid": "",
                    "TDS_Click": false,
                    "paymode_dropdwn": paymode,
                    "ppx_headergid": 0
                });
            }

        }
        $scope.chargesenter = function() {
            if ($scope.othrchrges == undefined) {
                var othrchrg = 0;
            } else {
                var othrchrg = parseFloat($scope.othrchrges)
            }
            $scope.netamt = $scope.calculatePay + othrchrg;
            $scope.Creditdetail[0].Credit_Amount = $scope.netamt - -($scope.othrdeduction);
            $scope.credit_netamt = $scope.netamt;
            $scope.credit_rate();
        }

        $scope.product_rate = function(index) {
            var invoicedetail = $scope.invoicedetails;

            if (invoicedetail[index].IGST == '') {
                var IGST = 0;
            } else {
                var IGST = parseFloat(invoicedetail[index].IGST);
            }
            if (invoicedetail[index].CGST == '') {
                var CGST = 0;
            } else {
                var CGST = parseFloat(invoicedetail[index].CGST);
            }
            if (invoicedetail[index].SGST == '') {
                var SGST = 0;
            } else {
                var SGST = parseFloat(invoicedetail[index].SGST);
            }

            invoicedetail[index].Amount = parseFloat(invoicedetail[index].Unit_price) * parseFloat(invoicedetail[index].qty);
            invoicedetail[index].Amount_todb = invoicedetail[index].Amount - invoicedetail[index].Discount ;
            invoicedetail[index].Total_amount = (invoicedetail[index].Amount_todb) + parseFloat(IGST) + parseFloat(CGST) + parseFloat(SGST);

        }



        $scope.AP_detail = [];
        $scope.AP_debit = [];
        $scope.AP_credit = [];
        var _branchgid,_branchgstno,_suppliername,_suppliercode,_suppliergstno,_invoiceno,_invoicedate = 0;
        function APjson_set(value) {

            if ($scope.checkboxModel.value == false) {
                value.HSN_Code = "1";
                value.IGST = 0
                value.CGST = 0
                value.SGST = 0
            }
             if(value.HSN_Code == "" ){
                    value.HSN_Code = "1";
            }
            if($scope.selectedtype == "PETTYCASH"){
             _branchgid =0;_branchgstno=0;_suppliername=0;_suppliercode=0;_suppliergstno=0;_invoiceno=0;_invoicedate=0;
                       if(value.suppliercode == undefined || value.suppliername == undefined || value.suppliercode == 0  || value.suppliername == 0  ){
                       if(value.suppliercode == undefined || value.suppliercode == 0 ){
                               alert("Enter Supplier Pincode")
                         }
                       if(value.suppliername == undefined || value.suppliername == 0 ){
                                alert("Enter Supplier Name")
                       }

                        javascript_abort();
                       }
                       if(value.dest_gstno !== undefined){ _branchgstno = value.dest_gstno; }
                       if(value.invoiceno !== undefined){ _invoiceno = value.invoiceno; }
                       if(value.suppliercode !== undefined){ _suppliercode = value.suppliercode; }
                          if(value.suppliername !== undefined){ _suppliername = value.suppliername; }
                       if(value.suppliergstno !== undefined){ _suppliergstno = value.suppliergstno; }
                       if(value.branch_gid !== undefined){ _branchgid = value.branch_gid; }
                       if(value.invoicedate !== undefined){
                                        var d = value.invoicedate;
                                        var curr_date = d.getDate();
                                        var curr_month = d.getMonth();
                                        curr_month++;
                                        var curr_year = d.getFullYear();
                                        _invoicedate = curr_year + "-" + curr_month + "-" + curr_date;
                        }
           }
            var total_amt = parseFloat(value.Total_amount).toFixed(2);
            $scope.AP_detail.push({
                "Item_Name": value.item,
                "Description": value.description,
                "HSN_Code": value.HSN_Code,
                "Unit_Price": value.Unit_price,
                "Quantity": value.qty,
                "Amount": parseFloat(value.Amount_todb).toFixed(2),
                "DetailProduct_name": value.detailProduct_name,
                "DetailProduct_gid": value.detailProduct_gid,
                "Discount": value.Discount,
                "IGST": value.IGST,
                "CGST": value.CGST,
                "SGST": value.SGST,
                "Total_Amount": total_amt,
                "PO_Header_Gid": "0",
                "PO_Detail_Gid": "",
                "GRN_Header_Gid": "",
                "GRN_Detail_Gid": "",
                "Invoice_Header_gid": $scope.invoiceheader_gid,
                "Invoice_Sno": value.Invoice_Sno,
                "Invoice_Other_Amount": $scope.othrchrges,
                "_branchgstno":_branchgstno,
                "_invoiceno": _invoiceno,
                "_suppliercode": _suppliercode,
                "_suppliername": _suppliername,
                "_suppliergstno": _suppliergstno,
                "_branchgid": _branchgid,
                "_invoicedate": _invoicedate
            })
        }

        function APPOjson_set(value) {

            var total_amt = parseFloat(value.Total_amount).toFixed(2);
            $scope.AP_detail.push({
                "Item_Name": value.item,
                "Description": value.description,
                "HSN_Code": value.HSN_Code,
                "Unit_Price": value.Unit_price,
                "Quantity": value.qty,
                "Amount": parseFloat(value.Amount_todb).toFixed(2),
                "Discount": value.Discount,
                "IGST": value.IGST,
                "CGST": value.CGST,
                "SGST": value.SGST,
                "Total_Amount": total_amt,
                "PO_Header_Gid": value.PO_Header_Gid,
                "PO_Detail_Gid": value.PO_Detail_Gid,
                "GRN_Header_Gid": value.GRN_Header_Gid,
                "GRN_Detail_Gid": value.GRN_Detail_Gid,
                "Invoice_Header_gid": $scope.invoiceheader_gid,
                "Invoice_Sno": value.Invoice_Sno,
                "Invoice_Other_Amount": $scope.othrchrges
            })
        }

        function PPXjson_set(value) {
            var total_amt = parseFloat(value.Total_amount).toFixed(2);
            //alert(value.Total_Amount)
            $scope.AP_detail.push({
                "Item_Name": value.item,
                "Description": value.description,
                "HSN_Code": value.HSN_Code,
                "Unit_Price": 0,
                "Quantity": value.qty,
                "Amount": parseFloat(value.Amount).toFixed(2),
                "Discount": 0,
                "IGST": value.IGST,
                "CGST": value.CGST,
                "SGST": value.SGST,
                "Total_Amount": total_amt,
                "PO_Header_Gid": "0",
                "PO_Detail_Gid": "",
                "GRN_Header_Gid": "",
                "GRN_Detail_Gid": "",
                "Invoice_Header_gid": $scope.invoiceheader_gid,
                "Invoice_Sno": 1,
                "Invoice_Other_Amount": 0
            })
        }

        function APDebitjson_set(value) {

              // for pmd
            try{

                if((value.subcategory_name).substring(0,4) == 'IGST' && $scope.cap_p == "Y" > 0){ value.GL_No =  '176000120'};
                if((value.subcategory_name).substring(0,4) == 'CGST' && $scope.cap_p == "Y" > 0){ value.GL_No =  '176000115'};
                if((value.subcategory_name).substring(0,4) == 'SGST' && $scope.cap_p == "Y" > 0){ value.GL_No = '176000110'};

                // for pmd
<!--                if((value.subcategory_name).substring(0,4) == 'IGST' && $scope.pmd_igst > 0){ value.GL_No =  $scope.pmd_igst};-->
<!--                if((value.subcategory_name).substring(0,4) == 'CGST' && $scope.pmd_cgst > 0){value.GL_No =  $scope.pmd_cgst  };-->
<!--                if((value.subcategory_name).substring(0,4)== 'SGST' && $scope.pmd_sgst > 0){ value.GL_No =  $scope.pmd_sgst };-->
              }catch (error) {
                      console.log(error);

            }

            var Debit_Amount = parseFloat(value.Debit_Amount).toFixed(2);
            $scope.AP_debit.push({
                "Invoice_Header_Gid": $scope.invoiceheader_gid,
                "Invoice_Details_Gid": "124",
                "Category_Gid": value.Category_Gid,
                "Sub_Category_Gid": value.Sub_Category_Gid,
                "GL_No": value.GL_No,
                "Debit_Amount": Debit_Amount,
                "Debit_Gid": "0",
                "Invoice_Sno": value.Invoice_Sno,
                "Deduction_amt": value.Deduction_amt,
                "cc_id":value.cc_gid,
                "bs_id":value.bs_gid,
                "Debit_percentage":value.Debit_percentage,
            });
        }

        $scope.tds_check = 0;
        function APCreditjson_set(value) {
            if(value.taxable_amt == undefined){ value.taxable_amt = 0; }
            if(value.GL_No == ""){
               value.GL_No  = 1
            }
            if(value.Paymode_name == "TDS"){
              $scope.tds_check = 1;
            }
            if(value.Paymode_name == 'NEFT' || value.Paymode_name == 'ERA' || value.Paymode_name == 'BRA' ){
                  if(value.bank_name == null || value.bankbranch_ifsccode == null||
                                                value.bankdetails_beneficiaryname == null){
                      alert("No Bank data");
                      javascript_abort();
                  }
	        }
            var Credit_Amoun = parseFloat(value.Credit_Amount).toFixed(2);

           if(value.Paymode_name == "TDS" || value.Paymode_name == "PPX" || value.Paymode_name == "CREDITGL"  ){
             if(value.Credit_catgid == null || value.Credit_catgid  == 0 || value.Credit_subcatgid == null || value.Credit_subcatgid  == 0 ){
                alert("Category not matched");
                 javascript_abort();
             }

           }

            $scope.AP_credit.push({
                "Invoice_Header_Gid": value.Invoice_Header_Gid,
                "Paymode_Gid": value.Paymode_Gid,
                "Paymode_name": value.Paymode_name,
                "GL_No": value.GL_No,
                "Bank_Gid": value.Bank_Gid,
                "Ref_No": value.Ref_No,
                "Tax_Gid": value.Tax_Gid,
                "Tax_Type": value.Tax_Type,
                "Tax_Rate": value.Tax_Rate,
                "TDS_Exempt": value.TDS_Exempt,
               "trnbranch": value.trnbranch,
                "paybranch": value.paybranch,
                "Credit_Amount": Credit_Amoun,
                "Credit_Gid": "0",
                "taxable_amt": value.taxable_amt,
                "ppx_headergid": value.ppx_headergid,
                "Is_due" : $scope.checkbox_due.value,
                "supplier_gid" : $scope.supplier_gid,
                "Credit_catgid" : value.Credit_catgid,
                "Credit_subcatgid" : value.Credit_subcatgid
            });
        }

        function credit_data(id, type) {
            var credit = invoiceService.creditget_bank(id, type,$scope.selectedsource)
            credit.then(function(result) {
                    $scope.Credit = JSON.parse(result.data);
                    if ($scope.Credit.length <= 0) {
                        alert("No Credit Record")
                    }
                    $scope.Tax_Type = [];
                    $scope.panno = $scope.Credit[0].taxdetails_taxno;
                    var key = 0;
                    var pay_name1,payname2='';
                    angular.forEach($scope.Credit, function(value, key) {
                        if (key == 0) {
                            pay_name1 = value.Paymode_name;
                            $scope.Creditdetail.push({
                                "Invoice_Header_Gid": $scope.invoiceheader_gid,
                                "Paymode_Gid": "",
                                "Paymode_name": value.Paymode_name,
                                "bankbranch_ifsccode": value.bankbranch_ifsccode,
                                "bankdetails_beneficiaryname": value.bankdetails_beneficiaryname,
                                "bankbranch_name": value.bankbranch_name,
                                "bank_name": value.bank_name,
                                "GL_No": value.paymode_glno,
                                "Bank_Gid": value.bankdetails_gid,
                                "Ref_No": value.bankdetails_acno,
                                "trnbranch": $scope.transactionbranch,
                                "paybranch": 1221,
                                "Tax_Gid": "",
                                "Tax_Type": "",
                                "Tax_Rate": "",
                                "TDS_Exempt": "N",
                                "Credit_Amount": "",
                                "subdetails_gid": "",
                                "Credit_Gid": "",
                                "TDS_Click": false,
                                "paymode_dropdwn": [],
                                "ppx_headergid": 0,
                                "Check": true
                            });
                             angular.forEach(JSON.parse(value.tds_data), function(tdsvalue, key) {
                                   if(tdsvalue.tds_tax_type != null){
                                       $scope.Tax_Type.push({
                                            "Type": tdsvalue.tds_tax_type,
                                            "Subtax_glno": tdsvalue.subtax_glno,
                                            "Rate": tdsvalue.tax_rate,
                                            "Rate_type": tdsvalue.tds_tax_type.concat(tdsvalue.tax_rate),
                                            "Exempt_Rate": tdsvalue.exempt_rate,
                                            "Exempt_Threshold_Amount": tdsvalue.exempt_threshold_amount,
                                            "ISEXEMPT": tdsvalue.ISEXEMPT,
                                              "subtax_categorygid": tdsvalue.subtax_categorygid,
                                                "subtax_subcategorygid": tdsvalue.subtax_subcategorygid,
                                        });
                                    }
                              })
                        }
                           if($scope.ppx_present == 'E'){
                             payname2 = 'ERA';
                         }

                          if($scope.ppx_present == 'I'){
                             payname2 = 'BRA';
                         }
                          if($scope.ppx_present == '' || $scope.ppx_present == 'S'){
                             payname2 = 'NEFT';
                         }

                        if(  $scope.checkbox_due.value == false){
                            if($scope.ppx_present == ''  || $scope.ppx_present == 'S'){
                                $scope.Creditdetail[0].paymode_dropdwn = $filter('filter')($scope.paymode_dropdwn, function(value) {
                                 return  value.Paymode_name === 'NEFT' || value.Paymode_name === 'DD'|| value.Paymode_name === 'CREDITGL' || value.Paymode_name === 'KVBAC';
                                });
                            }else{
                               $scope.Creditdetail[0].paymode_dropdwn = $filter('filter')($scope.paymode_dropdwn, function(value) {
                                return   value.Paymode_name === payname2 ;
                                });
                            }
                         }else{
                            $scope.Creditdetail[0].paymode_dropdwn = $filter('filter')($scope.paymode_dropdwn, function(value) {
                                return value.Paymode_name === "CRD" ;
                            });
                         }


                        key++;
                    })
                },
                function() {
                    alert('no data');
                }).finally(function() {
                if ($scope.credit_inc == 1) {
                    amount_to_credit($scope.netamt);
                    $scope.credit_inc++
                }
                if ($scope.credit_ppx !== undefined) {
                    amount_to_credit($scope.credit_ppx);
                }
            });
        }

        $scope.Accnoclick = function(index,value){
           $scope.Creditdetail[index].bankbranch_ifsccode = value.bankbranch_ifsccode;
           $scope.Creditdetail[index].bankdetails_beneficiaryname = value.bankdetails_beneficiaryname;
           $scope.Creditdetail[index].bankbranch_name = value.bankbranch_name;
           $scope.Creditdetail[index].bank_name = value.bank_name;
           $scope.Creditdetail[index].Bank_Gid = value.bankdetails_gid;
           $scope.Creditdetail[index].Ref_No = value.bankdetails_acno;

        }
        $scope.Taxableamt_change = function(index,taxableamt){
           if(parseFloat(taxableamt) > $scope.invoicetaxamount){
              alert("Entered Taxable-amount is greater than actual taxable amount")
               $scope.Creditdetail[index].taxable_amt = 0;
         }
          $scope.Tax_click($scope.Taxindex,$scope.Taxdetails)
        }

        $scope.Tax_click = function(index, detail) {
            $scope.Taxindex = index;
            $scope.Taxdetails = detail;
            var res = $scope.to_date.split("-");
            var senddate = res[2] + "-" + res[1] + "-" + res[0];
            $scope.Tdstax = {
                "Supplier_Gid": $scope.supplier_gid,
                "Rate": detail.Rate,
                "Exempt_Rate": detail.Exempt_Rate,
                "Amount_Tax": $scope.Creditdetail[index].taxable_amt,
                "Exempt_Threshold_Amount": detail.Exempt_Threshold_Amount,
                "Invoice_Date": senddate,
                "Tax_Type": detail.Type,
                "IS__EXCEMPT":detail.ISEXEMPT
            };

             $scope.taxable_amt = $scope.Creditdetail[index].taxable_amt;
            var hsn_code = invoiceService.gethsntax_credit($scope.Tdstax)
            hsn_code.then(function(result) {
                        $scope.Creditdetail.splice(index + 1, 1);

                    $scope.credittds = JSON.parse(result.data);

                    var tds_data = JSON.parse($scope.credittds[0].TDS_Amount)

                    $scope.Creditdetail[index].Credit_Amount =  Math.ceil(tds_data.tds);
                    $scope.Creditdetail[index].GL_No = detail.Subtax_glno;
                    $scope.Creditdetail[index].Credit_catgid = detail.subtax_categorygid;
                    $scope.Creditdetail[index].Credit_subcatgid = detail.subtax_subcategorygid;
                    $scope.Creditdetail[index].TDS_Exempt = tds_data.Is_Exempt;
                    $scope.Creditdetail[index].Tax_Rate = tds_data.Rate;
                    $scope.Creditdetail[index].Tax_Gid = detail.subdetails_gid;
                    $scope.Creditdetail[index].Tax_Type = detail.Type;
                    $scope.Creditdetail[index].Invoice_Header_Gid = $scope.invoiceheader_gid;
                    $scope.Creditdetail[index].taxable_amt = tds_data.taxableamt;
                    var exemptedamt = JSON.parse($scope.credittds[0].TDS_Amount_Partial_Exempted);

                    if (exemptedamt != 0) {

                        var paymode,payid = ''
                        paymode = $filter('filter')($scope.paymode_dropdwn, function(value) {
                            return value.Paymode_name !== "CHEQUE" && value.Paymode_name !== "NEFT" && value.Paymode_name !== "CRD";
                        });
                        payid = $filter('filter')($scope.paymode_dropdwn, { Paymode_name: 'TDS' }, 'exact')[0].paymode_gid;
                        $scope.Creditdetail.splice(index + 1, 1);
                        $scope.Creditdetail.push({
                            "Invoice_Header_Gid": $scope.invoiceheader_gid,
                            "Paymode_Gid": payid,
                            "Paymode_name": "TDS",
                            "bankbranch_ifsccode": "",
                            "bankdetails_beneficiaryname": "",
                            "GL_No": detail.Subtax_glno,
                            "Credit_catgid": detail.subtax_categorygid,
                            "Credit_subcatgid": detail.subtax_subcategorygid,
                            "Bank_Gid": 0,
                            "Ref_No": 'N',
                            "Tax_Gid": detail.subdetails_gid,
                            "Tax_Type": $scope.Creditdetail[index].Tax_Type,
                            "taxable_amt": exemptedamt.taxableamt ,
                            "Tax_Rate": exemptedamt.Rate,
                            "TDS_Exempt": exemptedamt.Is_Exempt,
                            "Credit_Amount":  Math.ceil(exemptedamt.tds),
                            "Credit_Gid": "",
                            "ppx_headergid": 0,
                            "subdetails_gid":detail.subdetails_gid,
                            "paymode_dropdwn": paymode,
                            "TDS_Click": true,

                        });
                    }
                    $scope.credit_rate();
                },
                function() {
                    alert('no data');
                });
        }

        //DELETE

        $scope.deleteinvoice = function(index) {
            $scope.invoicedetails.splice(index, 1);

            //$scope.calculatePay = calucatesum();

        }

        $scope.deletedebit = function(index, parentindex) {
<!--            $scope.invoicedetails.splice(parentindex, 1);-->
            $scope.invoicedetails[parentindex].DEBIT_DETAILS.splice(index,1);

<!--            $scope.count&#45;&#45;;-->
        }

        $scope.deletecredit = function(index) {
            $scope.Creditdetail.splice(index, 1);
            $scope.credit_rate();
        }


        //FILE VIEW ON BEFORE UPLOAD

        $scope.stepsModel=[];
        $scope.image_visible="false";

        $scope.imageUpload = function(event){
        $scope.stepsModel=[];
        $scope.filenames = [];
        $scope.image_visible ="true";
             var files = event.target.files; //FileList object
             for (var i = 0; i < files.length; i++) {
                 var file = files[i];
                     var reader = new FileReader();
                     reader.onload = $scope.imageIsLoaded;
                     reader.readAsDataURL(file);
                     $scope.filenames.push(file.name);
             }
        }
        $scope.sttepsModel_Last=[];
        $scope.imageIsLoaded = function(e){
            $scope.$apply(function() {
                $scope.stepsModel.push(e.target.result);
            });
            $scope.sttepsModel_Last=[];
            for(var k=0;k<$scope.filenames.length;k++){
                $scope.extension_1=$scope.filenames[k].substr($scope.filenames[k].lastIndexOf('.')+1);
                $scope.sttepsModel_Last.push({"file":$scope.stepsModel[k],"file_name":$scope.filenames[k],"extension":$scope.extension_1});
            }
        }

        $scope.view_images_popup=function(){

<!--            $scope.file_path = $scope.stepsModel;-->
            $scope.file_path = $scope.sttepsModel_Last;
            console.log($scope.file_path);
            console.log($scope.sttepsModel_Last);
            modalshow('view_images');

        }

        $scope.deleted_files=[];
        $scope.delete_one_file=function(index,file_name){
            $scope.file_imglength = document.getElementById('file').files.length;
            for(i=0;i<$scope.file_imglength;i++){
                if(i==index){
                    $scope.file_path.splice(i, 1);
<!--                    var file_img = document.getElementById('file').files[i];-->
<!--                    var file_name=file_img.name;-->
                    $scope.deleted_files.push({"file_names":file_name});
                }
            }
            if($scope.file_path.length==0){
                $scope.remove_all_files();
            }
        }


        $scope.remove_all_files=function(){
            $scope.file_path=[];
            $scope.deleted_files=[];
            elmn = angular.element( document.getElementById( 'file' ).files);
            elmn.remove();
            angular.element("input[type='file']").val(null);
            $scope.image_visible="false";
        }

        //FILE UPLOAD CALL FUNCTION

        $scope.file_path="";
        $scope.file_count=0;
        $scope.file_stored_data=[];
        $scope.number_of_message=1;
        $scope.loaddata = function(file_img,img, callback) {
                var deferred = $q.defer();
                var promise = deferred.promise;
                promise.then(function() {
                    var file_img_length = document.getElementById('file').files.length;
                    if(file_img_length!=0){
                        for(l=0;l<file_img_length;l++){
                            var file_img = document.getElementById('file').files[l];
                            var file_name=file_img.name;
                            $scope.new_file_name=file_img.name;
                            $scope.duplicate_images=1;
                            var imgs = new FormData();
                            imgs.append('file', file_img);
                            imgs.append('name', file_name);
                            for(var p=0;p<$scope.deleted_files.length;p++){
                                $scope.temp_file_names=$scope.deleted_files[p].file_names;
                                if($scope.new_file_name==$scope.temp_file_names){
                                    $scope.duplicate_images=0;
                                    $scope.file_count=$scope.file_count+1;
                                }
                            }
                            if(file_img!=undefined&&$scope.duplicate_images==1){
                              $scope.loading();
                                 var upload = invoiceService.save_files(imgs);
                                 upload.then(function(result) {
                                    $scope.all_datas= result.data;
                                    if($scope.all_datas.status=="SUCCESS"){
                                    $scope.file_count=$scope.file_count+1;
                                    $scope.file_status=1;
                                    $scope.file_stored_data.push($scope.all_datas);
                                    }
                                    else{
                                        $scope.file_status=2;
                                    }
                                    callback();
                                }).finally($scope.endloading);
                            }
                            else{
                                $scope.file_status=0;
                                callback();
                            }
                        }
                    }
                     else{
                                $scope.file_status=1;
                                $scope.endloading();
                                callback();
                                $scope.endloading();

                     }
                }).then(function() {
                    // callback();
                });
                deferred.resolve();

        };


            // SAVE


        $scope.save_details = function(status_,remark_) {

                    if(checkdebit_deduction() == false){
                        alert("Sum of Debit Adjustments Amount Not Equal")
                        javascript_abort();
                    };


                if(status_ == 'CHECKER'){
                    if(checkauditstatus() == false){
                        alert("Audit Checklist Should be Yes or N/A  ")
                        javascript_abort();
                    };

                    if($scope.selectedtype != 'ADVANCE'){
                        if($scope.DEDUPECHECK == false){
                            alert("Check Dedupe")
                            javascript_abort();

                        }
                    }
                }else{
                   if(checkauditstatus_bounce() == false){
                        alert("Any-one AuditChklist Should be No  ")
                        javascript_abort();
                    };


                }
                var debit_amt = $scope.debit_netamt.toFixed(2);
                var debit_amt = parseFloat(debit_amt).toFixed(1);
                var credit_amt = $scope.credit_netamt.toFixed(2);
                var credit_amt = parseFloat(credit_amt).toFixed(1);
                var invoice_amt = parseFloat($scope.invoiceamount).toFixed(1);
                var taxx_amt = parseFloat($scope.invoicetaxamount).toFixed(1);
                var net_amt = $scope.netamt.toFixed(2);
                var net_amt = parseFloat(net_amt).toFixed(1);
                if($scope.rcmModel.value == false || $scope.invoicedetails[0].TYPE !== 'PETTYCASH'){
                   if($scope.rcmModel.value == false){
                        if (invoice_amt !== net_amt || invoice_amt !== debit_amt || invoice_amt !== credit_amt  ||  (parseFloat($scope.Amount_todb_sum).toFixed(1) !== taxx_amt && $scope.selectedtype == "Non PO") ) {
                            if (invoice_amt !== net_amt) {
                                alert("Net Amount Should Be Equal To Invoice Amount");
                                return false;
                            } else if (invoice_amt !== debit_amt) {
                                alert("Debit Amount Should Be Equal To Invoice Amount");
                                return false;
                            }  else if (invoice_amt !== credit_amt)   {
                                alert("Credit Amount Should Be Equal To Invoice Amount");
                                return false;
                            }else {
                                alert("Entered Taxable Amount Should Be Equal To given Taxable-Amount");
                                return false;
                            }
                            return false;
                        }
                    }else{

                    }
                 }else{
                     if (invoice_amt !== net_amt || invoice_amt !== debit_amt || invoice_amt !== credit_amt ) {
                        if (invoice_amt !== net_amt) {
                            alert("Net Amount Should Be Equal To Invoice Amount");
                            return false;
                        } else if (invoice_amt !== debit_amt) {
                            alert("Debit Amount Should Be Equal To Invoice Amount");
                            return false;
                        } else     {
                            alert("Credit Amount Should Be Equal To Invoice Amount");
                            return false;
                        }
                        return false;
                    }
                }

                $scope.AP_detail = [];
                $scope.AP_debit = [];
                $scope.AP_credit = [];

                <!--            if ($scope.invoicedetails.length > 0) {-->
                if ($scope.invoicedetails[0].TYPE == 'Non PO' || $scope.invoicedetails[0].TYPE == 'EMP Claim' || $scope.invoicedetails[0].TYPE == 'BRANCH EXP' || $scope.invoicedetails[0].TYPE == 'PETTYCASH'|| $scope.invoicedetails[0].TYPE == 'SI'|| $scope.invoicedetails[0].TYPE == 'TCF' || $scope.invoicedetails[0].TYPE == 'RENT') {

                    angular.forEach($scope.invoicedetails, function(value, key) {

                        //  alert(JSON.stringify(value));
                        if (value.checked == true) {

                            if(value.CGST != value.SGST){
                                alert("cgst should be equal to sgst");
                                  javascript_abort();
                            }
                            if (value.detailProduct_name == null || value.item == "" || value.item == null || value.description == null || value.description == "" || value.Unit_price == "" || value.Unit_price == null || value.qty == "" || value.qty == null) {
                                if (value.item == "" || value.item == null) {
                                    alert("Enter The Item");
                                    javascript_abort();
                                }
                                if (value.description == null || value.description == "") {
                                    alert("Enter The Description");
                                    javascript_abort();
                                }

                                if (value.Unit_price == "" || value.Unit_price == null) {
                                    alert("Enter The Unit Price");
                                    javascript_abort();
                                }
                                if (value.qty == "" || value.qty == null) {
                                    alert("Enter The Unit Price");
                                    javascript_abort();
                                }
                                if (value.detailProduct_name == "" || value.detailProduct_name == null) {
                                    alert("Enter The product name ");
                                    javascript_abort();
                                }

                            }
                            APjson_set(value)
                        }
                    })
                } else if ($scope.invoicedetails[0].TYPE == 'PO') {

                    angular.forEach($scope.invoicedetails, function(value, key) {


                        if (value.checked == true) {

                            if(value.CGST != value.SGST){
                                alert("cgst should be equal to sgst");
                                  javascript_abort();
                            }
                            if (value.item == "" || value.item == null || value.description == null || value.description == "" || value.Unit_price == "" || value.Unit_price == null || value.qty == "" || value.qty == null) {
                                if (value.item == "" || value.item == null) {
                                    alert("Enter The Item");
                                    javascript_abort();
                                }
                                if (value.description == null || value.description == "") {
                                    alert("Enter The Description");
                                    javascript_abort();
                                }

                                if (value.Unit_price == "" || value.Unit_price == null) {
                                    alert("Enter The Unit Price");
                                    javascript_abort();
                                }
                                if (value.qty == "" || value.qty == null) {
                                    alert("Enter The Unit Price");
                                    javascript_abort();
                                }

                            }
                            APPOjson_set(value)
                        }

                    })

                } else if ($scope.invoicedetails[0].TYPE == 'ADVANCE') {
                    angular.forEach($scope.invoicedetails, function(value, key) {
                        if (value.checked == true) {
                            PPXjson_set(value)
                        }

                    })
                }


                //debit
                angular.forEach($scope.invoicedetails, function(value, hkey) {

                    angular.forEach($scope.invoicedetails[hkey].DEBIT_DETAILS, function(value, key) {
                            //FA GL for captalized
                        if($scope.cap_p == "Y" && value.ISAMOUNT == "Y"){
                              if(value.category_name !== 'FA CLEARING'){
                                    alert("Choose FA-CLEARING Category");
                                   javascript_abort();
                              }
                        }
                        if($scope.amort_p == "Y" && value.ISAMOUNT == "Y"){
                              if(value.category_name !== 'AMORT'){
                                    alert("Choose Amort Category");
                                   javascript_abort();
                              }
                        }

                        if (value.Debit_Amount == "" || value.Debit_Amount == null || value.Category_Gid == "" ||
                                          value.Sub_Category_Gid == 0    ||  value.Sub_Category_Gid == "" || value.GL_No == "" || value.GL_No == null  || value.bs_gid=="" ||value.cc_gid==""|| value.bs_gid==undefined ||value.cc_gid==undefined) {
                            //alert(value.Debit_Amount)
                            if (value.Debit_Amount == "" || value.Debit_Amount == null) {
                                alert("Enter The Debit Amount");
                            }
                            if (value.Category_Gid == "") {
                                alert("Choose The Category");
                                javascript_abort();
                            }
                            if (value.Sub_Category_Gid == "" || value.Sub_Category_Gid == 0) {
                                alert("Choose The Sub Category");
                                javascript_abort();
                            }
                            if (value.GL_No == "" || value.GL_No == null) {
                                alert("Enter The GL NO");
                                javascript_abort();
                            }
                             if (value.bs_gid == "" || value.bs_gid == null || value.cc_gid=="" || value.cc_gid==null) {
                                alert("Enter BS and CC");
                                javascript_abort();
                            }



                        }
                        var sum = 0;
    <!--                    angular.forEach(value.CCBS[0].CCBS_JSON, function(value, key) {-->
    <!--                        sum += parseFloat(value.percentage)-->
    <!--                        if (value.cc == "" || value.bs == "") {-->

    <!--                            alert("Enter cc and bs In CCBS");-->
    <!--                            javascript_abort();-->
    <!--                        }-->

    <!--                    })-->

    <!--                    if (sum == 100) {-->

    <!--                    } else {-->

    <!--                        alert("Percentage Is Less Than 100")-->
    <!--                        javascript_abort();-->
    <!--                    }-->

                        APDebitjson_set(value);
                    });
                });


                //credit
                angular.forEach($scope.Creditdetail, function(value, key) {
                    if (value.Credit_Amount == null || value.Credit_Amount == "") {
                        if (value.Credit_Amount == "" || value.Credit_Amount == null) {
                            alert("Enter The Credit Amount");
                            javascript_abort();
                        }
                    }
                    APCreditjson_set(value);
                });


                 if($scope.selectedtype == "Non PO" && $scope.Tax_Type.length > 0 && $scope.tds_check == 0 ){
                      var r = confirm("TDS Is Applicable For This Supplier, Proceed Without TDS");
                      if (r == true) {

                      } else {
                            javascript_abort();
                      }
<!--                      if($scope.tds_details_show==0){-->
<!--                            alert("Please Check TDS Details...");-->
<!--                            javascript_abort();-->
<!--                            return false;-->
<!--                      }-->
<!--                      else{-->
<!--                            for(var i=0;i<$scope.Subtax_Amount_Data.length;i++){-->
<!--                                var limit=0;-->
<!--                                $scope.current_total_table_amount=0;-->
<!--                                limit=$scope.Subtax_Amount_Data[0].subtax_amount;-->
<!--                                $scope.current_total_table_amount=$scope.total_taxable_amount+$scope.invoicetaxamount;-->
<!--                                if($scope.current_total_table_amount>limit){-->
<!--                                    alert("Taxable Amount is Greater than Threshold Limit!");-->
<!--                                    javascript_abort();-->
<!--                                    return false;-->
<!--                                }-->
<!--                            }-->
<!--                      }-->
<!--                       if($scope.invoicetaxamount>30000){-->
<!--                             alert("Taxable Amount is Greater than Threshold Limit.");-->
<!--                                javascript_abort();-->
<!--                                return false;-->
<!--                       }-->

                 }


                var detail_json = {
                    DETAIL: $scope.AP_detail
                }

                var debit_json = {
                    DEBIT: $scope.AP_debit
                }

                var credit_json = {
                    CREDIT: $scope.AP_credit
                }

    <!--            if ($scope.othrchrges !== 0 || $scope.othrdeduction !== 0 ) {-->

                    var d = $scope.invdate;
                    var curr_date = d.getDate();
                    var curr_month = d.getMonth();
                    curr_month++;
                    var curr_year = d.getFullYear();
                    $scope.dat_toupdate = curr_year + "-" + curr_month + "-" + curr_date;
                     if($scope.checkboxModel.value == true){$scope.gst_p = 'Y';
                     } else{$scope.gst_p = 'N';
                     }
                      if($scope.rcmModel.value == true){     $scope.rcm_p = 'Y';
                     } else{    $scope.rcm_p = 'N';

                     }
                      if($scope.amortModel.value == true){ $scope.amort_p = 'Y';
                     } else{  $scope.amort_p = 'N';
                     }
                     if($scope.captalizedModel.value == true){
                        $scope.cap_p = 'Y';
                     } else{
                         $scope.cap_p = 'N';
                     }

                    var header_json = {
                        "HEADER": [{
                            "Invoice_Other_Amount": $scope.othrchrges,
                            "othrdeduction": $scope.othrdeduction,
                            "Invoice_Header_Gid": $scope.invoiceheader_gid,

                            "Is_GST":$scope.gst_p,
                            "IS_AMMORT":$scope.amort_p,
                            "IS_cap":$scope.cap_p,
                            "Is_RCM":$scope.rcm_p,
                            "Invoice_Date":$scope.dat_toupdate,
                            "Invoice_No":$scope.invoicenum,
                            "Invoice_Tot_Amount":$scope.invoiceamount,
                            "taxableamt":$scope.invoicetaxamount,
                            "payment_instruction":$scope.payment_ins,
                            "invoiceheader_remarks":$scope.remarks
                        }]

                    }
    <!--            } else {-->
    <!--                var header_json = {};-->
    <!--            }-->


                var status_json = {
                    "Invoice_Header_Gid": $scope.invoiceheader_gid,
                    "Status": status_,
                     "Remark": remark_,
                     "prestatus": $scope.prestatus,
                }
                $scope.loading();
                console.log(detail_json);
                console.log(debit_json);
                console.log(credit_json);
                console.log(header_json);
                var CHECKLIST = {
                        "CHECKLIST": $scope.qadetails,
                        "HEADER_GID": $scope.invoiceheader_gid,
                }

                //SAKTHIVEL ADDED

                    var file_img = document.getElementById('file').files[0];
                    $scope.list_of_files= document.getElementById('file').files.length;
                    var img = new FormData();
                    var UPLOAD_FILE="";

                    if(file_img!=undefined){
                        $scope.file_status=0;
                        var file_name=file_img.name;

                        var filename = file_img.name;
                        var index = filename.lastIndexOf(".");
                        $scope.strsubstring = filename.substring(index, filename.length);

                        img.append('file', file_img);
                        img.append('name', filename);
                    }
                    $scope.loaddata(file_img,img, function() {
                        if($scope.file_status==1&&$scope.file_count==$scope.list_of_files){
                            status_json.file_data=$scope.file_stored_data;

                            //OLD CODE
                            $scope.loading();
                            var save_service = invoiceService.invoiceset(detail_json, debit_json, credit_json, header_json, status_json);
                            save_service.then(function(result) {

                                $scope.AP_detail = [];
                                if (result.data == 'SUCCESS') {
                                    var DATA = invoiceService.setauditchklist(CHECKLIST)
                                    DATA.then(function(result) {
                                        if (result.data == 'SUCCESS') {
                                            $scope.endloading();
                                            if(status_ == 'CHECKER'){
                                                alert("Data Inserted Successfully")
                                            }else{
                                               alert("Data Bounced")
                                            }
                                            $window.location.href = "makersummary";
                                        }else{
                                            alert(result.data);
                                            $scope.endloading();
                                        }

                                    })

                                }
                                else if(result.data=="ALREADY PROCESSED"){
                                    alert(result.data);
                                    $window.location.href = "makersummary";
                                }

                                 else {
                                        console.log(result.data)
                                }

                            })
                        }
                        else if($scope.file_status==2){
                            alert("File Upload Failed");
                        }
                        else if($scope.file_status==0 && $scope.file_path.length==0 && $scope.number_of_message==1){
                            alert("Please Attach File");
                            $scope.deleted_files=[];
                            $scope.number_of_message=$scope.number_of_message+1;
                            $scope.endloading();
                        }
                    });



        }

        //POMAKERJSON
        var pomaker = sessionStorage.getItem('POjson');
        if (pomaker !== null) {
            $scope.selectedtype = "PO";
            $scope.tablehide = $scope.tablehide
            $scope.pohide = !$scope.pohide;
            $scope.poarrow = !$scope.poarrow;
            $scope.tab = 1;
            $scope.AP_detail = [];
            $scope.AP_debit = [];
            $scope.AP_credit = [];
            var timer;
            $scope.invoicedetails = JSON.parse(pomaker);
            //alert(JSON.stringify($scope.invoicedetails))
            // $scope.podetail = !$scope.podetail;
            $scope.invoiceheader_gid = $scope.invoicedetails[0].Invoice_Header_gid;
            $scope.suppli_gid = $scope.invoicedetails[0].supplier_gid;
            $scope.POno = $scope.invoicedetails[0].pono
            var json_fordatafetch = {
                "id": $scope.invoiceheader_gid,
                "status": $scope.invoicedetails[0].status
            }
            $scope.screen(json_fordatafetch, function() {
                    ppx_getfunction('PAYMENT_SUPPLIER');

                angular.forEach($scope.invoicedetails, function(user, index, array) {
                     if($scope.Gstvalidate == 'N'){
                                          $scope.invoicedetails[index].HSN_Code = 'NOHSN';
                             $scope.dest_gstno = "NOGST"}
                    $scope.hsndetail = {
                        "HSN_CODE": user.HSN_Code,
                        "Rate": user.Unit_price,
                        "Discount": 0 ,
                        "Qty": user.qty,
                        "State_Billed_From_Gid": $scope.gstno.substring(0, 2),
                        "State_Billed_To_Gid":$scope.dest_gstno.substring(0, 2)

                    };

                    var hsn_code = invoiceService.gethsntax($scope.hsndetail)
                    hsn_code.then(function(result) {
                            $scope.hsncode = [];
                            $scope.hsncode = JSON.parse(result.data);
                            user.CGST = parseFloat(parseFloat($scope.hsncode[1].gst[0].CGST_Amount).toFixed(2));
                            user.SGST = parseFloat(parseFloat($scope.hsncode[0].gst[0].SGST_Amount).toFixed(2));
                            user.IGST = parseFloat(parseFloat($scope.hsncode[2].gst[0].IGST_Amount).toFixed(2));
                            if($scope.Gstvalidate == 'N'){ user.CGST  = 0; user.SGST = 0; user.IGST = 0}
                            user.Total_amount = user.Amount + user.IGST + user.CGST + user.SGST;
                            sum += parseFloat(user.Total_amount);
                            $scope.calculatePay = sum

                            $scope.netamt = $scope.calculatePay + parseFloat($scope.othrchrges);
                            invlength++;

                            <!--                        if (invlength === array.length) {-->

                            amount_to_debit(index);
                            var bscc_j = JSON.parse(user.bscc)
                            var catsub_j = JSON.parse(user.prod_catsub)
                           //  alert(bscc_j['bs_gid'])
                            $scope.invoicedetails[index].DEBIT_DETAILS[0].Sub_Category_Gid = catsub_j['subcat_id'];
                            $scope.invoicedetails[index].DEBIT_DETAILS[0].Category_Gid = catsub_j['cat_id'];
                            $scope.invoicedetails[index].DEBIT_DETAILS[0].category_name = catsub_j['cat_name'];
                            $scope.invoicedetails[index].DEBIT_DETAILS[0].subcategory_name = catsub_j['subcat_name'];
                            $scope.invoicedetails[index].DEBIT_DETAILS[0].GL_No = catsub_j['gl'];
                            $scope.invoicedetails[index].DEBIT_DETAILS[0].bs_gid = bscc_j['bs_gid'];
                            $scope.invoicedetails[index].DEBIT_DETAILS[0].cc_gid = bscc_j['cc_gid'];
                            $scope.category_click(catsub_j['cat_id'], 0, index)
                            $scope.bs_click(bscc_j['bs_gid'], 0, index)

                            <!--                         }-->

                        },
                        function() {
                            alert('no data');
                        });
                })
                    credit_data($scope.supplier_gid, $scope.ppx_present);

<!--                credit_data($scope.suppli_gid, 'PO');-->

            });

            $scope.selectedtype = "PO";
            $scope.supplier_gid = $scope.suppli_gid;
            //      $scope.ponumbr = "true";
            $scope.credit_inc = 1;


            var sum = 0;
            var invoicedtl = $scope.invoicePOdetails;
            var invlength = 0;



        }

        //CHECKER && APPROVAL

        function checkerinv_set(value) {
            $scope.invoicePOdetails.push({
                "Item_Name": value.invoicedetails_item,
                "description": value.invoicedetails_desc,
                "HSN_Code": value.invoicedetails_hsncode,
                "Unit_Price": value.invoicedetails_unitprice,
                "Quantity": value.invoicedetails_qty,
                "Amount": value.invoicedetails_amount,
                "IGST": value.invoicedetails_igst,
                "CGST": value.invoicedetails_cgst,
                "SGST": value.invoicedetails_sgst,
                "Total_Amount": value.invoicedetails_totalamt,
                "PO_Header_Gid": "",
                "PO_Detail_Gid": "",
                "GRN_Header_Gid": "",
                "GRN_Detail_Gid": "",
                "Invoice_Header_gid": "",
                "supplier_gid": "",
                "pono": "",
                "state": "",
                "Invoice_Sno": value.invoicedetails_gid

            })

        }
        let z = 0;
        var inno = 0;
        var deb_ck = 0
        var nxt = 0;
        var debsl = 0;

<!--        function debit_create(value, key) {-->
<!--            // alert(value[0])-->
<!--            if (deb_ck == value.invoicedetails_gid) {-->
<!--                inno = debsl + "_" + nxt;-->
<!--            } else {-->
<!--                deb_ck = value.invoicedetails_gid;-->
<!--                debsl++-->
<!--                inno = debsl;-->
<!--                nxt = 0-->
<!--            }-->
<!--            $scope.category_click(value.debit_categorygid, key)-->
<!--            $scope.Debitdetail.push({-->
<!--                "Invoice_Header_Gid": "",-->
<!--                "Invoice_Details_Gid": "",-->
<!--                "Category_Gid": value.debit_categorygid,-->
<!--                "Sub_Category_Gid": value.debit_subcategorygid,-->
<!--                "GL_No": value.debit_glno,-->
<!--                "Debit_Amount": value.debit_amount,-->
<!--                "Debit_Gid": "",-->
<!--                "Invoice_Sno": "",-->
<!--                "Inv_Sl_no": inno,-->
<!--                "CCBS": [{-->
<!--                    "total_ccbbs_amt": 0,-->
<!--                    "CCBS_JSON": JSON.parse(value.ccbsjsondata)-->
<!--                }]-->
<!--            });-->
<!--            nxt++;-->
<!--        }-->



        var checkerdtl = sessionStorage.getItem('checkerdtl');
        var Approvdtl = sessionStorage.getItem('Approvdtl');
        var rejectdtl = sessionStorage.getItem('rejectdtl');
        var Viewap_dtl = sessionStorage.getItem('Viewap_dtl');
        if (checkerdtl !== null || Approvdtl !== null || rejectdtl !== null || Viewap_dtl !== null) {

            if (checkerdtl !== null) {
                $scope.statusdtl = JSON.parse(checkerdtl);
                $scope.approval = true;
                $scope.Header = "Invoice Checker";
            } else if (Approvdtl !== null) {
                $scope.statusdtl = JSON.parse(Approvdtl);
                $scope.approval = true;
                $scope.Header = "Invoice Approval";
            } else if (Viewap_dtl !== null) {
                $scope.statusdtl = JSON.parse(Viewap_dtl);
              //  $scope.approval = true;
                    $scope.Header = "Invoice Approval";
            }
             else {
                $scope.statusdtl = JSON.parse(rejectdtl);
                $scope.approval = true;
                $scope.reproces = true;
                $scope.Header = "Claim Reject";

            }

            if ($scope.statusdtl.type !== 'ADVANCE') {

                $scope.tablehide = $scope.tablehide
                $scope.pohide = !$scope.pohide;
                $scope.poarrow = !$scope.poarrow;
                $scope.tab = 1;
            } else {
                $scope.tablehide = $scope.tablehide
                $scope.PPX_HTML = !$scope.PPX_HTML;
                $scope.tab = 2;

                $scope.netamt = $scope.invoiceamount;
                $scope.credit_ppx = $scope.invoiceamount;
                $scope.credit_inc = 1;
            }




            $scope.add_row = true;
            $scope.hide_show = true;
            $scope.other_charge = true;
            $scope.invoiceview = true;
            $scope.create_screen = !$scope.create_screen
            var head_gid = $scope.statusdtl.invoiceheader_gid;


            if (checkerdtl !== null) {
                var json_fordatafetch = {
                    "id": head_gid,
                    "status": "CHECKER"
                }
                $scope.screen(json_fordatafetch, function() {
                  //  $scope.checkboxModel.value = !$scope.checkboxModel.value;
                    Checkerview();

                });
            } else if (Approvdtl !== null) {
                var json_fordatafetch = {
                    "id": head_gid,
                    "status": "Checker"
                }
                $scope.screen(json_fordatafetch, function() {
               //     $scope.checkboxModel.value = !$scope.checkboxModel.value;
                    Checkerview()
                });
            }  else if (Viewap_dtl !== null) {

                var json_fordatafetch = {
                    "id": head_gid,
                    "status":  $scope.statusdtl.status
                }
                $scope.screen(json_fordatafetch, function() {
                  //  $scope.checkboxModel.value = !$scope.checkboxModel.value;
                    Checkerview()
                });
            } else {
                var json_fordatafetch = {
                    "id": head_gid,
                    "status": "Reject"
                }
                $scope.screen(json_fordatafetch, function() {
                  //  $scope.checkboxModel.value = !$scope.checkboxModel.value;
                    Checkerview()
                });
            }
        }


        function Checkerview() {
            var type_check = $scope.selectedtype;
            if($scope.selectedtype == 'ADVANCE' && $scope.ppx_present == 'E'){
               type_check = 'PPX_emp';
            }
             if($scope.selectedtype == 'PETTYCASH'){
               type_check = 'IMP';
            }
            var checker = invoiceService.checkersummary(head_gid, type_check);
            checker.then(function(result) {

                    $scope.count = 1;
                angular.forEach(result.data.invoice, function(value, key) {

                    var no = 0
                    var debitdata = JSON.parse(value.DEBIT_DETAILS)
                    var debitdetails = []
                    var categorygidpush = []
                    var bsgidpush = []

                    if (value.invoicedetails_item == 'Other Amount') {
                        var checked = false;
                        var Invoice_Sno = 999
                        $scope.othrchrges = value.invoicedetails_totalamt;
                    } else {
                        var checked = true;
                        var Invoice_Sno = $scope.count
                    }



                    var categoryvalue = []
                    angular.forEach(debitdata, function(values, keys) {
                        var ccbs = JSON.parse(values.CCBS)
                        var ccbsjson = JSON.parse(ccbs[0].CCBS_JSON)
                        categoryvalue.push(debitdata.Category_Gid)
                        var sendcount = $scope.count + "_" + no;
                        categorygidpush.push(values.Category_Gid)
                        bsgidpush.push(values.bs_id)

                        debitdetails.push({
                            "Invoice_Header_Gid": "",
                            "Invoice_Details_Gid": "",
                            "Category_Gid": values.Category_Gid,
                            "Sub_Category_Gid": values.Sub_Category_Gid,
                            "GL_No": values.GL_No,
                            "Debit_Amount": values.Debit_Amount,
                            "Debit_Gid": "",
                            "Inv_Sl_no": sendcount,
                            "Invoice_Sno": Invoice_Sno,
                            "bs_gid": values.bs_id,
                            "cc_gid": values.cc_id,
                            "Frompo": true,
                            "Debit_percentage":values.percent,
                            "CCBS": [{
                                "total_ccbbs_amt": values.Debit_Amount,
                                "CCBS_JSON": ccbsjson
                            }]
                        })
                        no++
                    })

                    $scope.invoicedetails.push({
                        "item": value.invoicedetails_item,
                        "description": value.invoicedetails_desc,
                        "HSN_Code": value.invoicedetails_hsncode,
                        "Unit_price": value.invoicedetails_unitprice,
                        "qty": value.invoicedetails_qty,
                        "Amount": value.invoicedetails_amount + value.invoicedetails_discount,
                        "Discount": value.invoicedetails_discount,
                        "Amount_todb": value.invoicedetails_amount ,
                        "IGST": value.invoicedetails_igst,
                        "CGST": value.invoicedetails_cgst,
                        "SGST": value.invoicedetails_sgst,
                        "Total_amount": value.invoicedetails_totalamt,
                        "PO_Header_Gid": value.ecfinvoicepo_poheadergid,
                        "PO_Detail_Gid": value.ecfinvoicepo_podetailsgid,
                        "GRN_Header_Gid": value.ecfinvoicepo_grninwardheadergid,
                        "GRN_Detail_Gid": value.ecfinvoicepo_grninwarddetailsgid,
                        "Invoice_Header_gid": "",
                        "supplier_gid": "",
                        "pono": "",
                        "state": "",
                        "checked": checked,
                        "Debit_checked" : true,
                        "Invoice_Sno": value.invoicedetails_gid,
                        "DEBIT_DETAILS": debitdetails,
                        "TYPE": $scope.selectedtype,
                        "dest_gstno": value.invoicedetails_branchgstno,
                        "invoiceno": value.invoicedetails_invoiceno,
                        "suppliercode": value.invoicedetails_suppliercode,
                        "suppliergstno": value.invoicedetails_suppliergstno,
                        "invoicedate": value.invoicedetails_invoicedate,
                        "branch_gid": value.invoicedetails_branchgid,

                    })
                    $scope.count++

                        for (var i = 0; i < categorygidpush.length; i++) {
                            $scope.category_click(categorygidpush[i], i, key)

                        }
                       for (var i = 0; i < bsgidpush.length; i++) {
                            $scope.bs_click(bsgidpush[i], i, key)

                        }
                })


<!--                if ($scope.selectedtype == 'PO' || $scope.selectedtype == 'Non PO') {-->
<!--                    credit_data_checker($scope.supplier_gid, $scope.selectedtypee, result.data.credit);-->
<!--                } else {-->
<!--                   if( $scope.ppx_present == 'E'){-->

<!--                    credit_data_checker($scope.Emp_gid, 'PPX_emp', result.data.credit);-->
<!--                   }else if( $scope.ppx_present == 'S' ){-->

<!--                    credit_data_checker($scope.supplier_gid, $scope.selectedtype, result.data.credit);-->
<!--                   }else{-->

<!--                   credit_data_checker($scope.Emp_gid, $scope.selectedtype, result.data.credit);-->

<!--                   }-->
<!--                }-->

if($scope.ppx_present == 'I' ){
                         credit_data_checker($scope.selectedsource, $scope.ppx_present, result.data.credit);

                    }else if($scope.ppx_present == 'E'){
                        credit_data_checker($scope.Emp_gid, $scope.ppx_present, result.data.credit);

                    }else{
                        credit_data_checker($scope.supplier_gid, $scope.ppx_present, result.data.credit);

                    }


            })
        }


<!--        var resaondata = invoiceService.getreasondata();-->
<!--        resaondata.then(function(result) {-->
<!--            $scope.reasondropdown = JSON.parse(result.data)-->

<!--        })-->

        $scope.claimrejectclick = function() {


            var rejecthead = {
                invoiceheader_gid: head_gid,
                supplier_gid: $scope.supplier_gid,
                ppx_rejectdata: ppx_rejectdata
            };
            sessionStorage.setItem('rejecthead', JSON.stringify(rejecthead));
            $window.location.href = "claimrejection";

        }

        $scope.selectreason = "";

        $scope.reject_set = function(status,remark) {

            var sts = {
                    "Invoice_Header_Gid": $scope.invoiceheader_gid,
                    "Status":status,
                    "Remark": remark,
                     "file_data": []
                };
            if (status == "REJECTED") {
             console.log($scope.itempn)
              var json = {
                    INV_REJECT: [{
                        Invoice_Header_gid: $scope.invoiceheader_gid,
                        Reject_Reason_Gid: $scope.itempn.rejectreason_reason.rejectreason_gid,
                        Reject_Solution: $scope.itempn.rejectreason_reason.rejectreason_solution
                    }]
                }
                $scope.loading();
                var savereject = invoiceService.setreject(json);
                savereject.then(function(result) {
                  if (result.data == 'SUCCESS') {
                    var apprv = invoiceService.approvalset(sts)
                    apprv.then(function(result) {
                      if (result.data == 'SUCCESS') {
                        alert("Data Rejected")
                      //  $window.location.href = "makersummary"
                      }
                     },
                        function(err) {
                            alert('No data!.');
                    }).finally($scope.endloading);
                  }
                });
            }else{
                var CHECKLIST = {
                    "CHECKLIST": $scope.qadetails,
                    "HEADER_GID": $scope.invoiceheader_gid,
                }
                $scope.loading_popup();
                var DATA = invoiceService.setauditchklist(CHECKLIST)
                DATA.then(function(result) {
                if (result.data == 'SUCCESS') {
                      $scope.loading_popup();
                      var apprv = invoiceService.approvalset(sts)
                            apprv.then(function(result) {
                              if (result.data == 'SUCCESS') {
                                alert("Data Bounced")
                                $window.location.href = "makersummary"
                              }
                              else if(result.data=="Email_Not_Send"){
                                    alert("Data Bounced.Email Not Send");
                                $window.location.href = "makersummary";
                              }
                        },
                        function(err) {
                            alert('No data!.');
                    }).finally($scope.endloading);
                 }
                 },
                        function(err) {
                            alert('No data!.');
                    }).finally($scope.endloading);
            }
        }

         $scope.view_tran_details=function(){
             var datas={params:{"action":"GET","type":"ECF_TRANS_GET",
            "filter":{"Ref_Name":"AP_INVOICE","RefTable_Gid":$scope.invoiceheader_gid}}};
             $scope.loading();
             var ecf_tran_status = invoiceService.get_approval_summary(datas);
             ecf_tran_status.then(function(result) {
                    if(result.data.MESSAGE=="ERROR_OCCURED"){
                        alert(JSON.stringify(result.data.DATA));
                    }
                    $scope.ecf_tran_summary = result.data;
                    console.log($scope.ecf_tran_summary);
                    modalshow('view_tran_details');
             },
             function(err) {
                alert('No data!.');
             }).finally($scope.endloading);
         }

         $scope.apapproved = function(status, remark) {

            if (status == "Reject" && $scope.selectreason == "") {
                alert("Select Rejection Reason");
                return false;
            }
            var sts = {
                "Invoice_Header_Gid": head_gid,
                "Status": status
            };
            if (checkerdtl !== null && status == "Approved") {
                var sts = {
                    "Invoice_Header_Gid": head_gid,
                    "Status": "Checker"
                };
            }
            if (status == "Reject") {
                var json = {
                    INV_REJECT: [{
                        Invoice_Header_gid: head_gid,
                        Reject_Reason_Gid: $scope.selectreason.rejectreason_gid,
                        Reject_Solution: $scope.selectreason.rejectreason_solution
                    }]
                }

                var savereject = invoiceService.setreject(json);
                savereject.then(function(result) {
                    if (result.data == 'SUCCESS') {
                        var apprv = invoiceService.approvalset(sts)
                        apprv.then(function(result) {
                            if (result.data == 'SUCCESS') {
                                alert("Data Inserted Successfully")
                                $window.location.href = "makersummary"
                            }
                            else if(result.data.MESSAGE=="ERROR_OCCURED"){
                                alert(JSON.stringify(result.data.DATA));
                            }
                            else{
                                alert(result.data);
                            }
                        })
                    }
                })
            } else {
                // alert(sts)
                var apprv = invoiceService.approvalset(sts)
                apprv.then(function(result) {
                    if (result.data == 'SUCCESS') {
                        alert("Data Inserted Successfully")
                        $window.location.href = "makersummary"
                    }
                })
            }
        }

        $scope.view_attached_file=function(){
        var datas={params:{"action":"GET","type":"FILE_DETAIL",
            "filter":{"file_reftablegid":$scope.invoiceheader_gid,"ref_name":"AP_INVOICE"}}};
         var ecf_file_datas = invoiceService.get_approval_summary(datas);
         ecf_file_datas.then(function(result) {
                $scope.ecf_all_files = result.data;
         },
         function(err) {
            alert('No data!.');
         }).finally($scope.endloading);
     }

     $scope.view_attached_file();
    $scope.local_url_data="";
     $scope.view_file=function(file_list){
     debugger;
        $scope.state = !$scope.state;
        var datas={"file_data":[file_list]};
        $scope.local_url_data="media/"+file_list.file_name;
<!--         $scope.loading();-->
<!--         var generated_urls = invoiceService.get_generated_url_data(datas);-->
<!--         generated_urls.then(function(result) {-->
<!--                $scope.url_datas = result.data;-->
<!--                $scope.file_url_path=$scope.url_datas[0].file_path;-->
<!--                $scope.local_url_data="media/"+$scope.url_datas[0].file_name;-->
<!--                var final_file_name=$scope.url_datas[0].file_name;-->
<!--                $scope.extension=final_file_name.substr(final_file_name.lastIndexOf('.')+1);-->
<!--                if($scope.extension=="pdf"){-->
<!--                    complete_url ='http://docs.google.com/gview?url=' + encodeURIComponent($scope.file_url_path) + '&embedded=true';-->
<!--                    $scope.pdf_file_url_path = $sce.trustAsResourceUrl(complete_url);-->
<!--                }-->
<!--         },-->
<!--         function(err) {-->
<!--            alert('No data!.');-->
<!--         }).finally($scope.endloading);-->
     }

     $scope.trustAsHtml = function(html) {
      return $sce.trustAsHtml(html);
    }

    $scope.unlock_data=function(){
        if($scope.invoiceheader_status!=undefined && $scope.invoiceheader_gid!=undefined){
             var datas={"action":'INSERT',"type":"AP_FORCE_UNLOCK",
             "filter":{"invoice_header_gid":$scope.invoiceheader_gid,
            "invoice_status":$scope.invoiceheader_status}};
            $scope.loading();
            var get_lock_data = invoiceService.get_lock_data_service(datas);
            get_lock_data.then(function(result) {
                $scope.lock_data =result.data;
                if($scope.lock_data[0]=="SUCCESS"){
                    $window.location.href = "makersummary"
                }
                else{
                    alert($scope.lock_data);
                }
            },
            function(err) {
                alert("Get Lock Details Is Issue");
            }).finally($scope.endloading);
        }
        else{
            alert("Invoice Gid Missing or Invoice Status");
        }
	}

	$scope.view_dedupe=function(){
        var datas={params:{"action":"GET","type":"DEDUBE_INVOICE_HEADER","filter":{"invoiceheader_gid": $scope.invoiceheader_gid}}};
        $scope.loading();
        var dedube_summary = invoiceService.get_dedube_values(datas);
        dedube_summary.then(function(result) {
        console.log(result.data);
            if(result.data.MESSAGE=="ERROR_OCCURED"){
                        alert(JSON.stringify(result.data.DATA));
            }
                $scope.exact_mathch = result.data.EXACT_MATCH;
                $scope.without_supplier = result.data.WITHOUT_SUPPLIER;
                $scope.without_invoice_amount= result.data.WITHOUT_INVOICE_AMOUNT;
                $scope.without_invoice_number= result.data.WITHOUT_INVOICE_NUMBER;
                $scope.without_invoice_date= result.data.WITHOUT_INVOICE_DATE;
                 modalshow('view_dedupe_data');
                 $scope.DEDUPECHECK = true;
            },
            function(err) {
                alert('No data!.');
        }).finally($scope.endloading);
    }

    $scope.note_key="";
    $scope.note_execute=0;
    $scope.view_note_file=function(){
        if($scope.note_execute==0){
            $scope.note_execute=1;
            var datas={params:{"action":"GET","type":"NOTE_DATA",
             "filter":{"InvoiceHeader_Crno":$scope.cr_no}}};
                $scope.loading();
                var pmd_summary = invoiceService.get_invoice_billenty_summary(datas);
                 pmd_summary.then(function(result) {
                        $scope.endloading();
                       if(result.data.length!=0){
                                $scope.note_key = result.data[0].invoiceheader_notename;
                        }
                       if($scope.note_key=="" || $scope.note_key==null){
                            alert("No Notes");
                        }
                        else{
                            var data = {"Filename":$scope.note_key}
                                $scope.loading();
                                var getdept_name = invoiceService.get_file_read(data)
                                getdept_name.then(function(result) {
                                    $scope.endloading();
                                    $scope.htmlcontent = result.data.file_path
                                    modalshow('viewnotepad');
                                }, function(err) {
                                    alert('No data!.');
                                }).finally($scope.endloading);
                        }
                    },
                    function(err) {
                        alert("No Data");
            }).finally($scope.endloading);
        }
        else{
            if($scope.note_key=="" || $scope.note_key==null){
                    alert("No Notes");
                }
                else{
                     modalshow('viewnotepad');
                }
        }

    }

    $scope.view_emp=function(emp_gid){
        $scope.emp_details=[];
        var datas={params:{"action":"GET","type":"EMP_DETAILS", "filter":{"employee_gid":emp_gid}}};
            $scope.loading_transaction();
            var summarys = invoiceService.get_approval_summary(datas);
            summarys.then(function(result) {
                $scope.endloading();
                if(result.data.MESSAGE=="ERROR_OCCURED"){
                    alert(JSON.stringify(result.data.DATA));
                }
                $scope.emp_details= result.data;
                console.log($scope.emp_details);

            },
            function(err) {
                alert('No data!.');
            }).finally($scope.endloading);
    }

    $scope.view_commodity=function(crnumber){
      $scope.load_commodity_data();
        var datas={params:{"action":"GET","type":"COMMODITY_DATA",
         "filter":{"InvoiceHeader_Crno":crnumber}}};
            $scope.loading();
            var commodity_datas = invoiceService.get_invoice_billenty_summary(datas);
            commodity_datas.then(function(result) {
                $scope.endloading();
                if(result.data.MESSAGE=="ERROR_OCCURED"){
                   alert(JSON.stringify(result.data.DATA));
                }

                $scope.commodity_data= result.data;
                if($scope.commodity_data[0].commodity_name){
                     $scope.commodity_show=0;
                }
                $scope.selected_commodity=$scope.commodity_data[0].commodity_name;
                console.log($scope.commodity_data);

            },
            function(err) {
                alert('No data!.');
            }).finally($scope.endloading);
     }
     $scope.header_update_status=0;
    $scope.load_commodity_data=function(){
        $scope.header_update_status=1;

<!--       var data = {-->
<!--            "Table_name": "ap_mst_tcommodity",-->
<!--            "Column_1": "commodity_gid, commodity_name",-->
<!--            "Column_2": "",-->
<!--            "Where_Common": "commodity",-->
<!--            "Where_Primary": "",-->
<!--            "Primary_Value": "",-->
<!--            "Order_by": "gid"-->
<!--        }-->

<!--        var patch = {-->
<!--            Action: "",-->
<!--            Entity_Gid: $scope.entity_gid,-->
<!--            data: data-->
<!--        }-->

<!--        var getcat = invoiceService.getcommodity(patch);-->
<!--            getcat.then(function(result) {-->
<!--                    $scope.commodityname = result.data;-->
<!--            }, function(err) {-->
<!--                alert('No data!.');-->
<!--        }).finally();-->

            var datas={params:{"action":"limit","type":"DELMAT_COMMODITY",
                          "filter":{"InvoiceHeader_Crno": $scope.cr_no,"limit":$scope.invoiceamount}}};

                var delmet_data = invoiceService.get_delmet_data(datas);
                delmet_data.then(function(result) {
                    $scope.endloading();
                    if(result.data.MESSAGE=="ERROR_OCCURED"){
                        alert(JSON.stringify(result.data.DATA));
                    }
                    $scope.commodityname = result.data;
                 },
                function(err) {
                  alert(result);
                }).finally($scope.endloading);

    }

    $scope.commodity = gotocust;
    function gotocust(query) {
        var result = $filter('filter')($scope.commodityname, {
            'commodity_name': query
        });
        return result;
    }
    $scope.Change_commodity=function(commodity_data){
        if(commodity_data.commodity_gid){
            var r = confirm("Are You Sure Update Header");
            if (r == true) {
                 header_json={"HEADER":{"Invoice_Header_Gid":$scope.invoiceheader_gid,"Invoice_Header_Crno":$scope.cr_no,
                 "Invoice_Header_Commodity_Gid":commodity_data.commodity_gid}}
                var appr_set = invoiceService.ecf_header_update(header_json,{});
                appr_set.then(function(result) {
                    if(result.data.MESSAGE=="ERROR_OCCURED"){
                            alert(JSON.stringify(result.data.DATA));
                    }
                    if (result.data == 'SUCCESS') {
                        alert("Successfully Updated");
                    }
                    else{
                        alert(result.data);
                    }
                },
                function(err) {
                    alert('Not Updated!.');
                }).finally($scope.endloading);
            }
        }
    }

     $scope.updateSelection = function(file_data) {
        checked_value=file_data.file_isduplicate;
        if(checked_value=="Y"){$scope.isduplicate="N"}
        else if(checked_value=="N"){$scope.isduplicate="Y"}
        var datas={"action":"UPDATE","type":"FILE_DETAIL_SET",
        "filter":{"ref_name":file_data.ref_name,"file_reftablegid":file_data.file_reftablegid,
                  "file_details":[{"file_gid":file_data.file_gid,"file_key":file_data.file_name,
                  "file_path":file_data.file_path,"file_isduplicate":$scope.isduplicate}]}};
        var set_file = invoiceService.set_file_details(datas);
        set_file.then(function(result) {
            var res = result.data;
            if(res=="SUCCESS"){
               alert("SUCCESS");
               $scope.view_attached_file();
            }
         }, function(err) {
           alert(res);
        }).finally($scope.endloading);
    }

    $scope.download_rent_file=function(file){
        var file_gid=file.file_gid;
        var file_name=file.file_name;
        var token="";
        var datas={params:{"Action":"TOKEN"}};
         $scope.loading_view_attached_file();
            var summarys_branch = invoiceService.get_memo_details(datas);
            summarys_branch.then(function(result) {
                $scope.endloading();
                token=result.data.token;
                memo_ip=result.data.memo_ip;
                if(token!=undefined){
                    $window.open(memo_ip+"/prserv/file/"+file_name+'?token='+token,'_blank');
                }
                else{
                    alert(JSON.stringify(result.data));
                }
            },
            function(err) {
                alert('No data!.');
            }).finally($scope.endloading);
     }


     $scope.tds_details_show=0;
     $scope.get_dts_details=function(){
        $scope.total_taxable_amount=0;
        if($scope.supplier_gid==undefined){
            alert("Supplier and Branch Select");
        }
        else{
            $scope.invoice_date=$filter('date')($scope.invdate,"yyyy-MM-dd");
             var datas={"Supplier_Gid":$scope.supplier_gid,"Invoice_Date":$scope.invoice_date};
             $scope.loading();
             var bank = invoiceService.get_hst_details(datas,"TDS_DATAGET");
             bank.then(function(result) {
                 var bank_data = result.data;
                 $scope.Tax_Amount_Data=bank_data.Tax_Amount;
                 $scope.Subtax_Amount_Data=bank_data.Subtax_Amount;
                 for(var i=0;i<$scope.Tax_Amount_Data.length;i++){
                    $scope.total_taxable_amount+=$scope.Tax_Amount_Data[i].invoiceheader_taxableamt;
                 }
                modalshow('Tds_Details');
                $scope.tds_details_show=1;
            },
            function(err) {
                alert('No data!.');
            }).finally($scope.endloading);
            }
    }





}]);
    myApp.service("invoiceService", function ($http,$filter) {
        this.getdropdown = function (tablename) {
            var responsee = $http.post(Appname+"/Dropdown_detail_ap/",{params:{"tablename":tablename,"gid":0,"name":''}});
            return responsee;
        }

         this.ppxdetails = function (action,filter_data) {
            var responsee = $http.post(Appname+"/PPPXDeatails_get/",{params:{"group":action,"type":"PPX","Filterdata":filter_data}});
            return responsee;
         }
        this.getstateddl = function (d) {
            var response = $http.get(Appname+"/stateddl/");
            return response;

        }

       this.ddl=function(tablename,columnname){
            var response=$http.get(Appname+"/get_custdata/",{params:{"tablename":tablename,"columnname":columnname}});
            return response;
        }

        this.invoiceset=function(detailjson,debit_json,credit_json,header_json,status_json){
            var response=$http.post(Appname+"/Invoice_set/",{params:{"action":"INSERT","type":"INVOICE_DETAILS","header_json":header_json,"detail_json":detailjson,"debit_json":debit_json,"credit_json":credit_json,"status_json":status_json,"invoice_json":{}}});
            return response;
        }


        this.creditget = function(gid,type){
            if(type == 'E'){ var sp_type = 'EMPLOYEE_DETAILS' }else if(type == 'I'){ var sp_type = 'IMPRESED_DETAILS' }else{ var sp_type = 'SUPPLIER_DETAILS' };

         //   if(type == 'PPX_emp' || type == 'EMP Claim'){ var sp_type = 'EMPLOYEE_DETAILS' }else{ var sp_type = 'SUPPLIER_DETAILS' };
         var response=$http.post(Appname+"/Credit_get/",{params:{"type":sp_type,"supplier_gid":gid}});
            return response;

        }

        this.creditget_bank = function(gid,type,branchid){

            if(type == 'E'){     var datas={params:{"action":"GET","type":"EMPLOYEE_DETAILS",
                                 "filter":{"employee_gid":gid}}} }
            else if(type == 'I'){  var datas={params:{"action":"GET","type":"IMPRESED_DETAILS",
                                 "filter":{"branch_gid":branchid}}} }
            else{                  var datas={params:{"action":"GET","type":"SUPPLIER_DETAILS",
                                 "filter":{"supplier_gid":gid,"branch_gid":branchid}}} };
            var response=$http.post(Appname+"/get_APbankdetails/",datas);

            return response;

        }

<!--        this.gethsndata = function(){-->
<!--         var response=$http.post(Appname+"/HSN_get/");-->
<!--            return response;-->

<!--        }-->

        this.gethsntax = function(json){
         var response=$http.post(Appname+"/Hsntax_get/",{params:{"hsndtl":json,"group":"HSN"}});
            return response;

        }

        this.gethsntax_credit = function(json){
           var response=$http.post(Appname+"/HsntaxCredit_get/",{params:{"hsndtl":json,"group":"TDS_CREDIT"}});
            return response;
        }

        this.get_hst_details = function(json,group_name){
           var response=$http.post(Appname+"/HsntaxCredit_get/",{params:{"hsndtl":json,"group":group_name}});
            return response;
        }

        this.gettablevalue = function(json){
         var response = $http.post(Appname+"/tablevalue/",{params:{"tablevalue":json}});
            return response;
        }

        this.get_paymode_details = function(data){
         var response = $http.post(Appname+"/ap_paymode_details/",data);
            return response;
        }

        this.get_subcategory_data = function(json){
         var response = $http.post(Appname+"/get_subcategory_data/",{params:{"tablevalue":json}});
            return response;
        }




         this.getmakerservice = function (header_gid,status) {
            var response=$http.post(Appname+"/APInvoice_get_/",{params:{"action":"INVOICE_MAKER_SUMMARY_","ponumber":"","supplier_gid":0,"inwarddetail_gid":0,"inwardheader_gid":header_gid,"status":status}});
            return response;
        }
         this.checkersummary= function (header_gid,type) {
            if(type == 'PPX_emp' || type == 'EMP Claim'){ var action = 'INVOICE_DETAILS_EDIT_EMP' }else if(type =='IMP'){var action = 'INVOICE_DETAILS_EDIT_IMP'}else{ var action = 'INVOICE_DETAILS_EDIT' };
            var response=$http.post(Appname+"/APInvoiceChecker_get/",{params:{"action":action,"ponumber":"","supplier_gid":0,"inwarddetail_gid":0,"inwardheader_gid":header_gid,"status":""}});
            return response;
        }

            this.approvalset=function(status_json){
        var response=$http.post(Appname+"/Invoiceheader_set/",{params:{"action":"UPDATE","type":"STATUS","header_json":{},"debit_json":{},"detail_json":{},"status_json":status_json}});
        return response;
    }
        this.invoiceset_update=function(header_json){
        var response=$http.post(Appname+"/Invoiceheader_set/",{params:{"action":"UPDATE","type":"INVOICE_HEADER_UPDATE","header_json":header_json,"debit_json":{},"detail_json":{},"status_json":{}}});
        return response;
    }

      this.getreasondata = function () {
        var response=$http.post(Appname+"/Getreason_data/",{params:{"type":"DEBIT","reason_json":{
                                    "Table_name":"ap_mst_trejectreason",
                                    "Column_1":"rejectreason_gid,rejectreason_reason,rejectreason_solution",
                                    "Column_2":"",
                                    "Where_Common":"rejectreason",
                                    "Where_Primary":"",
                                    "Primary_Value":"",
                                    "Order_by":"reason"
                                    },}});
        return response;
        }
               this.setreject = function (reject_json) {
            var responsee = $http.post(Appname+"/APrejectinv_set/",{params:{"action":"Insert","type":"CLAIM_REJECT","reject_json":reject_json}});
            return responsee;
        }

     this.getemployee=function(){
        var response=$http.get(Appname+"/empddl/");
        return response;
     }

       this.setauditchklist=function(chklist_json){
        var response=$http.post(Appname+"/auditchklist_set/",{params:{"action":"Insert_Checklist","type":"","chklist_json":chklist_json}});
        return response;
    }

      this.getentitydata = function () {
        var response=$http.post(Appname+"/classificationdata_get/",{params:{"type":"Mode","Sub_Type":"Summary",
                               "FILTER":{},"CLASSIFICATION":{"Entity_Gid":[0]}}});
        return response;
    }

        this.getsupplierdata_sup = function (supp_gid) {
        var response=$http.post(Appname+"/supplierdata_get/",{params:{"type":"Suppplier","Sub_Type":"DROPDOWN",
                               "FILTER":{"Supplier_gid":supp_gid},"CLASSIFICATION":{"Entity_Gid":[0]}}});
        return response;
    }

    this.ECFcheckersummary= function (Ecfno,type) {
           if(type == 'PPX_emp' || type == 'EMP Claim'){ var action = 'INVOICE_DETAILS_EDIT_EMP' }else{ var action = 'ECF_DETAILS_EDIT' };
            var response=$http.post(Appname+"/ECF_ApChecker_get/",{params:{"action":action,"ecfnumber":Ecfno,"ponumber":"","supplier_gid":0,"inwarddetail_gid":0,"inwardheader_gid":0,"status":""}});
            return response;
        }
  this.ECFcheckersummary_NEW= function (data) {
        var response=$http.post(Appname+"/ECF_Process_get/",data);
        return response;
    }

        this.get_hsn_details = function (data) {
        var response=$http.post(Appname+"/Get_Supplier/",data);
        return response;
     }
    this.getauditchklist = function (chk_type) {
        var response=$http.post(Appname+"/auditchklist_get/",{params:{"type":"MASTER","chk_type":chk_type,"header_gid":0}});
        return response;
    }

    this.get_approval_summary=function(data){
        var response=$http.post(Appname+"/get_onward_data/",data);
        return response;
    }

    this.get_generated_url_data=function(data){
        var response=$http.post(Appname+"/common_s3_file_url_generate/",data);
        return response;
    }

    this.get_lock_data_service=function (data) {
	        var response=$http.post(Appname+"/common_lock_data/",data);
	        return response;
	}

	this.get_dedube_values=function(data){
        var response=$http.post(Appname+"/get_dedube_data/",data);
        return response;
    }

    this.get_invoice_billenty_summary=function(data){
            var response=$http.post(Appname+"/ECF_Process_get/",data);
            return response;
    }

    this.get_file_read = function (data) {
            var response = $http.post(Appname + "/common_read_file/", data);
            return response;
    }

    this.set_file_details=function (data) {
        var response=$http.post(Appname+"/set_file_details/",data);
        return response;
   }

    this.ecf_header_update=function(header_json,status_json){
        var response=$http.post(Appname+"/ECFInvoiceheader_set/",{params:{"action":"UPDATE","type":"ECF_HEADER_UPDATE","header_json":header_json,"debit_json":{},"detail_json":{},"status_json":status_json}});
        return response;
    }

     this.getcommodity = function(patch){
        var respons = $http.post(Appname + "/get_tablevalue/", patch);
        return respons;
    }

     this.get_delmet_data=function(data){
        var response=$http.post(Appname+"/get_delmat_data/",data);
        return response;
    }

    this.save_files=function(img){
              var response=$http.post(Appname+"/fileUploadS3/",img,
                   {
                     transformRequest: angular.identity,
                     headers: {
                        'Content-Type': undefined
                     }
                   }
              );
              return response;
    }

     this.get_memo_details = function (data) {
            var response = $http.post(Appname + "/memo_details/", data,
            );
            return response;
    }
    this.get_bank_details = function (data) {
        var response=$http.post(Appname+"/get_APbankdetails/",data);
        return response;
   }


});



















































































































































</script>
{% endblock %}